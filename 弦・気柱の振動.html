<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é«˜æ ¡ç‰©ç† - å¼¦ãƒ»æ°—æŸ±ã®æŒ¯å‹•</title>
    <script>
      window.MathJax = {
      tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']]
     }
     };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        header {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .back-link {
            color: #667eea;
            text-decoration: none;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 10px;
        }
        h1 { color: #333; }
        .container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .tab-btn {
            flex: 1;
            min-width: 150px;
            padding: 12px 20px;
            border: none;
            background: #f0f0f0;
            cursor: pointer;
            border-radius: 5px;
            font-size: 16px;
            transition: all 0.3s;
        }
        .tab-btn.active { background: #667eea; color: white; }
        .tab-btn:hover { background: #8899f0; color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        h2 { color: #667eea; margin-bottom: 15px; }
        h3 { color: #764ba2; margin: 25px 0 15px 0; padding-bottom: 5px; border-bottom: 2px solid #eee; }
        h4 { color: #555; margin: 20px 0 10px 0; }
        p { line-height: 1.8; margin-bottom: 15px; }
        .point-box {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
            border-left: 4px solid #667eea;
            padding: 15px 20px;
            margin: 20px 0;
            border-radius: 0 10px 10px 0;
        }
        .point-box h4 { color: #667eea; margin-top: 0; }
        .formula-box {
            background: #fff3e0;
            border: 2px solid #ff9800;
            padding: 15px 20px;
            margin: 20px 0;
            border-radius: 10px;
            text-align: center;
        }
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .comparison-table th, .comparison-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: center;
        }
        .comparison-table th { background: #667eea; color: white; }
        .comparison-table tr:nth-child(even) { background: #f9f9f9; }
        .note {
            background: #e8f5e9;
            border-left: 4px solid #4CAF50;
            padding: 10px 15px;
            margin: 15px 0;
            font-size: 0.95em;
        }
        
        /* ãƒ‡ãƒ¢å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
        .demo-container {
            background: #f5f5f5;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        .demo-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .demo-btn {
            padding: 10px 15px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            font-size: 14px;
        }
        .demo-btn:hover { background: #f0f0ff; }
        .demo-btn.active { background: #667eea; color: white; }
        .demo-canvas-container {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
        }
        .demo-display { text-align: center; }
        .demo-display canvas {
            border: 1px solid #ddd;
            border-radius: 5px;
            background: white;
        }
        .demo-info {
            margin-top: 10px;
            font-size: 14px;
            color: #555;
        }
        
        /* æ³¢å½¢å¯è¦–åŒ– */
        .wave-visual {
            background: #fafafa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        .wave-visual canvas {
            border: 1px solid #ddd;
            border-radius: 5px;
            background: white;
            max-width: 100%;
        }
        .wave-visual-title {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }
        .wave-controls {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .wave-btn {
            padding: 8px 16px;
            border: 2px solid #764ba2;
            background: white;
            color: #764ba2;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        .wave-btn:hover { background: #f5f0ff; }
        .wave-btn.active { background: #764ba2; color: white; }
        
        /* ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« */
        .slider-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
            flex-wrap: wrap;
            justify-content: center;
        }
        .slider-control label {
            font-weight: bold;
            min-width: 80px;
        }
        .slider-control input[type="range"] {
            width: 150px;
        }
        .slider-value {
            background: #667eea;
            color: white;
            padding: 3px 10px;
            border-radius: 5px;
            min-width: 50px;
            text-align: center;
        }
        
        /* ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .sim-section {
            margin-bottom: 40px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        .sim-section h3 { border-bottom: none; margin-top: 0; }
        #sim-container, #sim-container2 {
            background: #f5f5f5;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        #stringCanvas, #pipeCanvas {
            display: block;
            width: 100%;
            background: white;
            border-radius: 5px;
            border: 2px solid #ddd;
        }
        .sim-controls {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
        }
        .control-group { margin-bottom: 20px; }
        .control-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }
        .control-group input[type="range"] {
            width: 100%;
            margin: 10px 0;
        }
        .value-display {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 5px 15px;
            border-radius: 5px;
            font-weight: bold;
            min-width: 100px;
            text-align: center;
        }
        .resonance-indicator {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 5px;
            font-weight: bold;
            margin-left: 10px;
        }
        .resonance-indicator.resonating {
            background: #4CAF50;
            color: white;
            animation: pulse 0.5s ease-in-out infinite alternate;
        }
        .resonance-indicator.not-resonating { background: #f44336; color: white; }
        @keyframes pulse {
            from { opacity: 1; transform: scale(1); }
            to { opacity: 0.8; transform: scale(1.05); }
        }
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .sim-button {
            flex: 1;
            min-width: 120px;
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        .sim-button.start { background: #4CAF50; color: white; }
        .sim-button.start:hover { background: #45a049; }
        .sim-button.reset { background: #f44336; color: white; }
        .sim-button.reset:hover { background: #da190b; }
        .info-display {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            border: 2px solid #ddd;
        }
        .info-display p { margin: 5px 0; font-family: monospace; font-size: 14px; }
        .mode-toggle { display: flex; gap: 10px; margin-bottom: 15px; }
        .mode-btn {
            flex: 1;
            padding: 10px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        .mode-btn.active { background: #667eea; color: white; }
        
        /* å•é¡Œã‚¿ãƒ–ç”¨ */
        .problem {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .problem h4 { color: #667eea; }
        details { margin-top: 15px; }
        summary {
            cursor: pointer;
            padding: 10px 15px;
            background: #667eea;
            color: white;
            border-radius: 5px;
            font-weight: bold;
        }
        summary:hover { background: #5a6fd6; }
        .answer {
            padding: 15px;
            background: #e8f5e9;
            border-radius: 0 0 10px 10px;
            margin-top: 5px;
        }
        
        /* ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚¹ã‚¿ã‚¤ãƒ« */
        .checkbox-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 15px 0;
        }
        .checkbox-group label {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
        }
        
        @media (max-width: 768px) {
            body { padding: 10px; }
            header, .container { padding: 15px; }
            .tab-btn { min-width: 100px; font-size: 14px; }
            .comparison-table { font-size: 12px; }
            .comparison-table th, .comparison-table td { padding: 8px 4px; }
        }
    </style>
</head>
<body>
    <header>
        <a href="index.html" class="back-link">â† ç›®æ¬¡ã«æˆ»ã‚‹</a>
        <h1>å¼¦ãƒ»æ°—æŸ±ã®æŒ¯å‹•</h1>
    </header>
    <div class="container">
        
        <div class="tabs">
            <button class="tab-btn active" onclick="openTab('lecture')">è§£èª¬ç·¨</button>
            <button class="tab-btn" onclick="openTab('problem')">å•é¡Œç·¨</button>
            <button class="tab-btn" onclick="openTab('simulation')">ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</button>
        </div>
        
        <!-- ========== è§£èª¬ã‚¿ãƒ– ========== -->
        <div id="lecture" class="tab-content active">
            <h2>å¼¦ãƒ»æ°—æŸ±ã®æŒ¯å‹•ã®ãƒã‚¤ãƒ³ãƒˆ</h2>
            
            <h3>1. å›ºæœ‰æŒ¯å‹•ã¨ã¯ï¼Ÿ</h3>
            <p>
                ç‰©ä½“ã«ã¯ãã‚Œãã‚Œ<strong>ã€ŒæŒ¯å‹•ã—ã‚„ã™ã„æŒ¯å‹•æ•°ã€</strong>ãŒå­˜åœ¨ã—ã¾ã™ã€‚ã“ã‚Œã‚’<strong>å›ºæœ‰æŒ¯å‹•æ•°</strong>ã¨ã„ã„ã¾ã™ã€‚
                å›ºæœ‰æŒ¯å‹•æ•°ã¯ç‰©ä½“ã®<strong>å½¢ãƒ»å¤§ãã•ãƒ»æè³ª</strong>ãªã©ã§æ±ºã¾ã‚Šã€å¤–ã‹ã‚‰ä¸ãˆã‚‹åŠ›ã®å¤§ãã•ã§ã¯å¤‰ã‚ã‚Šã¾ã›ã‚“ã€‚
            </p>
            
            <!-- å›ºæœ‰æŒ¯å‹•ãƒ‡ãƒ¢ -->
            <div class="demo-container">
                <div class="demo-selector">
                    <button class="demo-btn active" id="btn-house" onclick="selectDemo('house', this)">ğŸ  ä¸€æˆ¸å»ºã¦</button>
                    <button class="demo-btn" id="btn-tower" onclick="selectDemo('tower', this)">ğŸ™ï¸ é«˜å±¤ãƒ“ãƒ«</button>
                    <button class="demo-btn" id="btn-swing" onclick="selectDemo('swing', this)">ğŸ  ãƒ–ãƒ©ãƒ³ã‚³</button>
                    <button class="demo-btn" id="btn-sandbag" onclick="selectDemo('sandbag', this)">ğŸ¥Š ã‚µãƒ³ãƒ‰ãƒãƒƒã‚°</button>
                </div>
                <div class="demo-canvas-container">
                    <div class="demo-display">
                        <canvas id="demoCanvas" width="350" height="280"></canvas>
                        <div class="demo-info" id="demoInfo">
                            å›ºæœ‰æŒ¯å‹•æ•°ãŒé«˜ã„ â†’ é€Ÿãå°åˆ»ã¿ã«æºã‚Œã‚‹
                        </div>
                    </div>
                </div>
                <div class="button-group" style="justify-content: center; margin-top: 15px;">
                    <button class="sim-button start" id="demoStartBtn" onclick="toggleDemoAnimation()">æºã‚‰ã™ï¼</button>
                </div>
            </div>
            
            <div class="point-box">
                <h4>ğŸ’¡ å›ºæœ‰æŒ¯å‹•ã®ãƒã‚¤ãƒ³ãƒˆ</h4>
                <p>
                    ãƒ»<strong>ä¸€æˆ¸å»ºã¦</strong>ï¼šå›ºæœ‰æŒ¯å‹•æ•°ãŒ<strong>é«˜ã„</strong>ï¼ˆé€Ÿãå°åˆ»ã¿ã«æºã‚Œã‚‹ï¼‰<br>
                    ãƒ»<strong>é«˜å±¤ãƒ“ãƒ«</strong>ï¼šå›ºæœ‰æŒ¯å‹•æ•°ãŒ<strong>ä½ã„</strong>ï¼ˆã‚†ã£ãã‚Šå¤§ããæºã‚Œã‚‹ï¼‰<br>
                    ãƒ»<strong>ãƒ–ãƒ©ãƒ³ã‚³</strong>ï¼šä¹—ã‚‹äººã®ä½“é‡ã«<strong>é–¢ä¿‚ãªã</strong>æºã‚Œæ–¹ï¼ˆå‘¨æœŸï¼‰ã¯åŒã˜<br>
                    ãƒ»<strong>ã‚µãƒ³ãƒ‰ãƒãƒƒã‚°</strong>ï¼šå©ã<strong>å¼·ã•ã¯é–¢ä¿‚ãªã</strong>ã€å¤§ããæºã‚‰ã™ãªã‚‰<strong>ã‚¿ã‚¤ãƒŸãƒ³ã‚°</strong>ãŒå¤§äº‹
                </p>
            </div>
            
            <div class="note">
                <strong>âš¡ é‡è¦</strong><br>
                å›ºæœ‰æŒ¯å‹•æ•°ã¯ç‰©ä½“ã®æ€§è³ªã§æ±ºã¾ã‚Šã€ä¸ãˆã‚‹åŠ›ã®<strong>å¤§ãã•</strong>ã§ã¯å¤‰ã‚ã‚‰ãªã„ï¼<br>
                å¤§ããæºã‚‰ã—ãŸã‘ã‚Œã°ã€å›ºæœ‰æŒ¯å‹•æ•°ã«åˆã£ãŸ<strong>ã‚¿ã‚¤ãƒŸãƒ³ã‚°</strong>ã§åŠ›ã‚’åŠ ãˆã‚‹ã“ã¨ãŒå¤§åˆ‡ã€‚
            </div>
            
            <p>
                ã“ã®ã‚ˆã†ã«ã€å›ºæœ‰æŒ¯å‹•ã¯å»ºç‰©ã ã‘ã§ãªãã€å¼¦æ¥½å™¨ã®å¼¦ã‚„ç®¡æ¥½å™¨ã®æ°—æŸ±ãªã©ã€ã‚ã‚‰ã‚†ã‚‹ç‰©ä½“ã«å­˜åœ¨ã—ã¾ã™ã€‚<br>
                ã“ã“ã§ã¯ã€<strong>å¼¦</strong>ã¨<strong>æ°—æŸ±</strong>ãŒæŒ¯å‹•ã—ãŸã¨ãã®æŒ¯å‹•æ•°ã«ã¤ã„ã¦èª¿ã¹ã¦ã„ãã¾ã™ã€‚
            </p>
            
            <h3>2. å¼¦ã®æŒ¯å‹•</h3>
            <p>
                ã‚®ã‚¿ãƒ¼ã‚„ãƒã‚¤ã‚ªãƒªãƒ³ã®å¼¦ã‚’å¼¾ãã¨ã€å¼¦ã«<strong>æ¨ªæ³¢</strong>ãŒç™ºç”Ÿã—ã€ä¸¡ç«¯ã§åå°„ã—ã¦<strong>å®šå¸¸æ³¢</strong>ãŒã§ãã¾ã™ã€‚
            </p>
            
            <div class="point-box">
                <h4>âš¡ æœ€é‡è¦ãƒã‚¤ãƒ³ãƒˆ</h4>
                <p>
                    å¼¦ã¯<strong>ã€Œä¸¡ç«¯ãŒç¯€ã€</strong>ã«ãªã‚‹ã‚ˆã†ã«æŒ¯å‹•ã™ã‚‹ï¼<br>
                    ï¼ˆä¸¡ç«¯ã¯å›ºå®šã•ã‚Œã¦ã„ã¦å‹•ã‘ãªã„ã‹ã‚‰ï¼‰
                </p>
            </div>
            
            <p>åŸºæœ¬æŒ¯å‹•ã‚’åŸºæº–ã«ã—ã¦ã€å¼¦ã®ä¸­ã«å…¥ã‚‹æ³¢ã®æ•°ï¼ˆ$\frac{\lambda}{2}$ ã®å€‹æ•°ï¼‰ãŒè‡ªç„¶æ•°ãšã¤å¢—ãˆã¦ã„ãã¾ã™ã€‚</p>
            
            <!-- å¼¦ã®æ³¢å½¢å¯è¦–åŒ– -->
            <div class="wave-visual">
                <div class="wave-visual-title">ğŸ¸ å¼¦ã®å®šå¸¸æ³¢ã®å½¢ï¼ˆãƒœã‚¿ãƒ³ã§åˆ‡ã‚Šæ›¿ãˆï¼‰</div>
                <canvas id="stringWaveCanvas" width="600" height="200"></canvas>
                <div class="wave-controls" id="stringWaveControls">
                    <button class="wave-btn active" onclick="setStringHarmonic(1, this)">åŸºæœ¬æŒ¯å‹• (n=1)</button>
                    <button class="wave-btn" onclick="setStringHarmonic(2, this)">2å€æŒ¯å‹• (n=2)</button>
                    <button class="wave-btn" onclick="setStringHarmonic(3, this)">3å€æŒ¯å‹• (n=3)</button>
                    <button class="wave-btn" onclick="setStringHarmonic(4, this)">4å€æŒ¯å‹• (n=4)</button>
                </div>
                <div class="demo-info" id="stringWaveInfo" style="margin-top: 10px;">
                    åŸºæœ¬æŒ¯å‹•: L = Î»â‚/2 â†’ Î»â‚ = 2L ï¼ˆå¼¦ã®ä¸­ã«åŠæ³¢é•·ãŒ1å€‹å…¥ã‚‹ï¼‰
                </div>
            </div>
            
            <div class="note">
                <strong>ğŸµ å®Ÿéš›ã®å¼¦ã®æŒ¯å‹•</strong><br>
                å®Ÿéš›ã®å¼¦ã¯ã€åŸºæœ¬æŒ¯å‹•ãƒ»2å€æŒ¯å‹•ãƒ»3å€æŒ¯å‹•...ãŒ<strong>åŒæ™‚ã«</strong>ç™ºç”Ÿã—ã¦ã„ã¾ã™ï¼ˆãŸã ã—ã€ã™ã¹ã¦åŒã˜å¤§ãã•ã§ã¯ãªã„ï¼‰ã€‚<br>
                ã“ã®å€æŒ¯å‹•ã®æ··ã–ã‚Šå…·åˆãŒã€æ¥½å™¨ã”ã¨ã®<strong>ã€ŒéŸ³è‰²ã€</strong>ã®é•ã„ã‚’ç”Ÿã¿å‡ºã—ã¦ã„ã¾ã™ã€‚
            </div>
            
            <!-- åˆæˆæ³¢ãƒ‡ãƒ¢ -->
            <div class="wave-visual">
                <div class="wave-visual-title">ğŸ¼ å®Ÿéš›ã®å¼¦ã®æŒ¯å‹•ï¼ˆå€æŒ¯å‹•ã®åˆæˆï¼‰</div>
                <canvas id="compositeWaveCanvas" width="600" height="250"></canvas>
                <div class="checkbox-group">
                    <label><input type="checkbox" id="harm1Check" checked onchange="updateCompositeWave()"> åŸºæœ¬æŒ¯å‹•</label>
                    <label><input type="checkbox" id="harm2Check" checked onchange="updateCompositeWave()"> 2å€æŒ¯å‹•</label>
                    <label><input type="checkbox" id="harm3Check" checked onchange="updateCompositeWave()"> 3å€æŒ¯å‹•</label>
                    <label><input type="checkbox" id="harm4Check" onchange="updateCompositeWave()"> 4å€æŒ¯å‹•</label>
                </div>
                <div class="slider-control">
                    <label>åŸºæœ¬æŒ¯å‹•:</label>
                    <input type="range" id="amp1Slider" min="0" max="100" value="100" onchange="updateCompositeWave()">
                    <span class="slider-value" id="amp1Value">100%</span>
                    <label style="margin-left:20px;">2å€æŒ¯å‹•:</label>
                    <input type="range" id="amp2Slider" min="0" max="100" value="50" onchange="updateCompositeWave()">
                    <span class="slider-value" id="amp2Value">50%</span>
                </div>
                <div class="slider-control">
                    <label>3å€æŒ¯å‹•:</label>
                    <input type="range" id="amp3Slider" min="0" max="100" value="30" onchange="updateCompositeWave()">
                    <span class="slider-value" id="amp3Value">30%</span>
                    <label style="margin-left:20px;">4å€æŒ¯å‹•:</label>
                    <input type="range" id="amp4Slider" min="0" max="100" value="20" onchange="updateCompositeWave()">
                    <span class="slider-value" id="amp4Value">20%</span>
                </div>
                <div class="button-group" style="justify-content: center; margin-top: 10px;">
                    <button class="sim-button start" id="compositeStartBtn" onclick="toggleCompositeAnimation()">ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹</button>
                </div>
                <div class="demo-info" style="margin-top: 10px;">
                    å„å€æŒ¯å‹•ã®ON/OFFã¨æŒ¯å¹…ã‚’å¤‰ãˆã¦ã€åˆæˆæ³¢å½¢ã®å¤‰åŒ–ã‚’è¦³å¯Ÿã—ã‚ˆã†ï¼
                </div>
            </div>
            
            <table class="comparison-table">
                <tr>
                    <th>æŒ¯å‹•ã®ç¨®é¡</th>
                    <th>å¼¦ã®é•·ã•ã¨æ³¢é•·ã®é–¢ä¿‚</th>
                    <th>æ³¢é•· $\lambda_n$</th>
                </tr>
                <tr>
                    <td>åŸºæœ¬æŒ¯å‹•ï¼ˆ$n=1$ï¼‰</td>
                    <td>$L = \dfrac{\lambda_1}{2}$</td>
                    <td>$\lambda_1 = 2L$</td>
                </tr>
                <tr>
                    <td>2å€æŒ¯å‹•ï¼ˆ$n=2$ï¼‰</td>
                    <td>$L = \dfrac{2\lambda_2}{2} = \lambda_2$</td>
                    <td>$\lambda_2 = L$</td>
                </tr>
                <tr>
                    <td>3å€æŒ¯å‹•ï¼ˆ$n=3$ï¼‰</td>
                    <td>$L = \dfrac{3\lambda_3}{2}$</td>
                    <td>$\lambda_3 = \dfrac{2L}{3}$</td>
                </tr>
                <tr>
                    <td>$n$å€æŒ¯å‹•</td>
                    <td>$L = \dfrac{n\lambda_n}{2}$</td>
                    <td>$\lambda_n = \dfrac{2L}{n}$</td>
                </tr>
            </table>
            
            <div class="formula-box">
                <h4>å¼¦ã®å›ºæœ‰æŒ¯å‹•æ•°</h4>
                <p>
                    $f_n = \dfrac{v}{\lambda_n} = \dfrac{nv}{2L} = \dfrac{n}{2L}\sqrt{\dfrac{S}{\rho}}$ ã€€ï¼ˆ$n = 1, 2, 3, ...$ï¼‰
                </p>
                <p style="font-size: 0.9em; text-align: left; margin-top: 10px;">
                    $v$ï¼šå¼¦ã‚’ä¼ã‚ã‚‹æ³¢ã®é€Ÿã• [m/s]ã€$S$ï¼šå¼¦ã®å¼µåŠ› [N]ã€$\rho$ï¼šå¼¦ã®ç·šå¯†åº¦ [kg/m]
                </p>
            </div>
            
            <div class="note">
                <strong>ğŸ’¡ ã‚®ã‚¿ãƒ¼ã§éŸ³ã‚’å¤‰ãˆã‚‹æ–¹æ³•</strong><br>
                ãƒ»ãƒ•ãƒ¬ãƒƒãƒˆã‚’æŠ¼ã•ãˆã‚‹ â†’ å¼¦ã®é•·ã• $L$ ãŒçŸ­ããªã‚‹ â†’ æŒ¯å‹•æ•°ãŒä¸ŠãŒã‚‹ï¼ˆé«˜ã„éŸ³ï¼‰<br>
                ãƒ»å¼¦ã‚’å¼µã‚‹ â†’ å¼µåŠ› $S$ ãŒå¤§ãããªã‚‹ â†’ æŒ¯å‹•æ•°ãŒä¸ŠãŒã‚‹ï¼ˆé«˜ã„éŸ³ï¼‰<br>
                ãƒ»å¤ªã„å¼¦ã‚’ä½¿ã† â†’ ç·šå¯†åº¦ $\rho$ ãŒå¤§ãããªã‚‹ â†’ æŒ¯å‹•æ•°ãŒä¸‹ãŒã‚‹ï¼ˆä½ã„éŸ³ï¼‰
            </div>
            
            <h3>3. æ°—æŸ±ã®æŒ¯å‹•</h3>
            <p>
                ç®¡ã®ä¸­ã®ç©ºæ°—ï¼ˆæ°—æŸ±ï¼‰ã‚‚å›ºæœ‰æŒ¯å‹•æ•°ã‚’æŒã£ã¦ã„ã¾ã™ã€‚ç®¡ã«æ¯ã‚’å¹ãè¾¼ã‚€ã¨ã€æ°—æŸ±ãŒå›ºæœ‰æŒ¯å‹•ã‚’èµ·ã“ã—ã¦éŸ³ãŒå‡ºã¾ã™ã€‚
            </p>
            
            <div class="note">
                ç©ºæ°—ã®å›ºæœ‰æŒ¯å‹•ã¯<strong>ç¸¦æ³¢</strong>ã§ã™ãŒã€ã‚ã‹ã‚Šã‚„ã™ã„ã‚ˆã†ã«<strong>æ¨ªæ³¢ã«å¤‰æ›ã—ã¦è¡¨ç¤º</strong>ã—ã¾ã™ã€‚
            </div>
            
            <h4>â‘  é–‰ç®¡ï¼ˆä¸€ç«¯ãŒé–‰ã˜ãŸç®¡ï¼‰</h4>
            <div class="point-box">
                <h4>âš¡ é–‰ç®¡ã®ãƒã‚¤ãƒ³ãƒˆ</h4>
                <p>
                    é–‰ç®¡ã¯ã€Œ<strong>å£ãŒè…¹ã€åº•ãŒç¯€</strong>ã€ã«ãªã‚‹ã‚ˆã†ã«æŒ¯å‹•ã™ã‚‹ï¼<br>
                    åŸºæœ¬æŒ¯å‹•ã‚’åŸºæº–ã«ã—ã¦ã€$\frac{\lambda}{4}$ ãŒ<strong>å¥‡æ•°å€</strong>ãšã¤å¢—ãˆã‚‹ã€‚
                </p>
            </div>
            
            <!-- é–‰ç®¡ã®æ³¢å½¢å¯è¦–åŒ– -->
            <div class="wave-visual">
                <div class="wave-visual-title">ğŸº é–‰ç®¡ã®å®šå¸¸æ³¢ã®å½¢ï¼ˆãƒœã‚¿ãƒ³ã§åˆ‡ã‚Šæ›¿ãˆï¼‰</div>
                <canvas id="closedPipeWaveCanvas" width="500" height="250"></canvas>
                <div class="wave-controls" id="closedPipeWaveControls">
                    <button class="wave-btn active" onclick="setClosedPipeHarmonic(1, this)">åŸºæœ¬æŒ¯å‹• (n=1)</button>
                    <button class="wave-btn" onclick="setClosedPipeHarmonic(3, this)">3å€æŒ¯å‹• (n=3)</button>
                    <button class="wave-btn" onclick="setClosedPipeHarmonic(5, this)">5å€æŒ¯å‹• (n=5)</button>
                    <button class="wave-btn" onclick="setClosedPipeHarmonic(7, this)">7å€æŒ¯å‹• (n=7)</button>
                </div>
                <div class="demo-info" id="closedPipeWaveInfo" style="margin-top: 10px;">
                    åŸºæœ¬æŒ¯å‹•: L = Î»â‚/4 â†’ Î»â‚ = 4L ï¼ˆç®¡ã®ä¸­ã«1/4æ³¢é•·ãŒå…¥ã‚‹ï¼‰
                </div>
            </div>
            
            <table class="comparison-table">
                <tr>
                    <th>æŒ¯å‹•ã®ç¨®é¡</th>
                    <th>ç®¡ã®é•·ã•ã¨æ³¢é•·ã®é–¢ä¿‚</th>
                    <th>æ³¢é•· $\lambda_n$</th>
                </tr>
                <tr>
                    <td>åŸºæœ¬æŒ¯å‹•</td>
                    <td>$L = \dfrac{\lambda_1}{4}$</td>
                    <td>$\lambda_1 = 4L$</td>
                </tr>
                <tr>
                    <td>3å€æŒ¯å‹•</td>
                    <td>$L = \dfrac{3\lambda_3}{4}$</td>
                    <td>$\lambda_3 = \dfrac{4L}{3}$</td>
                </tr>
                <tr>
                    <td>5å€æŒ¯å‹•</td>
                    <td>$L = \dfrac{5\lambda_5}{4}$</td>
                    <td>$\lambda_5 = \dfrac{4L}{5}$</td>
                </tr>
                <tr>
                    <td>$(2m-1)$å€æŒ¯å‹•</td>
                    <td>$L = \dfrac{(2m-1)\lambda_n}{4}$</td>
                    <td>$\lambda_n = \dfrac{4L}{2m-1}$</td>
                </tr>
            </table>
            
            <div class="formula-box">
                <h4>é–‰ç®¡ã®å›ºæœ‰æŒ¯å‹•æ•°</h4>
                <p>
                    $f_n = \dfrac{V}{\lambda_n} = \dfrac{nV}{4L}$ ã€€ï¼ˆ$n = 1, 3, 5, ...$ å¥‡æ•°ã®ã¿ï¼‰
                </p>
            </div>
            
            <h4>â‘¡ é–‹ç®¡ï¼ˆä¸¡ç«¯ãŒé–‹ã„ãŸç®¡ï¼‰</h4>
            <div class="point-box">
                <h4>âš¡ é–‹ç®¡ã®ãƒã‚¤ãƒ³ãƒˆ</h4>
                <p>
                    é–‹ç®¡ã¯ã€Œ<strong>ä¸¡ç«¯ãŒè…¹</strong>ã€ã«ãªã‚‹ã‚ˆã†ã«æŒ¯å‹•ã™ã‚‹ï¼<br>
                    åŸºæœ¬æŒ¯å‹•ã‚’åŸºæº–ã«ã—ã¦ã€$\frac{\lambda}{4}$ ãŒ<strong>å¶æ•°å€ï¼ˆ=æ•´æ•°å€ï¼‰</strong>ãšã¤å¢—ãˆã‚‹ã€‚
                </p>
            </div>
            
            <!-- é–‹ç®¡ã®æ³¢å½¢å¯è¦–åŒ– -->
            <div class="wave-visual">
                <div class="wave-visual-title">ğŸµ é–‹ç®¡ã®å®šå¸¸æ³¢ã®å½¢ï¼ˆãƒœã‚¿ãƒ³ã§åˆ‡ã‚Šæ›¿ãˆï¼‰</div>
                <canvas id="openPipeWaveCanvas" width="500" height="250"></canvas>
                <div class="wave-controls" id="openPipeWaveControls">
                    <button class="wave-btn active" onclick="setOpenPipeHarmonic(1, this)">åŸºæœ¬æŒ¯å‹• (n=1)</button>
                    <button class="wave-btn" onclick="setOpenPipeHarmonic(2, this)">2å€æŒ¯å‹• (n=2)</button>
                    <button class="wave-btn" onclick="setOpenPipeHarmonic(3, this)">3å€æŒ¯å‹• (n=3)</button>
                    <button class="wave-btn" onclick="setOpenPipeHarmonic(4, this)">4å€æŒ¯å‹• (n=4)</button>
                </div>
                <div class="demo-info" id="openPipeWaveInfo" style="margin-top: 10px;">
                    åŸºæœ¬æŒ¯å‹•: L = Î»â‚/2 â†’ Î»â‚ = 2L ï¼ˆç®¡ã®ä¸­ã«åŠæ³¢é•·ãŒå…¥ã‚‹ï¼‰
                </div>
            </div>
            
            <table class="comparison-table">
                <tr>
                    <th>æŒ¯å‹•ã®ç¨®é¡</th>
                    <th>ç®¡ã®é•·ã•ã¨æ³¢é•·ã®é–¢ä¿‚</th>
                    <th>æ³¢é•· $\lambda_n$</th>
                </tr>
                <tr>
                    <td>åŸºæœ¬æŒ¯å‹•ï¼ˆ$n=1$ï¼‰</td>
                    <td>$L = \dfrac{\lambda_1}{2}$</td>
                    <td>$\lambda_1 = 2L$</td>
                </tr>
                <tr>
                    <td>2å€æŒ¯å‹•ï¼ˆ$n=2$ï¼‰</td>
                    <td>$L = \lambda_2$</td>
                    <td>$\lambda_2 = L$</td>
                </tr>
                <tr>
                    <td>3å€æŒ¯å‹•ï¼ˆ$n=3$ï¼‰</td>
                    <td>$L = \dfrac{3\lambda_3}{2}$</td>
                    <td>$\lambda_3 = \dfrac{2L}{3}$</td>
                </tr>
                <tr>
                    <td>$n$å€æŒ¯å‹•</td>
                    <td>$L = \dfrac{n\lambda_n}{2}$</td>
                    <td>$\lambda_n = \dfrac{2L}{n}$</td>
                </tr>
            </table>
            
            <div class="formula-box">
                <h4>é–‹ç®¡ã®å›ºæœ‰æŒ¯å‹•æ•°</h4>
                <p>
                    $f_n = \dfrac{V}{\lambda_n} = \dfrac{nV}{2L}$ ã€€ï¼ˆ$n = 1, 2, 3, ...$ ã™ã¹ã¦ã®è‡ªç„¶æ•°ï¼‰
                </p>
            </div>
            
            <h3>4. é–‹å£ç«¯è£œæ­£</h3>
            <p>
                ã“ã“ã¾ã§ã¯ã€ç®¡ã®ç«¯ï¼ˆé–‹å£ç«¯ï¼‰ã§ã¡ã‚‡ã†ã©è…¹ãŒã§ãã‚‹ã¨è€ƒãˆã¦ãã¾ã—ãŸã€‚<br>
                ã—ã‹ã—ã€å®Ÿéš›ã«ãƒšãƒƒãƒˆãƒœãƒˆãƒ«ãªã©ã§éŸ³ã‚’é³´ã‚‰ãã†ã¨ã™ã‚‹ã¨ã€å£ã«ã´ã£ãŸã‚Šæ¯ã‚’å¹ãã‹ã‘ã‚‹ã‚ˆã‚Šã‚‚ã€<strong>å°‘ã—é›¢ã—ãŸæ–¹ãŒé³´ã‚Šã‚„ã™ã„</strong>ã“ã¨ã«æ°—ã¥ãã¾ã™ã€‚
            </p>
            
            <div class="point-box">
                <h4>ğŸ“Œ é–‹å£ç«¯è£œæ­£ã¨ã¯</h4>
                <p>
                    å®Ÿéš›ã«ç™ºç”Ÿã™ã‚‹å®šå¸¸æ³¢ã®è…¹ã®ä½ç½®ã¯ã€ç®¡ã®å£ã‚ˆã‚Šã‚‚<strong>å°‘ã—å¤–å´</strong>ã«ã‚ã‚Šã¾ã™ã€‚<br>
                    ã“ã®ã‚ºãƒ¬ã‚’<strong>é–‹å£ç«¯è£œæ­£ $\Delta x$</strong> ã¨ã„ã„ã¾ã™ã€‚
                </p>
            </div>
            
            <!-- é–‹å£ç«¯è£œæ­£ã®å¯è¦–åŒ– -->
            <div class="wave-visual">
                <div class="wave-visual-title">ğŸ“ é–‹å£ç«¯è£œæ­£ã®ã‚¤ãƒ¡ãƒ¼ã‚¸</div>
                <canvas id="endCorrectionCanvas" width="500" height="200"></canvas>
                <div class="demo-info" style="margin-top: 10px;">
                    å®Ÿéš›ã®è…¹ã®ä½ç½®ã¯ç®¡ã®å£ã‚ˆã‚Š Î”x ã ã‘å¤–å´ã«ã‚ã‚‹
                </div>
            </div>
            
            <p>
                ç®¡ã®é•·ã• $L$ ã«é–‹å£ç«¯è£œæ­£ $\Delta x$ ã‚’è¶³ã—ãŸã‚‚ã®ãŒã€å®ŸåŠ¹çš„ãªæ°—æŸ±ã®é•·ã•ã«ãªã‚Šã¾ã™ã€‚
            </p>
            
            <div class="formula-box">
                <h4>é–‹å£ç«¯è£œæ­£ã‚’å«ã‚€å¼</h4>
                <p>
                    é–‰ç®¡ã®å ´åˆï¼š$L + \Delta x = \dfrac{\lambda_1}{4}$<br><br>
                    é–‹ç®¡ã®å ´åˆï¼š$L + 2\Delta x = \dfrac{\lambda_1}{2}$<br>
                    <span style="font-size: 0.85em;">ï¼ˆé–‹ç®¡ã¯ä¸¡ç«¯ãŒé–‹ã„ã¦ã„ã‚‹ã®ã§ã€è£œæ­£ã¯2å€ï¼‰</span>
                </p>
            </div>
            
            <div class="note">
                <strong>ğŸ’¡ é–‹å£ç«¯è£œæ­£ã‚’æ±‚ã‚ã‚‹å®Ÿé¨“</strong><br>
                å…±é³´å®Ÿé¨“ã§2å›ã®å…±é³´ãŒèµ·ããŸã¨ãã€æ°—æŸ±ã®é•·ã•ã®å·®ã¯ $\dfrac{\lambda}{2}$ ã«ãªã‚Šã¾ã™ã€‚<br>
                ã“ã‚Œã‚’åˆ©ç”¨ã™ã‚‹ã¨ã€é–‹å£ç«¯è£œæ­£ $\Delta x$ ã‚’æ¶ˆå»ã—ã¦æ³¢é•·ã‚’æ±‚ã‚ã‚‰ã‚Œã¾ã™ï¼
            </div>
            
            <h3>5. å…±æŒ¯ãƒ»å…±é³´</h3>
            <p>
                ç‰©ä½“ãŒæŒã¤å›ºæœ‰æŒ¯å‹•æ•°ã¨<strong>åŒã˜æŒ¯å‹•æ•°</strong>ã®åŠ›ã‚’å¤–ã‹ã‚‰åŠ ãˆã‚‹ã¨ã€ãã®ç‰©ä½“ã¯å¤§ããæŒ¯å‹•ã—ã¾ã™ã€‚<br>
                ã“ã®ç¾è±¡ã‚’<strong>å…±æŒ¯</strong>ã¨ã„ã„ã€éŸ³ã«é–¢ã™ã‚‹å ´åˆã¯ç‰¹ã«<strong>å…±é³´</strong>ã¨ã„ã„ã¾ã™ã€‚
            </p>
            
            <div class="point-box">
                <h4>ğŸ”” å…±æŒ¯ã®ãƒã‚¤ãƒ³ãƒˆ</h4>
                <p>
                    ãƒ»å›ºæœ‰æŒ¯å‹•æ•°ã¨<strong>åŒã˜æŒ¯å‹•æ•°</strong>ã®å¤–åŠ›ã‚’åŠ ãˆã‚‹ã¨ã€æŒ¯å¹…ãŒå¤§ãããªã‚‹<br>
                    ãƒ»å›ºæœ‰æŒ¯å‹•æ•°ã¯ç‰©ä½“ã®<strong>é•·ã•ãƒ»å½¢ãƒ»æè³ª</strong>ã§æ±ºã¾ã‚‹<br>
                    ãƒ»åŒã˜å›ºæœ‰æŒ¯å‹•æ•°ã‚’æŒã¤ç‰©ä½“ã©ã†ã—ã¯ã€ä¸€æ–¹ãŒæŒ¯å‹•ã™ã‚‹ã¨ä»–æ–¹ã‚‚æŒ¯å‹•ã‚’å§‹ã‚ã‚‹
                </p>
            </div>
            
            <!-- å…±æŒ¯ãƒ‡ãƒ¢ï¼ˆæŒ¯ã‚Šå­ï¼‰ -->
            <div class="demo-container">
                <div class="wave-visual-title">ğŸ¯ å…±æŒ¯ã®ãƒ‡ãƒ¢ï¼ˆæŒ¯ã‚Šå­ã®å®Ÿé¨“ï¼‰</div>
                <p style="text-align: center; margin-bottom: 15px;">
                    ç³¸ã®é•·ã•ãŒåŒã˜æŒ¯ã‚Šå­ã ã‘ãŒå…±æŒ¯ã—ã¦å¤§ããæºã‚Œã¾ã™ã€‚<br>
                    é§†å‹•æŒ¯ã‚Šå­ï¼ˆèµ¤ï¼‰ã®é•·ã•ã‚’å¤‰ãˆã¦ã€ã©ã®æŒ¯ã‚Šå­ã¨å…±æŒ¯ã™ã‚‹ã‹è¦³å¯Ÿã—ã‚ˆã†ï¼
                </p>
                <canvas id="pendulumCanvas" width="650" height="320"></canvas>
                <div class="slider-control" style="margin-top: 15px;">
                    <label>é§†å‹•æŒ¯ã‚Šå­ã®é•·ã•:</label>
                    <input type="range" id="driverLengthSlider" min="1" max="5" value="3" step="1" onchange="updateDriverLength()">
                    <span class="slider-value" id="driverLengthValue">ä¸­</span>
                </div>
                <div class="button-group" style="justify-content: center; margin-top: 10px;">
                    <button class="sim-button start" id="pendulumStartBtn" onclick="togglePendulumAnimation()">æŒ¯ã‚Šå­ã‚’æºã‚‰ã™</button>
                    <button class="sim-button reset" onclick="resetPendulum()">ãƒªã‚»ãƒƒãƒˆ</button>
                </div>
                <div class="demo-info" style="margin-top: 10px;" id="pendulumInfo">
                    é§†å‹•æŒ¯ã‚Šå­ã¨åŒã˜é•·ã•ï¼ˆå›ºæœ‰æŒ¯å‹•æ•°ï¼‰ã®æŒ¯ã‚Šå­ã ã‘ãŒå…±æŒ¯ã—ã¾ã™
                </div>
            </div>
            
            <div class="note">
                <strong>ğŸ’¡ å…±é³´ã®ä¾‹</strong><br>
                ãƒ»ãŠã‚“ã•ã‚’é³´ã‚‰ã™ã¨ã€åŒã˜æŒ¯å‹•æ•°ã®ãŠã‚“ã•ã ã‘ãŒé³´ã‚Šå‡ºã™<br>
                ãƒ»ã‚°ãƒ©ã‚¹ã«ç‰¹å®šã®é«˜ã•ã®å£°ã‚’å½“ã¦ã‚‹ã¨ã€ã‚°ãƒ©ã‚¹ãŒå‰²ã‚Œã‚‹ã“ã¨ãŒã‚ã‚‹<br>
                ãƒ»æ©‹ã‚’æ­©ãäººã®è¶³ä¸¦ã¿ãŒæƒã†ã¨ã€æ©‹ãŒå¤§ããæºã‚Œã‚‹ï¼ˆã‚¿ã‚³ãƒæ©‹ã®å´©å£Šãªã©ï¼‰
            </div>
            
            <hr style="margin: 30px 0;">
            <h2>æˆæ¥­è³‡æ–™PDF</h2>
            <iframe src="https://drive.google.com/file/d/1rd3AUHNkj-NLM0IEztEdsiVOdPwxD6EA/preview" width="100%" height="500"></iframe>
        </div>
        
        <!-- ========== å•é¡Œã‚¿ãƒ– ========== -->
        <div id="problem" class="tab-content">
            <h2>ç¢ºèªå•é¡Œ</h2>
            
            <div class="problem">
                <h4>å•é¡Œ1ï¼šå¼¦ã®æŒ¯å‹•</h4>
                <p>
                    é•·ã•ãŒ $0.60$ m ã®å¼¦ãŒåŸºæœ¬æŒ¯å‹•ã€2å€æŒ¯å‹•ã€3å€æŒ¯å‹•ã™ã‚‹ã¨ãã®æ³¢é•· $\lambda_1$ã€$\lambda_2$ã€$\lambda_3$ ã‚’ãã‚Œãã‚Œæ±‚ã‚ã‚ˆã€‚<br>
                    ã¾ãŸã€å¼¦ã‚’ä¼ã‚ã‚‹æ³¢ã®é€Ÿã•ã‚’ $120$ m/s ã¨ã™ã‚‹ã¨ãã€ãã‚Œãã‚Œã®å ´åˆã®å›ºæœ‰æŒ¯å‹•æ•° $f_1$ã€$f_2$ã€$f_3$ ã‚’æ±‚ã‚ã‚ˆã€‚
                </p>
                <details>
                    <summary>è§£ç­”ãƒ»è§£èª¬ã‚’è¦‹ã‚‹</summary>
                    <div class="answer">
                        <p><strong>ã€æ³¢é•·ã®è¨ˆç®—ã€‘</strong></p>
                        <p>å¼¦ã¯ä¸¡ç«¯ãŒç¯€ã«ãªã‚‹ã®ã§ã€$L = \dfrac{n\lambda_n}{2}$ ã‚ˆã‚Š $\lambda_n = \dfrac{2L}{n}$</p>
                        <p>
                            ãƒ»åŸºæœ¬æŒ¯å‹•ï¼ˆ$n=1$ï¼‰ï¼š$\lambda_1 = \dfrac{2 \times 0.60}{1} = 1.2$ m<br>
                            ãƒ»2å€æŒ¯å‹•ï¼ˆ$n=2$ï¼‰ï¼š$\lambda_2 = \dfrac{2 \times 0.60}{2} = 0.60$ m<br>
                            ãƒ»3å€æŒ¯å‹•ï¼ˆ$n=3$ï¼‰ï¼š$\lambda_3 = \dfrac{2 \times 0.60}{3} = 0.40$ m
                        </p>
                        <p><strong>ã€æŒ¯å‹•æ•°ã®è¨ˆç®—ã€‘</strong></p>
                        <p>$v = f\lambda$ ã‚ˆã‚Š $f = \dfrac{v}{\lambda}$</p>
                        <p>
                            ãƒ»$f_1 = \dfrac{120}{1.2} = 100$ Hz<br>
                            ãƒ»$f_2 = \dfrac{120}{0.60} = 200$ Hz<br>
                            ãƒ»$f_3 = \dfrac{120}{0.40} = 300$ Hz
                        </p>
                        <p style="color: #667eea;"><strong>ãƒã‚¤ãƒ³ãƒˆï¼š</strong>æŒ¯å‹•æ•°ã¯åŸºæœ¬æŒ¯å‹•æ•°ã®æ•´æ•°å€ï¼ˆ$f_n = nf_1$ï¼‰ã«ãªã£ã¦ã„ã‚‹ï¼</p>
                    </div>
                </details>
            </div>
            
            <div class="problem">
                <h4>å•é¡Œ2ï¼šé–‰ç®¡ã®æ°—æŸ±å…±é³´</h4>
                <p>
                    é•·ã•ãŒ $0.60$ m ã®é–‰ç®¡å†…ã®æ°—æŸ±ãŒã‚ã‚‹æŒ¯å‹•æ•°ã®éŸ³ã§å…±é³´ã—ãŸã€‚ã“ã®ã¨ãã€ç®¡ã®åº•ä»¥å¤–ã«å®šåœ¨æ³¢ã®ç¯€ãŒ1ã‹æ‰€ã‚ã£ãŸã€‚<br>
                    éŸ³ã®é€Ÿã•ã‚’ $340$ m/s ã¨ã—ã€é–‹å£ç«¯è£œæ­£ã¯ç„¡è¦–ã™ã‚‹ã€‚
                </p>
                <p>
                    (1) é–‰ç®¡å†…ã«ã§ãã‚‹å®šåœ¨æ³¢ã®ã‚ˆã†ã™ã‚’å›³ç¤ºã›ã‚ˆã€‚<br>
                    (2) æ°—æŸ±å†…ã®éŸ³æ³¢ã®æ³¢é•· $\lambda$ ã¯ä½• m ã‹ã€‚<br>
                    (3) æ°—æŸ±å†…ã®éŸ³æ³¢ã®æŒ¯å‹•æ•° $f$ ã¯ä½• Hz ã‹ã€‚
                </p>
                <details>
                    <summary>è§£ç­”ãƒ»è§£èª¬ã‚’è¦‹ã‚‹</summary>
                    <div class="answer">
                        <p><strong>ã€(1) å®šåœ¨æ³¢ã®å›³ã€‘</strong></p>
                        <p>é–‰ç®¡ã¯ã€Œå£ãŒè…¹ã€åº•ãŒç¯€ã€ã€‚åº•ä»¥å¤–ã«ç¯€ãŒ1ã‹æ‰€ã‚ã‚‹ã®ã§ã€ã“ã‚Œã¯<strong>3å€æŒ¯å‹•</strong>ã€‚<br>ç®¡ã®ä¸­ã« $\dfrac{3}{4}\lambda$ ãŒå…¥ã£ã¦ã„ã‚‹çŠ¶æ…‹ã€‚</p>
                        <p><strong>ã€(2) æ³¢é•·ã®è¨ˆç®—ã€‘</strong></p>
                        <p>$L = \dfrac{3\lambda}{4}$ ã‚ˆã‚Š<br>$0.60 = \dfrac{3\lambda}{4}$<br>$\lambda = \dfrac{0.60 \times 4}{3} = 0.80$ m</p>
                        <p><strong>ã€(3) æŒ¯å‹•æ•°ã®è¨ˆç®—ã€‘</strong></p>
                        <p>$f = \dfrac{v}{\lambda} = \dfrac{340}{0.80} = 425$ Hz</p>
                    </div>
                </details>
            </div>
            
            <div class="problem">
                <h4>å•é¡Œ3ï¼šæ°—æŸ±å…±é³´ã¨é–‹å£ç«¯è£œæ­£</h4>
                <p>
                    å…±é³´å®Ÿé¨“ã§ã€$500$ Hz ã®ãŠã‚“ã•ã‚’ç®¡å£ã«è¿‘ã¥ã‘ã€æ°´é¢ã‚’æ¬¡ç¬¬ã«ä¸‹ã’ã¦ã„ã£ãŸã¨ã“ã‚ã€æ°—æŸ±ã®é•·ã•ãŒ $16.4$ cm ã®ã¨ãã«åˆã‚ã¦å…±é³´ãŒèµ·ã“ã‚Šã€æ¬¡ã« $50.2$ cm ã«ãªã£ãŸã¨ãå†ã³å…±é³´ãŒèµ·ã“ã£ãŸã€‚
                </p>
                <p>
                    (1) ã“ã®ã¨ãã®éŸ³ã®é€Ÿã• $V$ ã¯ä½• m/s ã‹ã€‚<br>
                    (2) é–‹å£ç«¯è£œæ­£ $\Delta x$ ã¯ä½• cm ã‹ã€‚
                </p>
                <details>
                    <summary>è§£ç­”ãƒ»è§£èª¬ã‚’è¦‹ã‚‹</summary>
                    <div class="answer">
                        <p><strong>ã€è€ƒãˆæ–¹ã€‘</strong></p>
                        <p>ã“ã‚Œã¯é–‰ç®¡ã®å…±é³´å®Ÿé¨“ã€‚æœ€åˆã®å…±é³´ã¯åŸºæœ¬æŒ¯å‹•ã€2å›ç›®ã¯3å€æŒ¯å‹•ã€‚</p>
                        <p><strong>ã€(1) éŸ³ã®é€Ÿã•ã€‘</strong></p>
                        <p>2å›ã®å…±é³´ã®æ°—æŸ±ã®é•·ã•ã®å·®ã¯ $\dfrac{\lambda}{2}$ ã«ãªã‚‹ï¼š<br>$(50.2 - 16.4) = \dfrac{\lambda}{2}$<br>$33.8 = \dfrac{\lambda}{2}$<br>$\lambda = 67.6$ cm $= 0.676$ m</p>
                        <p>$V = f\lambda = 500 \times 0.676 = 338$ m/s</p>
                        <p><strong>ã€(2) é–‹å£ç«¯è£œæ­£ã€‘</strong></p>
                        <p>$\Delta x = \dfrac{\lambda}{4} - 16.4 = \dfrac{67.6}{4} - 16.4 = 16.9 - 16.4 = 0.5$ cm</p>
                    </div>
                </details>
            </div>
        </div>
        
        <!-- ========== ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¿ãƒ– ========== -->
        <div id="simulation" class="tab-content">
            <h2>å®Ÿé¨“ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h2>
            
            <!-- å¼¦ã®æŒ¯å‹•ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ -->
            <div class="sim-section">
                <h3>ğŸ¸ å¼¦ã®æŒ¯å‹•ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h3>
                <p>ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ã®æŒ¯å‹•æ•°ã‚’å¤‰ãˆã¦ã€å¼¦ãŒå…±é³´ã™ã‚‹æ§˜å­ã‚’è¦³å¯Ÿã—ã¾ã—ã‚‡ã†ã€‚å›ºæœ‰æŒ¯å‹•æ•°ã«ä¸€è‡´ã™ã‚‹ã¨å®šå¸¸æ³¢ãŒã§ãã¾ã™ï¼</p>
                
                <div id="sim-container">
                    <canvas id="stringCanvas"></canvas>
                </div>
                
                <div class="sim-controls">
                    <div class="control-group">
                        <label>å¼¦ã®é•·ã• L: <span class="value-display" id="stringLengthDisplay">1.0 m</span></label>
                        <input type="range" id="stringLengthSlider" min="0.5" max="2.0" value="1.0" step="0.1">
                    </div>
                    
                    <div class="control-group">
                        <label>
                            ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ã®æŒ¯å‹•æ•° f: <span class="value-display" id="freqDisplay">100 Hz</span>
                            <span class="resonance-indicator not-resonating" id="resonanceIndicator">éå…±é³´</span>
                        </label>
                        <input type="range" id="freqSlider" min="50" max="500" value="100" step="1">
                    </div>
                    
                    <div class="control-group">
                        <label>å¼¦ã®å¼µåŠ›ï¼ˆæ³¢ã®é€Ÿã•ã«å½±éŸ¿ï¼‰: <span class="value-display" id="tensionDisplay">200 m/s</span></label>
                        <input type="range" id="tensionSlider" min="100" max="400" value="200" step="10">
                    </div>
                    
                    <div class="button-group">
                        <button class="sim-button start" id="stringStartBtn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
                        <button class="sim-button reset" id="stringResetBtn">ãƒªã‚»ãƒƒãƒˆ</button>
                    </div>
                    
                    <div class="info-display">
                        <p><strong>è¨ˆç®—å€¤</strong></p>
                        <p id="stringInfo1">åŸºæœ¬æŒ¯å‹•æ•° fâ‚ = 100.0 Hz</p>
                        <p id="stringInfo2">ç¾åœ¨ã®æŒ¯å‹•: å…±é³´ã—ã¦ã„ã¾ã›ã‚“</p>
                        <p id="stringInfo3">å›ºæœ‰æŒ¯å‹•æ•°: fâ‚=100Hz, fâ‚‚=200Hz, fâ‚ƒ=300Hz, ...</p>
                    </div>
                </div>
            </div>
            
            <!-- æ°—æŸ±ã®æŒ¯å‹•ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ -->
            <div class="sim-section">
                <h3>ğŸº æ°—æŸ±ã®æŒ¯å‹•ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h3>
                <p>é–‰ç®¡ã¨é–‹ç®¡ã‚’åˆ‡ã‚Šæ›¿ãˆã¦ã€å®šå¸¸æ³¢ã®ã§ãæ–¹ã®é•ã„ã‚’è¦³å¯Ÿã—ã¾ã—ã‚‡ã†ã€‚</p>
                
                <div class="mode-toggle">
                    <button class="mode-btn active" id="closedPipeBtn" onclick="setPipeMode('closed')">é–‰ç®¡ï¼ˆä¸€ç«¯ãŒé–‰ï¼‰</button>
                    <button class="mode-btn" id="openPipeBtn" onclick="setPipeMode('open')">é–‹ç®¡ï¼ˆä¸¡ç«¯ãŒé–‹ï¼‰</button>
                </div>
                
                <div id="sim-container2">
                    <canvas id="pipeCanvas"></canvas>
                </div>
                
                <div class="sim-controls">
                    <div class="control-group">
                        <label>ç®¡ã®é•·ã• L: <span class="value-display" id="pipeLengthDisplay">0.5 m</span></label>
                        <input type="range" id="pipeLengthSlider" min="0.2" max="1.0" value="0.5" step="0.05">
                    </div>
                    
                    <div class="control-group">
                        <label>å€æŒ¯å‹•æ•° n: <span class="value-display" id="harmonicDisplay">1 å€æŒ¯å‹•</span></label>
                        <input type="range" id="harmonicSlider" min="1" max="7" value="1" step="1">
                    </div>
                    
                    <div class="control-group">
                        <label><input type="checkbox" id="showLongitudinalCheck"> ç¸¦æ³¢è¡¨ç¤ºã‚‚åŒæ™‚ã«è¦‹ã‚‹</label>
                    </div>
                    
                    <div class="button-group">
                        <button class="sim-button start" id="pipeStartBtn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
                        <button class="sim-button reset" id="pipeResetBtn">ãƒªã‚»ãƒƒãƒˆ</button>
                    </div>
                    
                    <div class="info-display">
                        <p><strong>è¨ˆç®—å€¤ï¼ˆéŸ³é€Ÿ V = 340 m/sï¼‰</strong></p>
                        <p id="pipeInfo1">ç®¡ã®ç¨®é¡: é–‰ç®¡</p>
                        <p id="pipeInfo2">æ³¢é•· Î» = 2.00 m</p>
                        <p id="pipeInfo3">æŒ¯å‹•æ•° f = 170 Hz</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
    // ===== ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½ =====
    function openTab(tabName) {
        var contents = document.getElementsByClassName("tab-content");
        for (var i = 0; i < contents.length; i++) {
            contents[i].style.display = "none";
            contents[i].classList.remove("active");
        }
        var buttons = document.getElementsByClassName("tab-btn");
        for (var i = 0; i < buttons.length; i++) {
            buttons[i].classList.remove("active");
        }
        document.getElementById(tabName).style.display = "block";
        document.getElementById(tabName).classList.add("active");
        if (event) event.currentTarget.classList.add("active");
        if (tabName === 'simulation') {
            resizeCanvases();
            drawStringSimulation();
            drawPipe();
        }
    }

    // ===== å›ºæœ‰æŒ¯å‹•ãƒ‡ãƒ¢ =====
    const demoCanvas = document.getElementById('demoCanvas');
    const demoCtx = demoCanvas.getContext('2d');
    let selectedDemo = 'house';
    let demoAnimating = false;
    let demoTime = 0;
    let demoAnimationId = null;
    
    const demoData = {
        house: { name: 'ä¸€æˆ¸å»ºã¦', frequency: 6, amplitude: 10, info: 'å›ºæœ‰æŒ¯å‹•æ•°ãŒé«˜ã„ â†’ é€Ÿãå°åˆ»ã¿ã«æºã‚Œã‚‹' },
        tower: { name: 'é«˜å±¤ãƒ“ãƒ«', frequency: 0.8, amplitude: 30, info: 'å›ºæœ‰æŒ¯å‹•æ•°ãŒä½ã„ â†’ ã‚†ã£ãã‚Šå¤§ããæºã‚Œã‚‹' },
        swing: { name: 'ãƒ–ãƒ©ãƒ³ã‚³', frequency: 1.2, amplitude: 45, info: 'ä¹—ã‚‹äººã®ä½“é‡ã«é–¢ä¿‚ãªãã€æºã‚Œæ–¹ï¼ˆå‘¨æœŸï¼‰ã¯åŒã˜' },
        sandbag: { name: 'ã‚µãƒ³ãƒ‰ãƒãƒƒã‚°', frequency: 1.5, amplitude: 35, info: 'å©ãå¼·ã•ã§ã¯ãªãã€ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒå¤§äº‹' }
    };
    
    function selectDemo(type, btn) {
        selectedDemo = type;
        document.querySelectorAll('.demo-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById('demoInfo').textContent = demoData[type].info;
        drawDemo();
    }
    
    function drawDemo() {
        const W = demoCanvas.width;
        const H = demoCanvas.height;
        const data = demoData[selectedDemo];
        
        demoCtx.fillStyle = '#e8f4fc';
        demoCtx.fillRect(0, 0, W, H);
        
        // åœ°é¢
        demoCtx.fillStyle = '#8B7355';
        demoCtx.fillRect(0, H - 25, W, 25);
        demoCtx.fillStyle = '#228B22';
        demoCtx.fillRect(0, H - 30, W, 8);
        
        const baseX = W / 2;
        const baseY = H - 30;
        let sway = demoAnimating ? Math.sin(demoTime * data.frequency * 0.1) * data.amplitude : 0;
        
        if (selectedDemo === 'house') {
            // ä¸€æˆ¸å»ºã¦
            const houseW = 80, houseH = 70;
            const houseX = baseX - houseW/2 + sway * 0.3;
            const houseY = baseY - houseH;
            
            demoCtx.fillStyle = '#DEB887';
            demoCtx.fillRect(houseX, houseY, houseW, houseH);
            
            // å±‹æ ¹
            demoCtx.fillStyle = '#8B4513';
            demoCtx.beginPath();
            demoCtx.moveTo(houseX - 10 + sway * 0.5, houseY);
            demoCtx.lineTo(baseX + sway * 0.5, houseY - 35);
            demoCtx.lineTo(houseX + houseW + 10 + sway * 0.5, houseY);
            demoCtx.closePath();
            demoCtx.fill();
            
            // çª“ã¨ãƒ‰ã‚¢
            demoCtx.fillStyle = '#87CEEB';
            demoCtx.fillRect(houseX + 15, houseY + 15, 20, 20);
            demoCtx.fillRect(houseX + 45, houseY + 15, 20, 20);
            demoCtx.fillStyle = '#8B4513';
            demoCtx.fillRect(houseX + 30, houseY + 40, 20, 30);
            
        } else if (selectedDemo === 'tower') {
            // é«˜å±¤ãƒ“ãƒ«
            const towerW = 50, towerH = 180;
            const floors = 12;
            const floorH = towerH / floors;
            
            for (let f = 0; f < floors; f++) {
                const floorRatio = (f + 1) / floors;
                const floorSway = sway * floorRatio;
                const floorX = baseX - towerW/2 + floorSway;
                const floorY = baseY - (f + 1) * floorH;
                
                demoCtx.fillStyle = '#4682B4';
                demoCtx.fillRect(floorX, floorY, towerW, floorH - 1);
                
                // çª“
                demoCtx.fillStyle = '#87CEEB';
                for (let w = 0; w < 3; w++) {
                    demoCtx.fillRect(floorX + 8 + w * 15, floorY + 3, 10, 8);
                }
            }
            
        } else if (selectedDemo === 'swing') {
            // ãƒ–ãƒ©ãƒ³ã‚³
            const pivotX = baseX;
            const pivotY = 50;
            const ropeLength = 150;
            const angle = sway * Math.PI / 180;
            
            // æ”¯æŸ±
            demoCtx.strokeStyle = '#555';
            demoCtx.lineWidth = 6;
            demoCtx.beginPath();
            demoCtx.moveTo(baseX - 60, baseY);
            demoCtx.lineTo(baseX - 30, pivotY);
            demoCtx.lineTo(baseX + 30, pivotY);
            demoCtx.lineTo(baseX + 60, baseY);
            demoCtx.stroke();
            demoCtx.beginPath();
            demoCtx.moveTo(baseX - 30, pivotY);
            demoCtx.lineTo(baseX + 30, pivotY);
            demoCtx.stroke();
            
            // ãƒ­ãƒ¼ãƒ—ã¨åº§å¸­
            const seatX = pivotX + Math.sin(angle) * ropeLength;
            const seatY = pivotY + Math.cos(angle) * ropeLength;
            
            demoCtx.strokeStyle = '#8B4513';
            demoCtx.lineWidth = 3;
            demoCtx.beginPath();
            demoCtx.moveTo(pivotX - 15, pivotY);
            demoCtx.lineTo(seatX - 15, seatY);
            demoCtx.moveTo(pivotX + 15, pivotY);
            demoCtx.lineTo(seatX + 15, seatY);
            demoCtx.stroke();
            
            // åº§å¸­
            demoCtx.fillStyle = '#8B4513';
            demoCtx.fillRect(seatX - 20, seatY, 40, 8);
            
            // äºº
            demoCtx.fillStyle = '#FFB6C1';
            demoCtx.beginPath();
            demoCtx.arc(seatX, seatY - 25, 12, 0, Math.PI * 2);
            demoCtx.fill();
            demoCtx.fillStyle = '#4169E1';
            demoCtx.fillRect(seatX - 8, seatY - 13, 16, 20);
            
        } else if (selectedDemo === 'sandbag') {
            // ã‚µãƒ³ãƒ‰ãƒãƒƒã‚°
            const pivotX = baseX;
            const pivotY = 40;
            const chainLength = 80;
            const angle = sway * Math.PI / 180 * 0.8;
            
            // å¤©äº•/ãƒ•ãƒ¬ãƒ¼ãƒ 
            demoCtx.fillStyle = '#555';
            demoCtx.fillRect(baseX - 80, 30, 160, 15);
            
            // ãƒã‚§ãƒ¼ãƒ³
            const bagX = pivotX + Math.sin(angle) * chainLength;
            const bagY = pivotY + Math.cos(angle) * chainLength;
            
            demoCtx.strokeStyle = '#888';
            demoCtx.lineWidth = 4;
            demoCtx.setLineDash([5, 3]);
            demoCtx.beginPath();
            demoCtx.moveTo(pivotX, pivotY);
            demoCtx.lineTo(bagX, bagY);
            demoCtx.stroke();
            demoCtx.setLineDash([]);
            
            // ã‚µãƒ³ãƒ‰ãƒãƒƒã‚°
            demoCtx.fillStyle = '#8B0000';
            demoCtx.beginPath();
            demoCtx.ellipse(bagX, bagY + 50, 30, 55, 0, 0, Math.PI * 2);
            demoCtx.fill();
            demoCtx.fillStyle = '#A52A2A';
            demoCtx.beginPath();
            demoCtx.ellipse(bagX, bagY + 50, 25, 50, 0, 0, Math.PI * 2);
            demoCtx.fill();
            
            // ãƒ‘ãƒ³ãƒã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
            if (demoAnimating && Math.abs(sway) > data.amplitude * 0.8) {
                demoCtx.fillStyle = '#FFD700';
                demoCtx.font = 'bold 20px sans-serif';
                demoCtx.fillText('ğŸ’¥', bagX + (sway > 0 ? -50 : 30), bagY + 30);
            }
        }
        
        // ã‚¿ã‚¤ãƒˆãƒ«
        demoCtx.fillStyle = '#333';
        demoCtx.font = 'bold 16px sans-serif';
        demoCtx.textAlign = 'center';
        demoCtx.fillText(data.name, W/2, 22);
    }
    
    function toggleDemoAnimation() {
        if (demoAnimating) {
            demoAnimating = false;
            document.getElementById('demoStartBtn').textContent = 'æºã‚‰ã™ï¼';
            cancelAnimationFrame(demoAnimationId);
        } else {
            demoAnimating = true;
            document.getElementById('demoStartBtn').textContent = 'åœæ­¢';
            animateDemo();
        }
    }
    
    function animateDemo() {
        if (!demoAnimating) return;
        demoTime++;
        drawDemo();
        demoAnimationId = requestAnimationFrame(animateDemo);
    }

    // ===== å¼¦ã®å®šå¸¸æ³¢å¯è¦–åŒ– =====
    const stringWaveCanvas = document.getElementById('stringWaveCanvas');
    const stringWaveCtx = stringWaveCanvas.getContext('2d');
    let currentStringHarmonic = 1;
    
    function setStringHarmonic(n, btn) {
        currentStringHarmonic = n;
        document.querySelectorAll('#stringWaveControls .wave-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const infoTexts = {
            1: 'åŸºæœ¬æŒ¯å‹•: L = Î»â‚/2 â†’ Î»â‚ = 2L ï¼ˆå¼¦ã®ä¸­ã«åŠæ³¢é•·ãŒ1å€‹å…¥ã‚‹ï¼‰',
            2: '2å€æŒ¯å‹•: L = Î»â‚‚ â†’ Î»â‚‚ = L ï¼ˆå¼¦ã®ä¸­ã«åŠæ³¢é•·ãŒ2å€‹å…¥ã‚‹ï¼‰',
            3: '3å€æŒ¯å‹•: L = 3Î»â‚ƒ/2 â†’ Î»â‚ƒ = 2L/3 ï¼ˆå¼¦ã®ä¸­ã«åŠæ³¢é•·ãŒ3å€‹å…¥ã‚‹ï¼‰',
            4: '4å€æŒ¯å‹•: L = 2Î»â‚„ â†’ Î»â‚„ = L/2 ï¼ˆå¼¦ã®ä¸­ã«åŠæ³¢é•·ãŒ4å€‹å…¥ã‚‹ï¼‰'
        };
        document.getElementById('stringWaveInfo').textContent = infoTexts[n];
        drawStringWave();
    }
    
    function drawStringWave() {
        const W = stringWaveCanvas.width;
        const H = stringWaveCanvas.height;
        const n = currentStringHarmonic;
        
        stringWaveCtx.fillStyle = '#fafafa';
        stringWaveCtx.fillRect(0, 0, W, H);
        
        const margin = 60;
        const stringY = H / 2;
        const stringStartX = margin;
        const stringEndX = W - margin;
        const stringLength = stringEndX - stringStartX;
        const amplitude = 50;
        
        // å£
        stringWaveCtx.fillStyle = '#555';
        stringWaveCtx.fillRect(stringStartX - 15, stringY - 40, 15, 80);
        stringWaveCtx.fillRect(stringEndX, stringY - 40, 15, 80);
        
        // é™æ­¢ä½ç½®
        stringWaveCtx.strokeStyle = '#ccc';
        stringWaveCtx.lineWidth = 1;
        stringWaveCtx.setLineDash([5, 5]);
        stringWaveCtx.beginPath();
        stringWaveCtx.moveTo(stringStartX, stringY);
        stringWaveCtx.lineTo(stringEndX, stringY);
        stringWaveCtx.stroke();
        stringWaveCtx.setLineDash([]);
        
        // åŒ…çµ¡ç·š
        stringWaveCtx.strokeStyle = '#e53935';
        stringWaveCtx.lineWidth = 1;
        stringWaveCtx.setLineDash([5, 5]);
        stringWaveCtx.beginPath();
        for (let px = 0; px <= stringLength; px++) {
            const x = stringStartX + px;
            const ratio = px / stringLength;
            const envelope = Math.abs(Math.sin(n * Math.PI * ratio));
            const y = stringY - amplitude * envelope;
            if (px === 0) stringWaveCtx.moveTo(x, y);
            else stringWaveCtx.lineTo(x, y);
        }
        stringWaveCtx.stroke();
        stringWaveCtx.beginPath();
        for (let px = 0; px <= stringLength; px++) {
            const x = stringStartX + px;
            const ratio = px / stringLength;
            const envelope = Math.abs(Math.sin(n * Math.PI * ratio));
            const y = stringY + amplitude * envelope;
            if (px === 0) stringWaveCtx.moveTo(x, y);
            else stringWaveCtx.lineTo(x, y);
        }
        stringWaveCtx.stroke();
        stringWaveCtx.setLineDash([]);
        
        // æ³¢å½¢
        stringWaveCtx.strokeStyle = '#e53935';
        stringWaveCtx.lineWidth = 3;
        stringWaveCtx.beginPath();
        for (let px = 0; px <= stringLength; px++) {
            const x = stringStartX + px;
            const ratio = px / stringLength;
            const y = stringY - amplitude * Math.sin(n * Math.PI * ratio);
            if (px === 0) stringWaveCtx.moveTo(x, y);
            else stringWaveCtx.lineTo(x, y);
        }
        stringWaveCtx.stroke();
        
        // ç¯€
        stringWaveCtx.fillStyle = '#2196F3';
        for (let i = 0; i <= n; i++) {
            const nodeX = stringStartX + (i / n) * stringLength;
            stringWaveCtx.beginPath();
            stringWaveCtx.arc(nodeX, stringY, 8, 0, Math.PI * 2);
            stringWaveCtx.fill();
        }
        
        // è…¹
        stringWaveCtx.fillStyle = '#4CAF50';
        for (let i = 0; i < n; i++) {
            const antiNodeRatio = (i + 0.5) / n;
            const antiNodeX = stringStartX + antiNodeRatio * stringLength;
            const antiNodeY = stringY - amplitude * Math.sin(n * Math.PI * antiNodeRatio);
            stringWaveCtx.beginPath();
            stringWaveCtx.arc(antiNodeX, antiNodeY, 8, 0, Math.PI * 2);
            stringWaveCtx.fill();
        }
        
        // é•·ã•è¡¨ç¤º
        stringWaveCtx.strokeStyle = '#667eea';
        stringWaveCtx.lineWidth = 2;
        stringWaveCtx.beginPath();
        stringWaveCtx.moveTo(stringStartX, stringY + 70);
        stringWaveCtx.lineTo(stringEndX, stringY + 70);
        stringWaveCtx.stroke();
        stringWaveCtx.fillStyle = '#667eea';
        stringWaveCtx.beginPath();
        stringWaveCtx.moveTo(stringStartX, stringY + 70);
        stringWaveCtx.lineTo(stringStartX + 10, stringY + 65);
        stringWaveCtx.lineTo(stringStartX + 10, stringY + 75);
        stringWaveCtx.closePath();
        stringWaveCtx.fill();
        stringWaveCtx.beginPath();
        stringWaveCtx.moveTo(stringEndX, stringY + 70);
        stringWaveCtx.lineTo(stringEndX - 10, stringY + 65);
        stringWaveCtx.lineTo(stringEndX - 10, stringY + 75);
        stringWaveCtx.closePath();
        stringWaveCtx.fill();
        stringWaveCtx.font = '14px sans-serif';
        stringWaveCtx.textAlign = 'center';
        stringWaveCtx.fillText('L', (stringStartX + stringEndX) / 2, stringY + 90);
        
        // å‡¡ä¾‹
        stringWaveCtx.font = '12px sans-serif';
        stringWaveCtx.textAlign = 'left';
        stringWaveCtx.fillStyle = '#4CAF50';
        stringWaveCtx.fillText('â— è…¹', 10, 20);
        stringWaveCtx.fillStyle = '#2196F3';
        stringWaveCtx.fillText('â— ç¯€', 10, 38);
        stringWaveCtx.fillStyle = '#764ba2';
        stringWaveCtx.font = 'bold 14px sans-serif';
        stringWaveCtx.textAlign = 'center';
        stringWaveCtx.fillText(`Î»/2 ãŒ ${n} å€‹å…¥ã‚‹`, (stringStartX + stringEndX) / 2, 25);
    }

    // ===== åˆæˆæ³¢ãƒ‡ãƒ¢ =====
    const compositeWaveCanvas = document.getElementById('compositeWaveCanvas');
    const compositeWaveCtx = compositeWaveCanvas.getContext('2d');
    let compositeAnimating = false;
    let compositeTime = 0;
    let compositeAnimationId = null;
    
    function updateCompositeWave() {
        document.getElementById('amp1Value').textContent = document.getElementById('amp1Slider').value + '%';
        document.getElementById('amp2Value').textContent = document.getElementById('amp2Slider').value + '%';
        document.getElementById('amp3Value').textContent = document.getElementById('amp3Slider').value + '%';
        document.getElementById('amp4Value').textContent = document.getElementById('amp4Slider').value + '%';
        drawCompositeWave();
    }
    
    function drawCompositeWave() {
        const W = compositeWaveCanvas.width;
        const H = compositeWaveCanvas.height;
        
        compositeWaveCtx.fillStyle = '#fafafa';
        compositeWaveCtx.fillRect(0, 0, W, H);
        
        const margin = 60;
        const centerY = H / 2;
        const startX = margin;
        const endX = W - margin;
        const length = endX - startX;
        const maxAmp = 60;
        
        // å£
        compositeWaveCtx.fillStyle = '#555';
        compositeWaveCtx.fillRect(startX - 15, centerY - 50, 15, 100);
        compositeWaveCtx.fillRect(endX, centerY - 50, 15, 100);
        
        // é™æ­¢ä½ç½®
        compositeWaveCtx.strokeStyle = '#ccc';
        compositeWaveCtx.lineWidth = 1;
        compositeWaveCtx.setLineDash([5, 5]);
        compositeWaveCtx.beginPath();
        compositeWaveCtx.moveTo(startX, centerY);
        compositeWaveCtx.lineTo(endX, centerY);
        compositeWaveCtx.stroke();
        compositeWaveCtx.setLineDash([]);
        
        // å„æˆåˆ†ã®æŒ¯å¹…
        const h1 = document.getElementById('harm1Check').checked ? document.getElementById('amp1Slider').value / 100 : 0;
        const h2 = document.getElementById('harm2Check').checked ? document.getElementById('amp2Slider').value / 100 : 0;
        const h3 = document.getElementById('harm3Check').checked ? document.getElementById('amp3Slider').value / 100 : 0;
        const h4 = document.getElementById('harm4Check').checked ? document.getElementById('amp4Slider').value / 100 : 0;
        
        const timePhase = compositeAnimating ? compositeTime * 0.08 : 0;
        
        // å„æˆåˆ†ã‚’è–„ãæç”»
        const colors = ['rgba(33, 150, 243, 0.4)', 'rgba(76, 175, 80, 0.4)', 'rgba(255, 152, 0, 0.4)', 'rgba(156, 39, 176, 0.4)'];
        const harmonics = [h1, h2, h3, h4];
        
        for (let n = 1; n <= 4; n++) {
            if (harmonics[n-1] > 0) {
                compositeWaveCtx.strokeStyle = colors[n-1];
                compositeWaveCtx.lineWidth = 1.5;
                compositeWaveCtx.beginPath();
                for (let px = 0; px <= length; px++) {
                    const x = startX + px;
                    const ratio = px / length;
                    const y = centerY - maxAmp * harmonics[n-1] * Math.sin(n * Math.PI * ratio) * Math.cos(n * timePhase);
                    if (px === 0) compositeWaveCtx.moveTo(x, y);
                    else compositeWaveCtx.lineTo(x, y);
                }
                compositeWaveCtx.stroke();
            }
        }
        
        // åˆæˆæ³¢
        compositeWaveCtx.strokeStyle = '#e53935';
        compositeWaveCtx.lineWidth = 3;
        compositeWaveCtx.beginPath();
        for (let px = 0; px <= length; px++) {
            const x = startX + px;
            const ratio = px / length;
            let y = centerY;
            for (let n = 1; n <= 4; n++) {
                y -= maxAmp * harmonics[n-1] * Math.sin(n * Math.PI * ratio) * Math.cos(n * timePhase);
            }
            if (px === 0) compositeWaveCtx.moveTo(x, y);
            else compositeWaveCtx.lineTo(x, y);
        }
        compositeWaveCtx.stroke();
        
        // å‡¡ä¾‹
        compositeWaveCtx.font = '11px sans-serif';
        compositeWaveCtx.textAlign = 'left';
        compositeWaveCtx.fillStyle = 'rgba(33, 150, 243, 0.8)';
        compositeWaveCtx.fillText('â€• åŸºæœ¬æŒ¯å‹•', 10, 18);
        compositeWaveCtx.fillStyle = 'rgba(76, 175, 80, 0.8)';
        compositeWaveCtx.fillText('â€• 2å€æŒ¯å‹•', 10, 33);
        compositeWaveCtx.fillStyle = 'rgba(255, 152, 0, 0.8)';
        compositeWaveCtx.fillText('â€• 3å€æŒ¯å‹•', 10, 48);
        compositeWaveCtx.fillStyle = 'rgba(156, 39, 176, 0.8)';
        compositeWaveCtx.fillText('â€• 4å€æŒ¯å‹•', 10, 63);
        compositeWaveCtx.fillStyle = '#e53935';
        compositeWaveCtx.font = 'bold 12px sans-serif';
        compositeWaveCtx.fillText('â” åˆæˆæ³¢', 10, 80);
    }
    
    function toggleCompositeAnimation() {
        if (compositeAnimating) {
            compositeAnimating = false;
            document.getElementById('compositeStartBtn').textContent = 'ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹';
            cancelAnimationFrame(compositeAnimationId);
        } else {
            compositeAnimating = true;
            document.getElementById('compositeStartBtn').textContent = 'åœæ­¢';
            animateComposite();
        }
    }
    
    function animateComposite() {
        if (!compositeAnimating) return;
        compositeTime++;
        drawCompositeWave();
        compositeAnimationId = requestAnimationFrame(animateComposite);
    }

    // ===== é–‰ç®¡ã®å®šå¸¸æ³¢å¯è¦–åŒ– =====
    const closedPipeWaveCanvas = document.getElementById('closedPipeWaveCanvas');
    const closedPipeWaveCtx = closedPipeWaveCanvas.getContext('2d');
    let currentClosedPipeHarmonic = 1;
    
    function setClosedPipeHarmonic(n, btn) {
        currentClosedPipeHarmonic = n;
        document.querySelectorAll('#closedPipeWaveControls .wave-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const infoTexts = {
            1: 'åŸºæœ¬æŒ¯å‹•: L = Î»â‚/4 â†’ Î»â‚ = 4L ï¼ˆç®¡ã®ä¸­ã«1/4æ³¢é•·ãŒå…¥ã‚‹ï¼‰',
            3: '3å€æŒ¯å‹•: L = 3Î»â‚ƒ/4 â†’ Î»â‚ƒ = 4L/3 ï¼ˆç®¡ã®ä¸­ã«3/4æ³¢é•·ãŒå…¥ã‚‹ï¼‰',
            5: '5å€æŒ¯å‹•: L = 5Î»â‚…/4 â†’ Î»â‚… = 4L/5 ï¼ˆç®¡ã®ä¸­ã«5/4æ³¢é•·ãŒå…¥ã‚‹ï¼‰',
            7: '7å€æŒ¯å‹•: L = 7Î»â‚‡/4 â†’ Î»â‚‡ = 4L/7 ï¼ˆç®¡ã®ä¸­ã«7/4æ³¢é•·ãŒå…¥ã‚‹ï¼‰'
        };
        document.getElementById('closedPipeWaveInfo').textContent = infoTexts[n];
        drawClosedPipeWave();
    }
    
    function drawClosedPipeWave() {
        const W = closedPipeWaveCanvas.width;
        const H = closedPipeWaveCanvas.height;
        const n = currentClosedPipeHarmonic;
        
        closedPipeWaveCtx.fillStyle = '#fafafa';
        closedPipeWaveCtx.fillRect(0, 0, W, H);
        
        const pipeTop = 40, pipeBottom = H - 40;
        const pipeHeight = pipeBottom - pipeTop;
        const pipeWidth = 60;
        const pipeCenterX = W / 2;
        const pipeLeft = pipeCenterX - pipeWidth / 2;
        const pipeRight = pipeCenterX + pipeWidth / 2;
        const amplitude = 40;
        
        // ç®¡ã®å£
        closedPipeWaveCtx.strokeStyle = '#555';
        closedPipeWaveCtx.lineWidth = 4;
        closedPipeWaveCtx.beginPath();
        closedPipeWaveCtx.moveTo(pipeLeft, pipeTop);
        closedPipeWaveCtx.lineTo(pipeLeft, pipeBottom);
        closedPipeWaveCtx.lineTo(pipeRight, pipeBottom);
        closedPipeWaveCtx.lineTo(pipeRight, pipeTop);
        closedPipeWaveCtx.stroke();
        
        // åº•ã®æ–œç·š
        closedPipeWaveCtx.strokeStyle = '#888';
        closedPipeWaveCtx.lineWidth = 2;
        for (let i = 0; i < pipeWidth; i += 8) {
            closedPipeWaveCtx.beginPath();
            closedPipeWaveCtx.moveTo(pipeLeft + i, pipeBottom);
            closedPipeWaveCtx.lineTo(pipeLeft + i + 8, pipeBottom + 8);
            closedPipeWaveCtx.stroke();
        }
        
        // ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼
        closedPipeWaveCtx.fillStyle = '#333';
        closedPipeWaveCtx.font = '20px sans-serif';
        closedPipeWaveCtx.textAlign = 'center';
        closedPipeWaveCtx.fillText('ğŸ”Š', pipeCenterX, pipeTop - 10);
        
        // é™æ­¢ä½ç½®
        closedPipeWaveCtx.strokeStyle = '#ccc';
        closedPipeWaveCtx.lineWidth = 1;
        closedPipeWaveCtx.setLineDash([5, 5]);
        closedPipeWaveCtx.beginPath();
        closedPipeWaveCtx.moveTo(pipeCenterX, pipeTop);
        closedPipeWaveCtx.lineTo(pipeCenterX, pipeBottom);
        closedPipeWaveCtx.stroke();
        closedPipeWaveCtx.setLineDash([]);
        
        // åŒ…çµ¡ç·š
        closedPipeWaveCtx.strokeStyle = '#e53935';
        closedPipeWaveCtx.lineWidth = 1;
        closedPipeWaveCtx.setLineDash([5, 5]);
        closedPipeWaveCtx.beginPath();
        for (let py = 0; py <= pipeHeight; py++) {
            const y = pipeTop + py;
            const ratio = py / pipeHeight;
            const envelope = Math.abs(Math.cos(n * Math.PI * ratio / 2)) * amplitude;
            if (py === 0) closedPipeWaveCtx.moveTo(pipeCenterX + envelope, y);
            else closedPipeWaveCtx.lineTo(pipeCenterX + envelope, y);
        }
        closedPipeWaveCtx.stroke();
        closedPipeWaveCtx.beginPath();
        for (let py = 0; py <= pipeHeight; py++) {
            const y = pipeTop + py;
            const ratio = py / pipeHeight;
            const envelope = Math.abs(Math.cos(n * Math.PI * ratio / 2)) * amplitude;
            if (py === 0) closedPipeWaveCtx.moveTo(pipeCenterX - envelope, y);
            else closedPipeWaveCtx.lineTo(pipeCenterX - envelope, y);
        }
        closedPipeWaveCtx.stroke();
        closedPipeWaveCtx.setLineDash([]);
        
        // å®šå¸¸æ³¢
        closedPipeWaveCtx.strokeStyle = '#e53935';
        closedPipeWaveCtx.lineWidth = 3;
        closedPipeWaveCtx.beginPath();
        for (let py = 0; py <= pipeHeight; py++) {
            const y = pipeTop + py;
            const ratio = py / pipeHeight;
            const displacement = Math.cos(n * Math.PI * ratio / 2) * amplitude;
            const x = pipeCenterX + displacement;
            if (py === 0) closedPipeWaveCtx.moveTo(x, y);
            else closedPipeWaveCtx.lineTo(x, y);
        }
        closedPipeWaveCtx.stroke();
        
        // è…¹
        closedPipeWaveCtx.fillStyle = '#4CAF50';
        for (let k = 0; k <= n; k++) {
            const ratio = (2 * k) / n;
            if (ratio <= 1) {
                const markerY = pipeTop + ratio * pipeHeight;
                const displacement = Math.cos(n * Math.PI * ratio / 2) * amplitude;
                closedPipeWaveCtx.beginPath();
                closedPipeWaveCtx.arc(pipeCenterX + displacement, markerY, 8, 0, Math.PI * 2);
                closedPipeWaveCtx.fill();
            }
        }
        
        // ç¯€
        closedPipeWaveCtx.fillStyle = '#2196F3';
        for (let k = 0; k <= n; k++) {
            const ratio = (2 * k + 1) / n;
            if (ratio <= 1) {
                const markerY = pipeTop + ratio * pipeHeight;
                closedPipeWaveCtx.beginPath();
                closedPipeWaveCtx.arc(pipeCenterX, markerY, 8, 0, Math.PI * 2);
                closedPipeWaveCtx.fill();
            }
        }
        
        // é•·ã•è¡¨ç¤º
        closedPipeWaveCtx.strokeStyle = '#667eea';
        closedPipeWaveCtx.lineWidth = 2;
        closedPipeWaveCtx.beginPath();
        closedPipeWaveCtx.moveTo(pipeLeft - 30, pipeTop);
        closedPipeWaveCtx.lineTo(pipeLeft - 30, pipeBottom);
        closedPipeWaveCtx.stroke();
        closedPipeWaveCtx.fillStyle = '#667eea';
        closedPipeWaveCtx.beginPath();
        closedPipeWaveCtx.moveTo(pipeLeft - 30, pipeTop);
        closedPipeWaveCtx.lineTo(pipeLeft - 35, pipeTop + 10);
        closedPipeWaveCtx.lineTo(pipeLeft - 25, pipeTop + 10);
        closedPipeWaveCtx.closePath();
        closedPipeWaveCtx.fill();
        closedPipeWaveCtx.beginPath();
        closedPipeWaveCtx.moveTo(pipeLeft - 30, pipeBottom);
        closedPipeWaveCtx.lineTo(pipeLeft - 35, pipeBottom - 10);
        closedPipeWaveCtx.lineTo(pipeLeft - 25, pipeBottom - 10);
        closedPipeWaveCtx.closePath();
        closedPipeWaveCtx.fill();
        closedPipeWaveCtx.font = '14px sans-serif';
        closedPipeWaveCtx.textAlign = 'center';
        closedPipeWaveCtx.save();
        closedPipeWaveCtx.translate(pipeLeft - 50, (pipeTop + pipeBottom) / 2);
        closedPipeWaveCtx.rotate(-Math.PI / 2);
        closedPipeWaveCtx.fillText('L', 0, 0);
        closedPipeWaveCtx.restore();
        
        // ãƒ©ãƒ™ãƒ«
        closedPipeWaveCtx.font = '12px sans-serif';
        closedPipeWaveCtx.textAlign = 'left';
        closedPipeWaveCtx.fillStyle = '#333';
        closedPipeWaveCtx.fillText('å£ï¼ˆé–‹ï¼‰â†’ è…¹', pipeRight + 50, pipeTop + 5);
        closedPipeWaveCtx.fillText('åº•ï¼ˆé–‰ï¼‰â†’ ç¯€', pipeRight + 50, pipeBottom + 5);
        closedPipeWaveCtx.fillStyle = '#4CAF50';
        closedPipeWaveCtx.fillText('â— è…¹', 10, 20);
        closedPipeWaveCtx.fillStyle = '#2196F3';
        closedPipeWaveCtx.fillText('â— ç¯€', 10, 38);
        closedPipeWaveCtx.fillStyle = '#764ba2';
        closedPipeWaveCtx.font = 'bold 14px sans-serif';
        closedPipeWaveCtx.textAlign = 'right';
        closedPipeWaveCtx.fillText(`Î»/4 ãŒ ${n} å€‹å…¥ã‚‹`, W - 10, 25);
    }

    // ===== é–‹ç®¡ã®å®šå¸¸æ³¢å¯è¦–åŒ– =====
    const openPipeWaveCanvas = document.getElementById('openPipeWaveCanvas');
    const openPipeWaveCtx = openPipeWaveCanvas.getContext('2d');
    let currentOpenPipeHarmonic = 1;
    
    function setOpenPipeHarmonic(n, btn) {
        currentOpenPipeHarmonic = n;
        document.querySelectorAll('#openPipeWaveControls .wave-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const infoTexts = {
            1: 'åŸºæœ¬æŒ¯å‹•: L = Î»â‚/2 â†’ Î»â‚ = 2L ï¼ˆç®¡ã®ä¸­ã«åŠæ³¢é•·ãŒå…¥ã‚‹ï¼‰',
            2: '2å€æŒ¯å‹•: L = Î»â‚‚ â†’ Î»â‚‚ = L ï¼ˆç®¡ã®ä¸­ã«1æ³¢é•·ãŒå…¥ã‚‹ï¼‰',
            3: '3å€æŒ¯å‹•: L = 3Î»â‚ƒ/2 â†’ Î»â‚ƒ = 2L/3 ï¼ˆç®¡ã®ä¸­ã«3/2æ³¢é•·ãŒå…¥ã‚‹ï¼‰',
            4: '4å€æŒ¯å‹•: L = 2Î»â‚„ â†’ Î»â‚„ = L/2 ï¼ˆç®¡ã®ä¸­ã«2æ³¢é•·ãŒå…¥ã‚‹ï¼‰'
        };
        document.getElementById('openPipeWaveInfo').textContent = infoTexts[n];
        drawOpenPipeWave();
    }
    
    function drawOpenPipeWave() {
        const W = openPipeWaveCanvas.width;
        const H = openPipeWaveCanvas.height;
        const n = currentOpenPipeHarmonic;
        
        openPipeWaveCtx.fillStyle = '#fafafa';
        openPipeWaveCtx.fillRect(0, 0, W, H);
        
        const pipeTop = 40, pipeBottom = H - 40;
        const pipeHeight = pipeBottom - pipeTop;
        const pipeWidth = 60;
        const pipeCenterX = W / 2;
        const pipeLeft = pipeCenterX - pipeWidth / 2;
        const pipeRight = pipeCenterX + pipeWidth / 2;
        const amplitude = 40;
        
        // ç®¡ã®å£
        openPipeWaveCtx.strokeStyle = '#555';
        openPipeWaveCtx.lineWidth = 4;
        openPipeWaveCtx.beginPath();
        openPipeWaveCtx.moveTo(pipeLeft, pipeTop);
        openPipeWaveCtx.lineTo(pipeLeft, pipeBottom);
        openPipeWaveCtx.stroke();
        openPipeWaveCtx.beginPath();
        openPipeWaveCtx.moveTo(pipeRight, pipeTop);
        openPipeWaveCtx.lineTo(pipeRight, pipeBottom);
        openPipeWaveCtx.stroke();
        
        // ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼
        openPipeWaveCtx.fillStyle = '#333';
        openPipeWaveCtx.font = '20px sans-serif';
        openPipeWaveCtx.textAlign = 'center';
        openPipeWaveCtx.fillText('ğŸ”Š', pipeCenterX, pipeTop - 10);
        
        // é™æ­¢ä½ç½®
        openPipeWaveCtx.strokeStyle = '#ccc';
        openPipeWaveCtx.lineWidth = 1;
        openPipeWaveCtx.setLineDash([5, 5]);
        openPipeWaveCtx.beginPath();
        openPipeWaveCtx.moveTo(pipeCenterX, pipeTop);
        openPipeWaveCtx.lineTo(pipeCenterX, pipeBottom);
        openPipeWaveCtx.stroke();
        openPipeWaveCtx.setLineDash([]);
        
        // åŒ…çµ¡ç·š
        openPipeWaveCtx.strokeStyle = '#e53935';
        openPipeWaveCtx.lineWidth = 1;
        openPipeWaveCtx.setLineDash([5, 5]);
        openPipeWaveCtx.beginPath();
        for (let py = 0; py <= pipeHeight; py++) {
            const y = pipeTop + py;
            const ratio = py / pipeHeight;
            const envelope = Math.abs(Math.cos(n * Math.PI * ratio)) * amplitude;
            if (py === 0) openPipeWaveCtx.moveTo(pipeCenterX + envelope, y);
            else openPipeWaveCtx.lineTo(pipeCenterX + envelope, y);
        }
        openPipeWaveCtx.stroke();
        openPipeWaveCtx.beginPath();
        for (let py = 0; py <= pipeHeight; py++) {
            const y = pipeTop + py;
            const ratio = py / pipeHeight;
            const envelope = Math.abs(Math.cos(n * Math.PI * ratio)) * amplitude;
            if (py === 0) openPipeWaveCtx.moveTo(pipeCenterX - envelope, y);
            else openPipeWaveCtx.lineTo(pipeCenterX - envelope, y);
        }
        openPipeWaveCtx.stroke();
        openPipeWaveCtx.setLineDash([]);
        
        // å®šå¸¸æ³¢
        openPipeWaveCtx.strokeStyle = '#e53935';
        openPipeWaveCtx.lineWidth = 3;
        openPipeWaveCtx.beginPath();
        for (let py = 0; py <= pipeHeight; py++) {
            const y = pipeTop + py;
            const ratio = py / pipeHeight;
            const displacement = Math.cos(n * Math.PI * ratio) * amplitude;
            const x = pipeCenterX + displacement;
            if (py === 0) openPipeWaveCtx.moveTo(x, y);
            else openPipeWaveCtx.lineTo(x, y);
        }
        openPipeWaveCtx.stroke();
        
        // è…¹
        openPipeWaveCtx.fillStyle = '#4CAF50';
        for (let k = 0; k <= n; k++) {
            const ratio = k / n;
            const markerY = pipeTop + ratio * pipeHeight;
            const displacement = Math.cos(n * Math.PI * ratio) * amplitude;
            openPipeWaveCtx.beginPath();
            openPipeWaveCtx.arc(pipeCenterX + displacement, markerY, 8, 0, Math.PI * 2);
            openPipeWaveCtx.fill();
        }
        
        // ç¯€
        openPipeWaveCtx.fillStyle = '#2196F3';
        for (let k = 0; k < n; k++) {
            const ratio = (2 * k + 1) / (2 * n);
            const markerY = pipeTop + ratio * pipeHeight;
            openPipeWaveCtx.beginPath();
            openPipeWaveCtx.arc(pipeCenterX, markerY, 8, 0, Math.PI * 2);
            openPipeWaveCtx.fill();
        }
        
        // é•·ã•è¡¨ç¤º
        openPipeWaveCtx.strokeStyle = '#667eea';
        openPipeWaveCtx.lineWidth = 2;
        openPipeWaveCtx.beginPath();
        openPipeWaveCtx.moveTo(pipeLeft - 30, pipeTop);
        openPipeWaveCtx.lineTo(pipeLeft - 30, pipeBottom);
        openPipeWaveCtx.stroke();
        openPipeWaveCtx.fillStyle = '#667eea';
        openPipeWaveCtx.beginPath();
        openPipeWaveCtx.moveTo(pipeLeft - 30, pipeTop);
        openPipeWaveCtx.lineTo(pipeLeft - 35, pipeTop + 10);
        openPipeWaveCtx.lineTo(pipeLeft - 25, pipeTop + 10);
        openPipeWaveCtx.closePath();
        openPipeWaveCtx.fill();
        openPipeWaveCtx.beginPath();
        openPipeWaveCtx.moveTo(pipeLeft - 30, pipeBottom);
        openPipeWaveCtx.lineTo(pipeLeft - 35, pipeBottom - 10);
        openPipeWaveCtx.lineTo(pipeLeft - 25, pipeBottom - 10);
        openPipeWaveCtx.closePath();
        openPipeWaveCtx.fill();
        openPipeWaveCtx.font = '14px sans-serif';
        openPipeWaveCtx.textAlign = 'center';
        openPipeWaveCtx.save();
        openPipeWaveCtx.translate(pipeLeft - 50, (pipeTop + pipeBottom) / 2);
        openPipeWaveCtx.rotate(-Math.PI / 2);
        openPipeWaveCtx.fillText('L', 0, 0);
        openPipeWaveCtx.restore();
        
        // ãƒ©ãƒ™ãƒ«
        openPipeWaveCtx.font = '12px sans-serif';
        openPipeWaveCtx.textAlign = 'left';
        openPipeWaveCtx.fillStyle = '#333';
        openPipeWaveCtx.fillText('å£ï¼ˆé–‹ï¼‰â†’ è…¹', pipeRight + 50, pipeTop + 5);
        openPipeWaveCtx.fillText('åº•ï¼ˆé–‹ï¼‰â†’ è…¹', pipeRight + 50, pipeBottom + 5);
        openPipeWaveCtx.fillStyle = '#4CAF50';
        openPipeWaveCtx.fillText('â— è…¹', 10, 20);
        openPipeWaveCtx.fillStyle = '#2196F3';
        openPipeWaveCtx.fillText('â— ç¯€', 10, 38);
        openPipeWaveCtx.fillStyle = '#764ba2';
        openPipeWaveCtx.font = 'bold 14px sans-serif';
        openPipeWaveCtx.textAlign = 'right';
        openPipeWaveCtx.fillText(`Î»/2 ãŒ ${n} å€‹å…¥ã‚‹`, W - 10, 25);
    }

    // ===== é–‹å£ç«¯è£œæ­£ã®å¯è¦–åŒ– =====
    const endCorrectionCanvas = document.getElementById('endCorrectionCanvas');
    const endCorrectionCtx = endCorrectionCanvas.getContext('2d');
    
    function drawEndCorrection() {
        const W = endCorrectionCanvas.width;
        const H = endCorrectionCanvas.height;
        
        endCorrectionCtx.fillStyle = '#fafafa';
        endCorrectionCtx.fillRect(0, 0, W, H);
        
        const pipeLeft = 60, pipeRight = W - 140;
        const pipeY = H / 2;
        const pipeWidth = 40;
        const amplitude = 25;
        
        // ç®¡ã®å£
        endCorrectionCtx.strokeStyle = '#555';
        endCorrectionCtx.lineWidth = 4;
        endCorrectionCtx.beginPath();
        endCorrectionCtx.moveTo(pipeLeft, pipeY - pipeWidth);
        endCorrectionCtx.lineTo(pipeRight, pipeY - pipeWidth);
        endCorrectionCtx.stroke();
        endCorrectionCtx.beginPath();
        endCorrectionCtx.moveTo(pipeLeft, pipeY + pipeWidth);
        endCorrectionCtx.lineTo(pipeRight, pipeY + pipeWidth);
        endCorrectionCtx.stroke();
        endCorrectionCtx.beginPath();
        endCorrectionCtx.moveTo(pipeLeft, pipeY - pipeWidth);
        endCorrectionCtx.lineTo(pipeLeft, pipeY + pipeWidth);
        endCorrectionCtx.stroke();
        
        // æ–œç·š
        endCorrectionCtx.strokeStyle = '#888';
        endCorrectionCtx.lineWidth = 2;
        for (let y = -pipeWidth; y < pipeWidth; y += 10) {
            endCorrectionCtx.beginPath();
            endCorrectionCtx.moveTo(pipeLeft, pipeY + y);
            endCorrectionCtx.lineTo(pipeLeft - 10, pipeY + y + 10);
            endCorrectionCtx.stroke();
        }
        
        const deltaX = 35;
        const actualEnd = pipeRight + deltaX;
        
        // Î”xé ˜åŸŸ
        endCorrectionCtx.fillStyle = 'rgba(255, 152, 0, 0.2)';
        endCorrectionCtx.fillRect(pipeRight, pipeY - pipeWidth - 10, deltaX, pipeWidth * 2 + 20);
        
        // å®šå¸¸æ³¢
        endCorrectionCtx.strokeStyle = '#e53935';
        endCorrectionCtx.lineWidth = 3;
        endCorrectionCtx.beginPath();
        const totalLength = actualEnd - pipeLeft;
        for (let px = 0; px <= totalLength; px++) {
            const x = pipeLeft + px;
            const ratio = px / totalLength;
            const displacement = Math.sin(Math.PI / 2 * ratio) * amplitude;
            const y = pipeY - displacement;
            if (px === 0) endCorrectionCtx.moveTo(x, y);
            else endCorrectionCtx.lineTo(x, y);
        }
        endCorrectionCtx.stroke();
        
        // ç®¡ã®ç«¯
        endCorrectionCtx.strokeStyle = '#2196F3';
        endCorrectionCtx.lineWidth = 2;
        endCorrectionCtx.setLineDash([5, 5]);
        endCorrectionCtx.beginPath();
        endCorrectionCtx.moveTo(pipeRight, pipeY - pipeWidth - 20);
        endCorrectionCtx.lineTo(pipeRight, pipeY + pipeWidth + 30);
        endCorrectionCtx.stroke();
        endCorrectionCtx.setLineDash([]);
        
        // ç¯€ï¼ˆå·¦ç«¯ï¼‰
        endCorrectionCtx.fillStyle = '#2196F3';
        endCorrectionCtx.beginPath();
        endCorrectionCtx.arc(pipeLeft, pipeY, 8, 0, Math.PI * 2);
        endCorrectionCtx.fill();
        
        // è…¹ï¼ˆå³ç«¯å¤–å´ï¼‰
        endCorrectionCtx.fillStyle = '#4CAF50';
        endCorrectionCtx.beginPath();
        endCorrectionCtx.arc(actualEnd, pipeY - amplitude, 8, 0, Math.PI * 2);
        endCorrectionCtx.fill();
        
        // Î”xè¡¨ç¤º
        endCorrectionCtx.strokeStyle = '#ff9800';
        endCorrectionCtx.lineWidth = 2;
        endCorrectionCtx.beginPath();
        endCorrectionCtx.moveTo(pipeRight, pipeY + pipeWidth + 45);
        endCorrectionCtx.lineTo(actualEnd, pipeY + pipeWidth + 45);
        endCorrectionCtx.stroke();
        endCorrectionCtx.fillStyle = '#ff9800';
        endCorrectionCtx.beginPath();
        endCorrectionCtx.moveTo(pipeRight, pipeY + pipeWidth + 45);
        endCorrectionCtx.lineTo(pipeRight + 8, pipeY + pipeWidth + 40);
        endCorrectionCtx.lineTo(pipeRight + 8, pipeY + pipeWidth + 50);
        endCorrectionCtx.closePath();
        endCorrectionCtx.fill();
        endCorrectionCtx.beginPath();
        endCorrectionCtx.moveTo(actualEnd, pipeY + pipeWidth + 45);
        endCorrectionCtx.lineTo(actualEnd - 8, pipeY + pipeWidth + 40);
        endCorrectionCtx.lineTo(actualEnd - 8, pipeY + pipeWidth + 50);
        endCorrectionCtx.closePath();
        endCorrectionCtx.fill();
        endCorrectionCtx.font = 'bold 14px sans-serif';
        endCorrectionCtx.textAlign = 'center';
        endCorrectionCtx.fillText('Î”x', (pipeRight + actualEnd) / 2, pipeY + pipeWidth + 65);
        
        // ãƒ©ãƒ™ãƒ«
        endCorrectionCtx.fillStyle = '#333';
        endCorrectionCtx.font = '12px sans-serif';
        endCorrectionCtx.textAlign = 'left';
        endCorrectionCtx.fillText('ç¯€ï¼ˆé–‰ã˜ãŸç«¯ï¼‰', pipeLeft - 30, pipeY - pipeWidth - 15);
        endCorrectionCtx.fillStyle = '#2196F3';
        endCorrectionCtx.textAlign = 'center';
        endCorrectionCtx.fillText('ç®¡ã®ç«¯', pipeRight, pipeY - pipeWidth - 25);
        endCorrectionCtx.fillStyle = '#4CAF50';
        endCorrectionCtx.fillText('å®Ÿéš›ã®è…¹', actualEnd, pipeY - amplitude - 20);
    }

    // ===== æŒ¯ã‚Šå­å…±æŒ¯ãƒ‡ãƒ¢ =====
    const pendulumCanvas = document.getElementById('pendulumCanvas');
    const pendulumCtx = pendulumCanvas.getContext('2d');
    let pendulumAnimating = false;
    let pendulumTime = 0;
    let pendulumAnimationId = null;
    let driverLengthIndex = 3; // 1-5
    
    const pendulumLengths = [50, 70, 100, 130, 170]; // 5ç¨®é¡ã®é•·ã•
    const pendulumColors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7'];
    let pendulumAmplitudes = [0, 0, 0, 0, 0]; // å„æŒ¯ã‚Šå­ã®æŒ¯å¹…ï¼ˆå…±æŒ¯ã§å¢—åŠ ï¼‰
    
    function updateDriverLength() {
        driverLengthIndex = parseInt(document.getElementById('driverLengthSlider').value);
        const labels = ['æœ€çŸ­', 'çŸ­ã‚', 'ä¸­', 'é•·ã‚', 'æœ€é•·'];
        document.getElementById('driverLengthValue').textContent = labels[driverLengthIndex - 1];
        pendulumAmplitudes = [0, 0, 0, 0, 0];
        drawPendulum();
    }
    
    function drawPendulum() {
        const W = pendulumCanvas.width;
        const H = pendulumCanvas.height;
        
        pendulumCtx.fillStyle = '#f5f5f5';
        pendulumCtx.fillRect(0, 0, W, H);
        
        // æ”¯æŒæ£’
        const barY = 30;
        const barStartX = 50;
        const barEndX = W - 50;
        
        pendulumCtx.strokeStyle = '#555';
        pendulumCtx.lineWidth = 8;
        pendulumCtx.beginPath();
        pendulumCtx.moveTo(barStartX, barY);
        pendulumCtx.lineTo(barEndX, barY);
        pendulumCtx.stroke();
        
        // æ”¯æŸ±
        pendulumCtx.fillStyle = '#777';
        pendulumCtx.fillRect(barStartX - 10, barY, 15, H - barY - 10);
        pendulumCtx.fillRect(barEndX - 5, barY, 15, H - barY - 10);
        
        // é§†å‹•æŒ¯ã‚Šå­ï¼ˆå·¦ç«¯ã€èµ¤ï¼‰
        const driverX = barStartX + 30;
        const driverLength = pendulumLengths[driverLengthIndex - 1];
        const driverFreq = 1 / Math.sqrt(driverLength / 100);
        const driverAngle = pendulumAnimating ? Math.sin(pendulumTime * driverFreq * 0.1) * 30 * Math.PI / 180 : 0;
        
        drawSinglePendulum(driverX, barY, driverLength, driverAngle, '#e53935', 'é§†å‹•');
        
        // 5ã¤ã®è¢«å‹•æŒ¯ã‚Šå­
        const spacing = (barEndX - barStartX - 100) / 6;
        for (let i = 0; i < 5; i++) {
            const x = barStartX + 80 + spacing * (i + 1);
            const len = pendulumLengths[i];
            const freq = 1 / Math.sqrt(len / 100);
            
            // å…±æŒ¯åˆ¤å®šï¼šé§†å‹•æŒ¯ã‚Šå­ã¨åŒã˜é•·ã•ãªã‚‰å…±æŒ¯
            const isResonating = (i + 1) === driverLengthIndex;
            
            if (pendulumAnimating) {
                if (isResonating) {
                    // å…±æŒ¯ï¼šæŒ¯å¹…ãŒå¾ã€…ã«å¢—åŠ 
                    pendulumAmplitudes[i] = Math.min(pendulumAmplitudes[i] + 0.3, 35);
                } else {
                    // éå…±æŒ¯ï¼šå°ã•ãæºã‚Œã‚‹ã‹æ¸›è¡°
                    pendulumAmplitudes[i] = Math.max(pendulumAmplitudes[i] - 0.1, 3);
                }
            }
            
            const angle = pendulumAnimating ? 
                Math.sin(pendulumTime * freq * 0.1) * pendulumAmplitudes[i] * Math.PI / 180 : 0;
            
            drawSinglePendulum(x, barY, len, angle, pendulumColors[i], isResonating ? 'å…±æŒ¯ï¼' : '');
        }
        
        // å‡¡ä¾‹
        pendulumCtx.fillStyle = '#e53935';
        pendulumCtx.font = '12px sans-serif';
        pendulumCtx.textAlign = 'left';
        pendulumCtx.fillText('â— é§†å‹•æŒ¯ã‚Šå­ï¼ˆæ‰‹ã§æºã‚‰ã™ï¼‰', 10, H - 10);
    }
    
    function drawSinglePendulum(pivotX, pivotY, length, angle, color, label) {
        const bobX = pivotX + Math.sin(angle) * length;
        const bobY = pivotY + Math.cos(angle) * length;
        const bobRadius = 15;
        
        // ç³¸
        pendulumCtx.strokeStyle = '#888';
        pendulumCtx.lineWidth = 2;
        pendulumCtx.beginPath();
        pendulumCtx.moveTo(pivotX, pivotY);
        pendulumCtx.lineTo(bobX, bobY);
        pendulumCtx.stroke();
        
        // ãŠã‚‚ã‚Š
        pendulumCtx.fillStyle = color;
        pendulumCtx.beginPath();
        pendulumCtx.arc(bobX, bobY, bobRadius, 0, Math.PI * 2);
        pendulumCtx.fill();
        pendulumCtx.strokeStyle = '#333';
        pendulumCtx.lineWidth = 1;
        pendulumCtx.stroke();
        
        // ãƒ©ãƒ™ãƒ«
        if (label) {
            pendulumCtx.fillStyle = label === 'å…±æŒ¯ï¼' ? '#e53935' : '#333';
            pendulumCtx.font = label === 'å…±æŒ¯ï¼' ? 'bold 11px sans-serif' : '10px sans-serif';
            pendulumCtx.textAlign = 'center';
            pendulumCtx.fillText(label, pivotX, pivotY + length + bobRadius + 15);
        }
    }
    
    function togglePendulumAnimation() {
        if (pendulumAnimating) {
            pendulumAnimating = false;
            document.getElementById('pendulumStartBtn').textContent = 'æŒ¯ã‚Šå­ã‚’æºã‚‰ã™';
            cancelAnimationFrame(pendulumAnimationId);
        } else {
            pendulumAnimating = true;
            document.getElementById('pendulumStartBtn').textContent = 'åœæ­¢';
            animatePendulum();
        }
    }
    
    function resetPendulum() {
        pendulumAnimating = false;
        pendulumTime = 0;
        pendulumAmplitudes = [0, 0, 0, 0, 0];
        document.getElementById('pendulumStartBtn').textContent = 'æŒ¯ã‚Šå­ã‚’æºã‚‰ã™';
        cancelAnimationFrame(pendulumAnimationId);
        drawPendulum();
    }
    
    function animatePendulum() {
        if (!pendulumAnimating) return;
        pendulumTime++;
        drawPendulum();
        pendulumAnimationId = requestAnimationFrame(animatePendulum);
    }

    // ===== å¼¦ã®æŒ¯å‹•ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ =====
    const stringCanvas = document.getElementById('stringCanvas');
    const stringCtx = stringCanvas.getContext('2d');
    let stringLength = 1.0, driverFreq = 100, waveSpeed = 200;
    let stringAnimating = false, stringTime = 0, stringAnimationId = null;
    
    const stringLengthSlider = document.getElementById('stringLengthSlider');
    const freqSlider = document.getElementById('freqSlider');
    const tensionSlider = document.getElementById('tensionSlider');
    const stringLengthDisplay = document.getElementById('stringLengthDisplay');
    const freqDisplay = document.getElementById('freqDisplay');
    const tensionDisplay = document.getElementById('tensionDisplay');
    const resonanceIndicator = document.getElementById('resonanceIndicator');
    
    function getStringNaturalFrequencies() {
        const f1 = waveSpeed / (2 * stringLength);
        return [f1, 2*f1, 3*f1, 4*f1, 5*f1];
    }
    
    function getResonanceMode() {
        const freqs = getStringNaturalFrequencies();
        for (let n = 0; n < freqs.length; n++) {
            if (Math.abs(driverFreq - freqs[n]) < 5) return n + 1;
        }
        return 0;
    }
    
    function drawStringSimulation() {
        const W = stringCanvas.width;
        const H = stringCanvas.height;
        
        stringCtx.fillStyle = '#f8f9fa';
        stringCtx.fillRect(0, 0, W, H);
        
        const margin = 80;
        const stringY = H * 0.5;
        const stringStartX = margin;
        const stringEndX = W - margin;
        const stringPixelLength = stringEndX - stringStartX;
        
        // å£
        stringCtx.fillStyle = '#555';
        stringCtx.fillRect(stringStartX - 20, stringY - 60, 20, 120);
        stringCtx.fillRect(stringEndX, stringY - 60, 20, 120);
        
        // ãƒ•ãƒ¬ãƒƒãƒˆ
        stringCtx.fillStyle = '#8B4513';
        stringCtx.beginPath();
        stringCtx.moveTo(stringStartX, stringY - 15);
        stringCtx.lineTo(stringStartX + 15, stringY);
        stringCtx.lineTo(stringStartX, stringY + 15);
        stringCtx.closePath();
        stringCtx.fill();
        
        // ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼
        const speakerY = stringY + 35;
        const speakerOffset = stringAnimating ? Math.sin(stringTime * driverFreq * 2 * Math.PI / 60) * 3 : 0;
        stringCtx.fillStyle = '#333';
        stringCtx.fillRect(stringStartX - 12 + speakerOffset, speakerY, 25, 25);
        stringCtx.fillStyle = '#666';
        stringCtx.beginPath();
        stringCtx.arc(stringStartX + speakerOffset, speakerY + 12, 8, 0, Math.PI * 2);
        stringCtx.fill();
        stringCtx.fillStyle = '#333';
        stringCtx.font = '12px sans-serif';
        stringCtx.textAlign = 'center';
        stringCtx.fillText('ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼', stringStartX, speakerY + 40);
        
        const resonanceMode = getResonanceMode();
        const amplitude = resonanceMode > 0 ? 40 : 5;
        
        stringCtx.strokeStyle = resonanceMode > 0 ? '#e53935' : '#333';
        stringCtx.lineWidth = resonanceMode > 0 ? 3 : 2;
        stringCtx.beginPath();
        for (let px = 0; px <= stringPixelLength; px++) {
            const x = stringStartX + px;
            const ratio = px / stringPixelLength;
            let y = stringY;
            if (stringAnimating && resonanceMode > 0) {
                y = stringY - amplitude * Math.sin(resonanceMode * Math.PI * ratio) * Math.cos(stringTime * 0.1);
            } else if (stringAnimating) {
                y = stringY - amplitude * Math.sin(ratio * 10 + stringTime * 0.2) * Math.cos(ratio * 5 - stringTime * 0.15);
            }
            if (px === 0) stringCtx.moveTo(x, y);
            else stringCtx.lineTo(x, y);
        }
        stringCtx.stroke();
        
        if (resonanceMode > 0 && stringAnimating) {
            stringCtx.fillStyle = '#2196F3';
            for (let i = 0; i <= resonanceMode; i++) {
                stringCtx.beginPath();
                stringCtx.arc(stringStartX + (i / resonanceMode) * stringPixelLength, stringY, 6, 0, Math.PI * 2);
                stringCtx.fill();
            }
            stringCtx.fillStyle = '#4CAF50';
            for (let i = 0; i < resonanceMode; i++) {
                stringCtx.beginPath();
                stringCtx.arc(stringStartX + ((i + 0.5) / resonanceMode) * stringPixelLength, stringY, 6, 0, Math.PI * 2);
                stringCtx.fill();
            }
        }
        
        // é•·ã•è¡¨ç¤º
        stringCtx.strokeStyle = '#667eea';
        stringCtx.lineWidth = 1;
        stringCtx.setLineDash([5, 5]);
        stringCtx.beginPath();
        stringCtx.moveTo(stringStartX, stringY + 80);
        stringCtx.lineTo(stringEndX, stringY + 80);
        stringCtx.stroke();
        stringCtx.setLineDash([]);
        stringCtx.fillStyle = '#667eea';
        stringCtx.font = '14px sans-serif';
        stringCtx.fillText('L = ' + stringLength.toFixed(1) + ' m', (stringStartX + stringEndX)/2, stringY + 100);
        
        // å‡¡ä¾‹
        stringCtx.font = '12px sans-serif';
        stringCtx.textAlign = 'left';
        stringCtx.fillStyle = '#2196F3';
        stringCtx.fillText('â— ç¯€', W - 100, 30);
        stringCtx.fillStyle = '#4CAF50';
        stringCtx.fillText('â— è…¹', W - 100, 50);
    }
    
    function animateStringSimulation() {
        if (!stringAnimating) return;
        stringTime++;
        drawStringSimulation();
        stringAnimationId = requestAnimationFrame(animateStringSimulation);
    }
    
    function updateStringInfo() {
        const freqs = getStringNaturalFrequencies();
        document.getElementById('stringInfo1').textContent = 'åŸºæœ¬æŒ¯å‹•æ•° fâ‚ = ' + freqs[0].toFixed(1) + ' Hz';
        const mode = getResonanceMode();
        if (mode > 0) {
            document.getElementById('stringInfo2').textContent = 'ç¾åœ¨ã®æŒ¯å‹•: ' + mode + 'å€æŒ¯å‹•ã§å…±é³´ä¸­ï¼';
            resonanceIndicator.textContent = mode + 'å€æŒ¯å‹•ã§å…±é³´ï¼';
            resonanceIndicator.className = 'resonance-indicator resonating';
        } else {
            document.getElementById('stringInfo2').textContent = 'ç¾åœ¨ã®æŒ¯å‹•: å…±é³´ã—ã¦ã„ã¾ã›ã‚“';
            resonanceIndicator.textContent = 'éå…±é³´';
            resonanceIndicator.className = 'resonance-indicator not-resonating';
        }
        document.getElementById('stringInfo3').textContent = 'å›ºæœ‰æŒ¯å‹•æ•°: ' + freqs.slice(0, 5).map((f, i) => 'fâ‚Ã—' + (i+1) + '=' + Math.round(f) + 'Hz').join(', ');
    }
    
    stringLengthSlider.addEventListener('input', function() {
        stringLength = parseFloat(this.value);
        stringLengthDisplay.textContent = stringLength.toFixed(1) + ' m';
        updateStringInfo();
        drawStringSimulation();
    });
    freqSlider.addEventListener('input', function() {
        driverFreq = parseFloat(this.value);
        freqDisplay.textContent = driverFreq + ' Hz';
        updateStringInfo();
        drawStringSimulation();
    });
    tensionSlider.addEventListener('input', function() {
        waveSpeed = parseFloat(this.value);
        tensionDisplay.textContent = waveSpeed + ' m/s';
        updateStringInfo();
        drawStringSimulation();
    });
    document.getElementById('stringStartBtn').addEventListener('click', function() {
        if (stringAnimating) {
            stringAnimating = false;
            this.textContent = 'ã‚¹ã‚¿ãƒ¼ãƒˆ';
            cancelAnimationFrame(stringAnimationId);
        } else {
            stringAnimating = true;
            this.textContent = 'åœæ­¢';
            animateStringSimulation();
        }
    });
    document.getElementById('stringResetBtn').addEventListener('click', function() {
        stringAnimating = false;
        stringTime = 0;
        document.getElementById('stringStartBtn').textContent = 'ã‚¹ã‚¿ãƒ¼ãƒˆ';
        cancelAnimationFrame(stringAnimationId);
        drawStringSimulation();
    });

    // ===== æ°—æŸ±ã®æŒ¯å‹•ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ =====
    const pipeCanvas = document.getElementById('pipeCanvas');
    const pipeCtx = pipeCanvas.getContext('2d');
    let pipeLength = 0.5, harmonic = 1, pipeMode = 'closed', soundSpeed = 340;
    let pipeAnimating = false, pipeTime = 0, pipeAnimationId = null, showLongitudinal = false;
    
    const pipeLengthSlider = document.getElementById('pipeLengthSlider');
    const harmonicSlider = document.getElementById('harmonicSlider');
    const pipeLengthDisplay = document.getElementById('pipeLengthDisplay');
    const harmonicDisplay = document.getElementById('harmonicDisplay');
    
    function setPipeMode(mode) {
        pipeMode = mode;
        document.getElementById('closedPipeBtn').classList.toggle('active', mode === 'closed');
        document.getElementById('openPipeBtn').classList.toggle('active', mode === 'open');
        if (mode === 'closed' && harmonic % 2 === 0) {
            harmonic--;
            harmonicSlider.value = harmonic;
        }
        harmonicDisplay.textContent = harmonic + ' å€æŒ¯å‹•';
        updatePipeInfo();
        drawPipe();
    }
    
    function getPipeWavelength() {
        return pipeMode === 'closed' ? 4 * pipeLength / harmonic : 2 * pipeLength / harmonic;
    }
    
    function drawPipe() {
        const W = pipeCanvas.width;
        const H = pipeCanvas.height;
        
        pipeCtx.fillStyle = '#f8f9fa';
        pipeCtx.fillRect(0, 0, W, H);
        
        const pipeTop = 60, pipeBottom = H - 60;
        const pipeHeight = pipeBottom - pipeTop;
        const pipeWidth = 80;
        const pipeCenterX = W / 2;
        const pipeLeft = pipeCenterX - pipeWidth / 2;
        const pipeRight = pipeCenterX + pipeWidth / 2;
        
        // ç®¡ã®å£
        pipeCtx.strokeStyle = '#555';
        pipeCtx.lineWidth = 4;
        pipeCtx.beginPath();
        pipeCtx.moveTo(pipeLeft, pipeTop);
        pipeCtx.lineTo(pipeLeft, pipeBottom);
        pipeCtx.stroke();
        pipeCtx.beginPath();
        pipeCtx.moveTo(pipeRight, pipeTop);
        pipeCtx.lineTo(pipeRight, pipeBottom);
        pipeCtx.stroke();
        
        if (pipeMode === 'closed') {
            pipeCtx.beginPath();
            pipeCtx.moveTo(pipeLeft, pipeBottom);
            pipeCtx.lineTo(pipeRight, pipeBottom);
            pipeCtx.stroke();
            pipeCtx.strokeStyle = '#888';
            pipeCtx.lineWidth = 2;
            for (let i = 0; i < pipeWidth; i += 10) {
                pipeCtx.beginPath();
                pipeCtx.moveTo(pipeLeft + i, pipeBottom);
                pipeCtx.lineTo(pipeLeft + i + 10, pipeBottom + 10);
                pipeCtx.stroke();
            }
        }
        
        // ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼
        const speakerY = pipeTop - 30;
        const speakerOffset = pipeAnimating ? Math.sin(pipeTime * 0.15) * 3 : 0;
        pipeCtx.fillStyle = '#333';
        pipeCtx.fillRect(pipeCenterX - 20, speakerY - 20 + speakerOffset, 40, 20);
        pipeCtx.fillStyle = '#666';
        pipeCtx.beginPath();
        pipeCtx.moveTo(pipeCenterX - 13, speakerY + speakerOffset);
        pipeCtx.lineTo(pipeCenterX, speakerY + 15 + speakerOffset);
        pipeCtx.lineTo(pipeCenterX + 13, speakerY + speakerOffset);
        pipeCtx.closePath();
        pipeCtx.fill();
        
        // å®šå¸¸æ³¢
        const waveAmplitude = 30;
        const n = harmonic;
        
        pipeCtx.strokeStyle = '#e53935';
        pipeCtx.lineWidth = 3;
        pipeCtx.beginPath();
        for (let py = 0; py <= pipeHeight; py++) {
            const y = pipeTop + py;
            const ratio = py / pipeHeight;
            let displacement = 0;
            if (pipeAnimating) {
                displacement = pipeMode === 'closed' ? 
                    Math.cos(n * Math.PI * ratio / 2) * Math.cos(pipeTime * 0.1) :
                    Math.cos(n * Math.PI * ratio) * Math.cos(pipeTime * 0.1);
            }
            const x = pipeCenterX + displacement * waveAmplitude;
            if (py === 0) pipeCtx.moveTo(x, y);
            else pipeCtx.lineTo(x, y);
        }
        pipeCtx.stroke();
        
        // åŒ…çµ¡ç·š
        pipeCtx.strokeStyle = '#e53935';
        pipeCtx.lineWidth = 1;
        pipeCtx.setLineDash([5, 5]);
        pipeCtx.beginPath();
        for (let py = 0; py <= pipeHeight; py++) {
            const y = pipeTop + py;
            const ratio = py / pipeHeight;
            const envelope = pipeMode === 'closed' ? Math.abs(Math.cos(n * Math.PI * ratio / 2)) : Math.abs(Math.cos(n * Math.PI * ratio));
            if (py === 0) pipeCtx.moveTo(pipeCenterX + envelope * waveAmplitude, y);
            else pipeCtx.lineTo(pipeCenterX + envelope * waveAmplitude, y);
        }
        pipeCtx.stroke();
        pipeCtx.beginPath();
        for (let py = 0; py <= pipeHeight; py++) {
            const y = pipeTop + py;
            const ratio = py / pipeHeight;
            const envelope = pipeMode === 'closed' ? Math.abs(Math.cos(n * Math.PI * ratio / 2)) : Math.abs(Math.cos(n * Math.PI * ratio));
            if (py === 0) pipeCtx.moveTo(pipeCenterX - envelope * waveAmplitude, y);
            else pipeCtx.lineTo(pipeCenterX - envelope * waveAmplitude, y);
        }
        pipeCtx.stroke();
        pipeCtx.setLineDash([]);
        
        // ãƒãƒ¼ã‚«ãƒ¼
        if (pipeMode === 'closed') {
            pipeCtx.fillStyle = '#4CAF50';
            for (let k = 0; k <= n; k++) {
                const ratio = (2 * k) / n;
                if (ratio <= 1) {
                    pipeCtx.beginPath();
                    pipeCtx.arc(pipeRight + 20, pipeTop + ratio * pipeHeight, 6, 0, Math.PI * 2);
                    pipeCtx.fill();
                }
            }
            pipeCtx.fillStyle = '#2196F3';
            for (let k = 0; k <= n; k++) {
                const ratio = (2 * k + 1) / n;
                if (ratio <= 1) {
                    pipeCtx.beginPath();
                    pipeCtx.arc(pipeRight + 20, pipeTop + ratio * pipeHeight, 6, 0, Math.PI * 2);
                    pipeCtx.fill();
                }
            }
        } else {
            pipeCtx.fillStyle = '#4CAF50';
            for (let k = 0; k <= n; k++) {
                pipeCtx.beginPath();
                pipeCtx.arc(pipeRight + 20, pipeTop + (k / n) * pipeHeight, 6, 0, Math.PI * 2);
                pipeCtx.fill();
            }
            pipeCtx.fillStyle = '#2196F3';
            for (let k = 0; k < n; k++) {
                pipeCtx.beginPath();
                pipeCtx.arc(pipeRight + 20, pipeTop + ((2 * k + 1) / (2 * n)) * pipeHeight, 6, 0, Math.PI * 2);
                pipeCtx.fill();
            }
        }
        
        // é•·ã•è¡¨ç¤º
        pipeCtx.strokeStyle = '#667eea';
        pipeCtx.lineWidth = 1;
        pipeCtx.setLineDash([5, 5]);
        pipeCtx.beginPath();
        pipeCtx.moveTo(pipeLeft - 30, pipeTop);
        pipeCtx.lineTo(pipeLeft - 30, pipeBottom);
        pipeCtx.stroke();
        pipeCtx.setLineDash([]);
        pipeCtx.fillStyle = '#667eea';
        pipeCtx.font = '14px sans-serif';
        pipeCtx.textAlign = 'center';
        pipeCtx.save();
        pipeCtx.translate(pipeLeft - 50, (pipeTop + pipeBottom) / 2);
        pipeCtx.rotate(-Math.PI / 2);
        pipeCtx.fillText('L = ' + pipeLength.toFixed(2) + ' m', 0, 0);
        pipeCtx.restore();
        
        // ãƒ©ãƒ™ãƒ«
        pipeCtx.font = '14px sans-serif';
        pipeCtx.textAlign = 'left';
        pipeCtx.fillStyle = '#333';
        pipeCtx.fillText(pipeMode === 'closed' ? 'é–‰ç®¡' : 'é–‹ç®¡', 20, 30);
        pipeCtx.fillText(harmonic + 'å€æŒ¯å‹•', 20, 50);
        pipeCtx.fillStyle = '#4CAF50';
        pipeCtx.fillText('â— è…¹', W - 100, 30);
        pipeCtx.fillStyle = '#2196F3';
        pipeCtx.fillText('â— ç¯€', W - 100, 50);
        
        if (showLongitudinal && pipeAnimating) {
            // ç¸¦æ³¢è¡¨ç¤ºï¼ˆçœç•¥ï¼‰
        }
    }
    
    function animatePipe() {
        if (!pipeAnimating) return;
        pipeTime++;
        drawPipe();
        pipeAnimationId = requestAnimationFrame(animatePipe);
    }
    
    function updatePipeInfo() {
        const wavelength = getPipeWavelength();
        const frequency = soundSpeed / wavelength;
        document.getElementById('pipeInfo1').textContent = 'ç®¡ã®ç¨®é¡: ' + (pipeMode === 'closed' ? 'é–‰ç®¡ï¼ˆä¸€ç«¯é–‰ï¼‰' : 'é–‹ç®¡ï¼ˆä¸¡ç«¯é–‹ï¼‰');
        document.getElementById('pipeInfo2').textContent = 'æ³¢é•· Î» = ' + wavelength.toFixed(3) + ' m';
        document.getElementById('pipeInfo3').textContent = 'æŒ¯å‹•æ•° f = ' + frequency.toFixed(1) + ' Hz';
    }
    
    pipeLengthSlider.addEventListener('input', function() {
        pipeLength = parseFloat(this.value);
        pipeLengthDisplay.textContent = pipeLength.toFixed(2) + ' m';
        updatePipeInfo();
        drawPipe();
    });
    harmonicSlider.addEventListener('input', function() {
        let value = parseInt(this.value);
        if (pipeMode === 'closed' && value % 2 === 0) {
            value--;
            this.value = value;
        }
        harmonic = value;
        harmonicDisplay.textContent = harmonic + ' å€æŒ¯å‹•';
        updatePipeInfo();
        drawPipe();
    });
    document.getElementById('showLongitudinalCheck').addEventListener('change', function() {
        showLongitudinal = this.checked;
        drawPipe();
    });
    document.getElementById('pipeStartBtn').addEventListener('click', function() {
        if (pipeAnimating) {
            pipeAnimating = false;
            this.textContent = 'ã‚¹ã‚¿ãƒ¼ãƒˆ';
            cancelAnimationFrame(pipeAnimationId);
        } else {
            pipeAnimating = true;
            this.textContent = 'åœæ­¢';
            animatePipe();
        }
    });
    document.getElementById('pipeResetBtn').addEventListener('click', function() {
        pipeAnimating = false;
        pipeTime = 0;
        document.getElementById('pipeStartBtn').textContent = 'ã‚¹ã‚¿ãƒ¼ãƒˆ';
        cancelAnimationFrame(pipeAnimationId);
        drawPipe();
    });

    // ===== å…±é€šå‡¦ç† =====
    function resizeCanvases() {
        stringCanvas.width = stringCanvas.parentElement.clientWidth - 40;
        stringCanvas.height = 300;
        pipeCanvas.width = pipeCanvas.parentElement.clientWidth - 40;
        pipeCanvas.height = 450;
    }
    
    // åˆæœŸåŒ–
    window.addEventListener('load', function() {
        resizeCanvases();
        drawDemo();
        drawStringWave();
        drawCompositeWave();
        drawClosedPipeWave();
        drawOpenPipeWave();
        drawEndCorrection();
        drawPendulum();
        updateStringInfo();
        updatePipeInfo();
        drawStringSimulation();
        drawPipe();
    });
    
    window.addEventListener('resize', function() {
        resizeCanvases();
        drawStringSimulation();
        drawPipe();
    });
    </script>
</body>
</html>