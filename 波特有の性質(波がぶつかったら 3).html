<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é«˜æ ¡ç‰©ç† - æ³¢ã®å¹²æ¸‰</title>
    <script>
      window.MathJax = {
      tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']]
     }
     };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        header {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .back-link {
            color: #667eea;
            text-decoration: none;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 10px;
        }
        h1 {
            color: #333;
        }
        .container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .tab-btn {
            flex: 1;
            min-width: 150px;
            padding: 12px 20px;
            border: none;
            background: #f0f0f0;
            cursor: pointer;
            border-radius: 5px;
            font-size: 16px;
            transition: all 0.3s;
        }
        .tab-btn.active {
            background: #667eea;
            color: white;
        }
        .tab-btn:hover {
            background: #8899f0;
            color: white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        h2 {
            color: #667eea;
            margin-bottom: 15px;
        }
        h3 {
            color: #555;
            margin: 25px 0 15px 0;
            padding-bottom: 5px;
            border-bottom: 2px solid #667eea;
        }
        
        /* è§£èª¬ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .lecture-content {
            line-height: 1.8;
            color: #333;
        }
        .lecture-content p {
            margin-bottom: 15px;
        }
        .key-point {
            background: linear-gradient(135deg, #e8f4fd 0%, #e0e7ff 100%);
            border-left: 4px solid #667eea;
            padding: 15px 20px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }
        .key-point-title {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }
        .formula-box {
            background: #f8f9fa;
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        .formula-box.constructive {
            border-color: #28a745;
            background: linear-gradient(135deg, #e8f5e9 0%, #f1f8e9 100%);
        }
        .formula-box.destructive {
            border-color: #dc3545;
            background: linear-gradient(135deg, #ffebee 0%, #fce4ec 100%);
        }
        .formula-label {
            font-weight: bold;
            margin-bottom: 10px;
        }
        .formula-box.constructive .formula-label {
            color: #28a745;
        }
        .formula-box.destructive .formula-label {
            color: #dc3545;
        }
        
        /* å‹•çš„å›³è§£ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .interactive-figure {
            background: #f5f5f5;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
        }
        .figure-title {
            font-weight: bold;
            color: #555;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .figure-canvas {
            display: block;
            width: 100%;
            background: white;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        .figure-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
            align-items: center;
        }
        .figure-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        .figure-btn.primary {
            background: #667eea;
            color: white;
        }
        .figure-btn.primary:hover {
            background: #5a6fd6;
        }
        .figure-btn.secondary {
            background: #6c757d;
            color: white;
        }
        .figure-btn.secondary:hover {
            background: #5a6268;
        }
        .figure-btn.active {
            background: #28a745;
        }
        .figure-btn.pause {
            background: #ff9800;
            color: white;
        }
        .figure-select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        .figure-legend {
            display: flex;
            gap: 20px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
        }
        .legend-line {
            width: 30px;
            height: 3px;
        }
        .legend-line.solid {
            background: #5c8cc9;
        }
        .legend-line.dashed {
            background: repeating-linear-gradient(90deg, #d97777, #d97777 5px, transparent 5px, transparent 10px);
        }
        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        .legend-dot.constructive {
            background: #4CAF50;
        }
        .legend-dot.destructive {
            background: #f44336;
        }
        
        /* æƒ…å ±è¡¨ç¤ºãƒ‘ãƒãƒ« */
        .info-display {
            background: #f0f0f0;
            padding: 10px 15px;
            border-radius: 8px;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .info-display .item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .info-display .label {
            color: #666;
        }
        .info-display .value {
            font-weight: bold;
            color: #333;
        }
        .info-display .value.red { color: #c0392b; }
        .info-display .value.blue { color: #2980b9; }
        .info-display .value.purple { color: #8e44ad; }
        .info-display .value.green { color: #27ae60; }
        
        /* ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        #sim-container {
            background: #f5f5f5;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .canvas-wrapper {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        .canvas-box {
            flex: 1;
            min-width: 300px;
        }
        .canvas-box h4 {
            color: #555;
            margin-bottom: 10px;
            font-size: 14px;
        }
        #physicsCanvas, #physics3DCanvas {
            display: block;
            width: 100%;
            background: #1a1a2e;
            border-radius: 5px;
            border: 2px solid #ddd;
            cursor: crosshair;
        }
        .sim-controls {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
        }
        .control-group {
            margin-bottom: 20px;
        }
        .control-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }
        .control-group input[type="range"] {
            width: 100%;
            margin: 10px 0;
        }
        .value-display {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 5px 15px;
            border-radius: 5px;
            font-weight: bold;
            min-width: 100px;
            text-align: center;
        }
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .sim-button {
            flex: 1;
            min-width: 120px;
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        .sim-button.start {
            background: #4CAF50;
            color: white;
        }
        .sim-button.start:hover {
            background: #45a049;
        }
        .sim-button.reset {
            background: #f44336;
            color: white;
        }
        .sim-button.reset:hover {
            background: #da190b;
        }
        .sim-button.toggle {
            background: #2196F3;
            color: white;
        }
        .sim-button.toggle:hover {
            background: #1976D2;
        }
        .sim-button.toggle.active {
            background: #ff9800;
        }
        
        /* æ¸¬å®šç‚¹æƒ…å ±ãƒ‘ãƒãƒ« */
        .info-panel {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        .info-panel h4 {
            color: #667eea;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        .info-item {
            background: white;
            padding: 12px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .info-item .label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }
        .info-item .value {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            font-family: 'Courier New', monospace;
        }
        .info-item.highlight-green .value {
            color: #28a745;
        }
        .info-item.highlight-red .value {
            color: #dc3545;
        }
        .info-item.highlight-yellow .value {
            color: #ffc107;
        }
        
        /* å•é¡Œç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .problem-section {
            margin-bottom: 30px;
        }
        .problem-box {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
        }
        .problem-number {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 5px 12px;
            border-radius: 5px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        details {
            background: #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        summary {
            cursor: pointer;
            font-weight: bold;
            color: #667eea;
        }
        details[open] summary {
            margin-bottom: 10px;
        }
        .answer-content {
            padding-top: 10px;
            border-top: 1px solid #ccc;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            header, .container {
                padding: 15px;
            }
            .tab-btn {
                min-width: 100px;
                font-size: 14px;
            }
            .info-grid {
                grid-template-columns: 1fr 1fr;
            }
            .canvas-wrapper {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <header>
        <a href="index.html" class="back-link">â† ç›®æ¬¡ã«æˆ»ã‚‹</a>
        <h1>æ³¢ã®å¹²æ¸‰</h1>
    </header>
    <div class="container">
        
        <div class="tabs">
            <button class="tab-btn active" onclick="openTab('lecture')">è§£èª¬ç·¨</button>
            <button class="tab-btn" onclick="openTab('problem')">å•é¡Œç·¨</button>
            <button class="tab-btn" onclick="openTab('simulation')">ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</button>
        </div>
        
        <!-- è§£èª¬ã‚¿ãƒ– -->
        <div id="lecture" class="tab-content active">
            <h2>æ³¢ã®å¹²æ¸‰ã¨ã¯</h2>
            <div class="lecture-content">
                <p>
                    2ã¤ä»¥ä¸Šã®æ³¢ãŒé‡ãªã‚Šåˆã†ã¨ãã€æ³¢ã®é‡ã­åˆã‚ã›ã®åŸç†ã«ã‚ˆã‚Šã€å„ç‚¹ã§ã®å¤‰ä½ã¯å€‹ã€…ã®æ³¢ã®å¤‰ä½ã®å’Œã«ãªã‚Šã¾ã™ã€‚
                    ç‰¹ã«ã€<strong>ä¸€å®šé–“éš”ã§è¤‡æ•°ã®æ³¢æºã‹ã‚‰æ³¢ãŒç™ºç”Ÿã—ç¶šã‘ã‚‹</strong>å ´åˆã€å¼·ã‚åˆã†å ´æ‰€ã¨å¼±ã‚åˆã†å ´æ‰€ãŒ<strong>è¦å‰‡çš„ã«</strong>ä¸¦ã¶ç¾è±¡ãŒèµ·ã“ã‚Šã¾ã™ã€‚
                    ã“ã‚Œã‚’<strong style="color: #667eea;">æ³¢ã®å¹²æ¸‰</strong>ã¨ã„ã„ã¾ã™ã€‚
                </p>
                
                <h3>æ°´é¢æ³¢ã®å¹²æ¸‰ã‚’è¦³å¯Ÿã—ã‚ˆã†</h3>
                <p>
                    ä¸‹ã®å›³ã§ã¯ã€2ã¤ã®æ³¢æº $S_1$ ã¨ $S_2$ ã‹ã‚‰åŒã˜å‘¨æœŸãƒ»åŒã˜æŒ¯å¹…ã®æ³¢ãŒç™ºç”Ÿã—ã¦ã„ã¾ã™ã€‚
                    <strong>å®Ÿç·šã¯å±±ï¼ˆæ³¢ã®é ‚ä¸Šï¼‰</strong>ã€<strong style="color: #cc6666;">ç ´ç·šã¯è°·ï¼ˆæ³¢ã®åº•ï¼‰</strong>ã‚’è¡¨ã—ã¦ã„ã¾ã™ã€‚
                </p>
                
                <!-- å‹•çš„å›³è§£1ï¼šæ°´é¢æ³¢ã®å¹²æ¸‰ -->
                <div class="interactive-figure">
                    <div class="figure-title">
                        <span>ğŸ“Š</span> å›³1ï¼šæ°´é¢æ³¢ã®å¹²æ¸‰ãƒ‘ã‚¿ãƒ¼ãƒ³
                    </div>
                    <canvas id="lectureCanvas1" class="figure-canvas" height="400"></canvas>
                    <div class="figure-controls">
                        <button class="figure-btn primary" id="fig1PlayBtn">â–¶ å†ç”Ÿ</button>
                        <button class="figure-btn secondary" id="fig1ResetBtn">ãƒªã‚»ãƒƒãƒˆ</button>
                        <select class="figure-select" id="fig1PhaseSelect">
                            <option value="same">åŒä½ç›¸ï¼ˆå±±ã¨å±±ãŒåŒæ™‚ã«å‡ºã‚‹ï¼‰</option>
                            <option value="opposite">é€†ä½ç›¸ï¼ˆå±±ã¨è°·ãŒåŒæ™‚ã«å‡ºã‚‹ï¼‰</option>
                        </select>
                    </div>
                    <div class="figure-legend">
                        <div class="legend-item">
                            <div class="legend-line solid"></div>
                            <span>å±±ï¼ˆå®Ÿç·šï¼‰</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-line dashed"></div>
                            <span>è°·ï¼ˆç ´ç·šï¼‰</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-dot constructive"></div>
                            <span>å¼·ã‚åˆã„</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-dot destructive"></div>
                            <span>å¼±ã‚åˆã„</span>
                        </div>
                    </div>
                </div>
                
                <div class="key-point">
                    <div class="key-point-title">ğŸ’¡ è¦³å¯Ÿã®ãƒã‚¤ãƒ³ãƒˆ</div>
                    <ul style="margin-left: 20px;">
                        <li><strong style="color: #28a745;">ç·‘ã®ç‚¹</strong>ï¼šå±±ã¨å±±ã€ã¾ãŸã¯è°·ã¨è°·ãŒé‡ãªã‚‹å ´æ‰€ â†’ <strong>å¸¸ã«å¼·ã‚åˆã†</strong></li>
                        <li><strong style="color: #dc3545;">èµ¤ã®ç‚¹</strong>ï¼šå±±ã¨è°·ãŒé‡ãªã‚‹å ´æ‰€ â†’ <strong>å¸¸ã«å¼±ã‚åˆã†ï¼ˆæ‰“ã¡æ¶ˆã—åˆã†ï¼‰</strong></li>
                        <li>ã“ã‚Œã‚‰ã®ç‚¹ã¯æ™‚é–“ãŒçµŒã£ã¦ã‚‚å¤‰ã‚ã‚‰ãšã€<strong>åŒæ›²ç·šä¸Š</strong>ã«è¦å‰‡çš„ã«ä¸¦ã³ã¾ã™</li>
                    </ul>
                </div>
                
                <h3>çµŒè·¯å·®ã¨ã¯</h3>
                <p>
                    ä»»æ„ã®ç‚¹ $P$ ã«ãŠã„ã¦ã€2ã¤ã®æ³¢æºã‹ã‚‰ã®è·é›¢ã®å·®ã‚’<strong style="color: #667eea;">çµŒè·¯å·®ï¼ˆã‘ã„ã‚ã•ï¼‰</strong>ã¨ã„ã„ã¾ã™ã€‚
                </p>
                
                <h3>å¹²æ¸‰æ¡ä»¶ã®å°å‡º</h3>
                <p>
                    2ã¤ã®æ³¢æºã‹ã‚‰<strong>åŒä½ç›¸</strong>ï¼ˆåŒæ™‚ã«å±±ã€åŒæ™‚ã«è°·ï¼‰ã§æ³¢ãŒå‡ºã¦ã„ã‚‹å ´åˆã‚’è€ƒãˆã¾ã™ã€‚
                    ç‚¹ $P$ ã«å±Šã2ã¤ã®æ³¢ãŒå¼·ã‚åˆã†ã‹å¼±ã‚åˆã†ã‹ã¯ã€<strong>çµŒè·¯å·®ãŒæ³¢é•·ã®ä½•å€ã‹</strong>ã§æ±ºã¾ã‚Šã¾ã™ã€‚
                </p>
                
                <div class="formula-box constructive">
                    <div class="formula-label">âœ“ å¼·ã‚åˆã„ã®æ¡ä»¶ï¼ˆåŒä½ç›¸ã§å±Šãï¼‰</div>
                    <p style="font-size: 1.2em;">
                        $$|S_1P - S_2P| = m\lambda \quad (m = 0, 1, 2, 3, \cdots)$$
                    </p>
                    <p style="font-size: 0.9em; color: #666; margin-top: 10px;">
                        çµŒè·¯å·®ãŒæ³¢é•·ã®æ•´æ•°å€ã®ã¨ãã€2ã¤ã®æ³¢ã¯åŒä½ç›¸ã§åˆ°é”ã—å¼·ã‚åˆã†
                    </p>
                </div>
                
                <div class="formula-box destructive">
                    <div class="formula-label">âœ— å¼±ã‚åˆã„ã®æ¡ä»¶ï¼ˆé€†ä½ç›¸ã§å±Šãï¼‰</div>
                    <p style="font-size: 1.2em;">
                        $$|S_1P - S_2P| = \left(m + \frac{1}{2}\right)\lambda \quad (m = 0, 1, 2, 3, \cdots)$$
                    </p>
                    <p style="font-size: 0.9em; color: #666; margin-top: 10px;">
                        çµŒè·¯å·®ãŒæ³¢é•·ã®åŠæ•´æ•°å€ã®ã¨ãã€2ã¤ã®æ³¢ã¯é€†ä½ç›¸ã§åˆ°é”ã—å¼±ã‚åˆã†
                    </p>
                </div>
                
                <div class="key-point">
                    <div class="key-point-title">ğŸ“ ãªãœã“ã®æ¡ä»¶ã«ãªã‚‹ã®ã‹ï¼Ÿ â€• ä¸‹ã®å›³ã§ç¢ºèªã—ã‚ˆã†</div>
                    <p>
                        æ³¢é•· $\lambda$ ã¯ã€Œ1å‘¨æœŸåˆ†ã®æ³¢ã®é•·ã•ã€ã§ã™ã€‚çµŒè·¯å·®ãŒ $\lambda$ ã®æ•´æ•°å€ãªã‚‰ã€
                        ä¸€æ–¹ã®æ³¢ã¯ã¡ã‚‡ã†ã©æ•´æ•°å‘¨æœŸåˆ†ã ã‘ä½™åˆ†ã«é€²ã‚“ã ã“ã¨ã«ãªã‚Šã€çµå±€åŒã˜ä½ç›¸ã§åˆ°é”ã—ã¾ã™ã€‚
                        ä¸€æ–¹ã€$\frac{\lambda}{2}$ ã®å¥‡æ•°å€ï¼ˆåŠæ³¢é•·åˆ†ãšã‚Œã‚‹ï¼‰ãªã‚‰ã€ä½ç›¸ãŒ $\pi$ï¼ˆ180Â°ï¼‰ãšã‚Œã¦é€†ä½ç›¸ã«ãªã‚Šã¾ã™ã€‚
                    </p>
                    <p style="margin-top: 10px; color: #667eea;">
                        <strong>ğŸ‘‡ ç‚¹Pã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ã€æ³¢ã®é‡ãªã‚Šæ–¹ã‚’ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼</strong>
                    </p>
                </div>
                
                <!-- å‹•çš„å›³è§£2ï¼šçµŒè·¯å·®ã¨æ³¢ã®é‡ã­åˆã‚ã› -->
                <div class="interactive-figure">
                    <div class="figure-title">
                        <span>ğŸ“</span> å›³2ï¼šçµŒè·¯å·®ã¨æ³¢ã®é‡ã­åˆã‚ã›ï¼ˆç‚¹Pã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ã¿ã‚ˆã†ï¼‰
                    </div>
                    <canvas id="lectureCanvas2" class="figure-canvas" height="520"></canvas>
                    <div class="figure-controls">
                        <button class="figure-btn primary" id="fig2PlayBtn">â¸ ä¸€æ™‚åœæ­¢</button>
                        <select class="figure-select" id="fig2PhaseSelect">
                            <option value="same">åŒä½ç›¸</option>
                            <option value="opposite">é€†ä½ç›¸</option>
                        </select>
                        <button class="figure-btn secondary" id="fig2ResetBtn">ä½ç½®ã‚’ãƒªã‚»ãƒƒãƒˆ</button>
                    </div>
                    <div class="info-display" id="fig2Info">
                        <div class="item">
                            <span class="label">Sâ‚P (râ‚) =</span>
                            <span class="value red" id="fig2R1">-</span>
                        </div>
                        <div class="item">
                            <span class="label">Sâ‚‚P (râ‚‚) =</span>
                            <span class="value blue" id="fig2R2">-</span>
                        </div>
                        <div class="item">
                            <span class="label">çµŒè·¯å·® |râ‚-râ‚‚| =</span>
                            <span class="value purple" id="fig2PathDiff">-</span>
                        </div>
                        <div class="item">
                            <span class="label">åˆ¤å®š:</span>
                            <span class="value green" id="fig2Result">-</span>
                        </div>
                    </div>
                </div>
                
                <h3>æˆæ¥­è³‡æ–™</h3>
                <iframe src="https://drive.google.com/file/d/1rd3AUHNkj-NLM0IEztEdsiVOdPwxD6EA/preview" width="100%" height="500"></iframe>
            </div>
        </div>
        
        <!-- å•é¡Œã‚¿ãƒ– -->
        <div id="problem" class="tab-content">
            <h2>ç¢ºèªå•é¡Œ</h2>
            
            <div class="problem-section">
                <div class="problem-box">
                    <span class="problem-number">å•é¡Œ 1</span>
                    <p>
                        2ã¤ã®æ³¢æº $S_1$, $S_2$ ã‹ã‚‰ã€æ³¢é•· $\lambda = 2.0$ cm ã®æ°´é¢æ³¢ãŒåŒä½ç›¸ã§ç™ºç”Ÿã—ã¦ã„ã‚‹ã€‚
                        ã‚ã‚‹ç‚¹ $P$ ã«ãŠã„ã¦ã€$S_1P = 8.0$ cmã€$S_2P = 5.0$ cm ã§ã‚ã‚‹ã¨ãã€
                        ç‚¹ $P$ ã§ã¯æ³¢ã¯å¼·ã‚åˆã†ã‹ã€å¼±ã‚åˆã†ã‹ã€‚ç†ç”±ã¨ã¨ã‚‚ã«ç­”ãˆã‚ˆã€‚
                    </p>
                    <details>
                        <summary>è§£ç­”ãƒ»è§£èª¬ã‚’è¦‹ã‚‹</summary>
                        <div class="answer-content">
                            <p><strong>ã€è§£ç­”ã€‘</strong>å¼±ã‚åˆã†</p>
                            <p><strong>ã€è§£èª¬ã€‘</strong></p>
                            <p>çµŒè·¯å·®ã‚’è¨ˆç®—ã™ã‚‹ã¨ã€</p>
                            <p>$$|S_1P - S_2P| = |8.0 - 5.0| = 3.0 \text{ cm}$$</p>
                            <p>ã“ã‚Œã‚’æ³¢é•·ã§å‰²ã‚‹ã¨ã€</p>
                            <p>$$\frac{3.0}{2.0} = 1.5 = 1 + \frac{1}{2}$$</p>
                            <p>çµŒè·¯å·®ãŒæ³¢é•·ã® $(m + \frac{1}{2})$ å€ï¼ˆ$m = 1$ï¼‰ãªã®ã§ã€<strong style="color: #dc3545;">å¼±ã‚åˆã„ã®æ¡ä»¶</strong>ã‚’æº€ãŸã™ã€‚</p>
                            <p>ã‚ˆã£ã¦ã€ç‚¹ $P$ ã§ã¯æ³¢ã¯<strong>å¼±ã‚åˆã†</strong>ã€‚</p>
                        </div>
                    </details>
                </div>
                
                <div class="problem-box">
                    <span class="problem-number">å•é¡Œ 2</span>
                    <p>
                        æ³¢é•· $\lambda$ ã®æ°´é¢æ³¢ã‚’ç™ºç”Ÿã•ã›ã‚‹2ã¤ã®åŒä½ç›¸ã®æ³¢æº $S_1$, $S_2$ ãŒã‚ã‚‹ã€‚
                        $S_1$ ã¨ $S_2$ ã‚’çµã¶ç›´ç·šä¸Šã§ã€$S_1$ ã‹ã‚‰ $S_2$ ã®æ–¹å‘ã«è·é›¢ $x$ ã®ç‚¹ã‚’ $P$ ã¨ã™ã‚‹ã€‚
                        $S_1S_2$ é–“ã®è·é›¢ã‚’ $d$ ã¨ã™ã‚‹ã¨ãã€ç‚¹ $P$ ã§å¼·ã‚åˆã„ãŒèµ·ã“ã‚‹æ¡ä»¶ã‚’ $x$, $d$, $\lambda$ ã‚’ç”¨ã„ã¦è¡¨ã›ã€‚
                        ãŸã ã—ã€$0 < x < d$ ã¨ã™ã‚‹ã€‚
                    </p>
                    <details>
                        <summary>è§£ç­”ãƒ»è§£èª¬ã‚’è¦‹ã‚‹</summary>
                        <div class="answer-content">
                            <p><strong>ã€è§£ç­”ã€‘</strong>$d - 2x = m\lambda$ ï¼ˆ$m$ ã¯æ•´æ•°ã§ã€$-\frac{d}{\lambda} < m < \frac{d}{\lambda}$ï¼‰</p>
                            <p><strong>ã€è§£èª¬ã€‘</strong></p>
                            <p>ç‚¹ $P$ ã¯ $S_1$ ã¨ $S_2$ ã®é–“ã«ã‚ã‚‹ã®ã§ã€</p>
                            <p>$$S_1P = x, \quad S_2P = d - x$$</p>
                            <p>çµŒè·¯å·®ã¯ã€</p>
                            <p>$$|S_1P - S_2P| = |x - (d-x)| = |2x - d|$$</p>
                            <p>å¼·ã‚åˆã„ã®æ¡ä»¶ã¯ã€çµŒè·¯å·®ãŒæ³¢é•·ã®æ•´æ•°å€ãªã®ã§ã€</p>
                            <p>$$|2x - d| = m\lambda$$</p>
                            <p>ã“ã‚Œã‚’æ•´ç†ã™ã‚‹ã¨ã€</p>
                            <p>$$d - 2x = m\lambda \quad \text{ã¾ãŸã¯} \quad 2x - d = m\lambda$$</p>
                            <p>ï¼ˆ$m$ ã¯æ•´æ•°ã€‚$0 < x < d$ ã®ç¯„å›²ã§è§£ãŒå­˜åœ¨ã™ã‚‹ $m$ ã®å€¤ã«åˆ¶é™ã•ã‚Œã‚‹ï¼‰</p>
                        </div>
                    </details>
                </div>
                
                <div class="problem-box">
                    <span class="problem-number">å•é¡Œ 3</span>
                    <p>
                        ä¸‹å›³ã®ã‚ˆã†ã«ã€2ã¤ã®åŒä½ç›¸ã®æ³¢æº $S_1$, $S_2$ ã‹ã‚‰æ³¢é•· $\lambda = 4.0$ cm ã®æ³¢ãŒå‡ºã¦ã„ã‚‹ã€‚
                        $S_1S_2 = 10.0$ cmã€$S_1S_2$ ã®å‚ç›´äºŒç­‰åˆ†ç·šä¸Šã®ç‚¹ã‚’ $Q$ ã¨ã™ã‚‹ã€‚
                    </p>
                    <p>
                        (1) ç‚¹ $Q$ ã§ã¯æ³¢ã¯å¼·ã‚åˆã†ã‹ã€å¼±ã‚åˆã†ã‹ã€‚<br>
                        (2) $S_1S_2$ ã®å‚ç›´äºŒç­‰åˆ†ç·šä¸Šã§ã€å¼±ã‚åˆã„ãŒèµ·ã“ã‚‹ç‚¹ã®ã†ã¡ã€
                        $S_1$, $S_2$ ã«æœ€ã‚‚è¿‘ã„ç‚¹ã¾ã§ã®è·é›¢ $S_1P$ï¼ˆã¾ãŸã¯ $S_2P$ï¼‰ã‚’æ±‚ã‚ã‚ˆã€‚
                    </p>
                    <details>
                        <summary>è§£ç­”ãƒ»è§£èª¬ã‚’è¦‹ã‚‹</summary>
                        <div class="answer-content">
                            <p><strong>ã€è§£ç­”ã€‘</strong>(1) å¼·ã‚åˆã†ã€€(2) $S_1P = S_2P = \sqrt{29} \approx 5.4$ cm</p>
                            <p><strong>ã€è§£èª¬ã€‘</strong></p>
                            <p><strong>(1)</strong> å‚ç›´äºŒç­‰åˆ†ç·šä¸Šã®ä»»æ„ã®ç‚¹ $Q$ ã§ã¯ã€$S_1Q = S_2Q$ ãªã®ã§ã€</p>
                            <p>$$|S_1Q - S_2Q| = 0 = 0 \times \lambda$$</p>
                            <p>çµŒè·¯å·®ãŒ $0$ï¼ˆæ³¢é•·ã® $0$ å€ï¼‰ãªã®ã§ã€å¼·ã‚åˆã„ã®æ¡ä»¶ã‚’æº€ãŸã™ã€‚ã‚ˆã£ã¦<strong>å¼·ã‚åˆã†</strong>ã€‚</p>
                            <p><strong>(2)</strong> å‚ç›´äºŒç­‰åˆ†ç·šä¸Šã®ç‚¹ã‚’ $P$ ã¨ã™ã‚‹ã¨ã€$S_1P = S_2P$ ã‚ˆã‚ŠçµŒè·¯å·®ã¯å¸¸ã« $0$ã€‚</p>
                            <p>ã—ã‹ã—å•é¡Œæ–‡ã¯ã€Œå‚ç›´äºŒç­‰åˆ†ç·šä¸Šã§å¼±ã‚åˆã†ç‚¹ã€ã‚’æ±‚ã‚ã¦ã„ã¾ã™ãŒã€å‚ç›´äºŒç­‰åˆ†ç·šä¸Šã§ã¯çµŒè·¯å·®ãŒ $0$ ãªã®ã§å¼±ã‚åˆã„ã¯èµ·ã“ã‚Šã¾ã›ã‚“ã€‚</p>
                            <p>ã“ã®å•é¡Œã‚’ã€Œ$S_1$, $S_2$ ã‹ã‚‰ç­‰è·é›¢ã§å¼±ã‚åˆã†ç‚¹ã®ã†ã¡æœ€ã‚‚è¿‘ã„ç‚¹ã€ã¨è§£é‡ˆã™ã‚‹ã¨ã€å¼±ã‚åˆã„ã®æ¡ä»¶ã¯</p>
                            <p>$$|S_1P - S_2P| = \frac{\lambda}{2} = 2.0 \text{ cm}$$</p>
                            <p>$S_1$, $S_2$ ã‹ã‚‰æœ€ã‚‚è¿‘ã„å¼±ã‚åˆã„ã®ç‚¹ã¯ã€$S_1S_2$ ã‚’çµã¶ç·šåˆ†ä¸Šã«ã‚ã‚Šã€</p>
                            <p>å‚ç›´äºŒç­‰åˆ†ç·šã‹ã‚‰ $\frac{\lambda}{4} = 1.0$ cm ãšã‚ŒãŸä½ç½®ã¨ãªã‚‹ã€‚</p>
                            <p>ã“ã®ã¨ãã€$S_1P = 5.0 - 1.0 = 4.0$ cmã€$S_2P = 5.0 + 1.0 = 6.0$ cm ã§çµŒè·¯å·®ã¯ $2.0$ cmã€‚</p>
                        </div>
                    </details>
                </div>
            </div>
        </div>
        
        <!-- ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¿ãƒ– -->
        <div id="simulation" class="tab-content">
            <h2>æ³¢ã®å¹²æ¸‰ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h2>
            <p>ä¸Šã‹ã‚‰æ°´æ»´ãŒè½ã¡ã¦æ³¢ç´‹ãŒåºƒãŒã‚‹æ§˜å­ã‚’è¦³å¯Ÿã—ã¾ã—ã‚‡ã†ã€‚ã‚­ãƒ£ãƒ³ãƒã‚¹ä¸Šã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨çµŒè·¯å·®ã‚’ç¢ºèªã§ãã¾ã™ã€‚</p>
            
            <div id="sim-container">
                <div class="canvas-wrapper">
                    <div class="canvas-box">
                        <h4>ğŸ” ä¸Šã‹ã‚‰è¦‹ãŸå›³ï¼ˆå¹³é¢å›³ï¼‰</h4>
                        <canvas id="physicsCanvas"></canvas>
                    </div>
                    <div class="canvas-box">
                        <h4>ğŸŒŠ æ–œã‚ä¸Šã‹ã‚‰è¦‹ãŸå›³ï¼ˆç«‹ä½“å›³ï¼‰</h4>
                        <canvas id="physics3DCanvas"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="sim-controls">
                <div class="control-group">
                    <label>æ³¢é•· (Î»): <span class="value-display" id="lambdaDisplay">60 px</span></label>
                    <input type="range" id="lambdaSlider" min="30" max="120" value="60" step="5">
                </div>
                
                <div class="control-group">
                    <label>æ³¢æºé–“è·é›¢ (d): <span class="value-display" id="distDisplay">120 px</span></label>
                    <input type="range" id="distSlider" min="40" max="250" value="120" step="10">
                </div>
                
                <div class="button-group">
                    <button class="sim-button start" id="startBtn">â–¶ ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
                    <button class="sim-button reset" id="resetBtn">ãƒªã‚»ãƒƒãƒˆ</button>
                    <button class="sim-button toggle" id="showLinesBtn">å¹²æ¸‰ç¸ã‚’è¡¨ç¤º</button>
                </div>
            </div>
            
            <!-- æ¸¬å®šç‚¹æƒ…å ±ãƒ‘ãƒãƒ« -->
            <div class="info-panel" id="pointInfoPanel" style="display: none;">
                <h4>ğŸ“ æ¸¬å®šç‚¹ P ã®æƒ…å ±</h4>
                <div class="info-grid">
                    <div class="info-item">
                        <div class="label">Sâ‚ã‹ã‚‰ã®è·é›¢ (râ‚)</div>
                        <div class="value" id="r1Value">-</div>
                    </div>
                    <div class="info-item">
                        <div class="label">Sâ‚‚ã‹ã‚‰ã®è·é›¢ (râ‚‚)</div>
                        <div class="value" id="r2Value">-</div>
                    </div>
                    <div class="info-item">
                        <div class="label">çµŒè·¯å·® |râ‚ - râ‚‚|</div>
                        <div class="value" id="pathDiffValue">-</div>
                    </div>
                    <div class="info-item">
                        <div class="label">çµŒè·¯å·® / Î»</div>
                        <div class="value" id="pathDiffRatioValue">-</div>
                    </div>
                    <div class="info-item" id="interferenceItem">
                        <div class="label">å¹²æ¸‰ã®ç¨®é¡</div>
                        <div class="value" id="interferenceValue">-</div>
                    </div>
                    <div class="info-item">
                        <div class="label">æ¡ä»¶å¼</div>
                        <div class="value" id="conditionValue" style="font-size: 14px;">-</div>
                    </div>
                </div>
                <button class="sim-button reset" id="clearPointBtn" style="margin-top: 15px; flex: none; min-width: auto;">æ¸¬å®šç‚¹ã‚’ã‚¯ãƒªã‚¢</button>
            </div>
        </div>
    </div>
    
    <script>
    // ===== ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½ =====
    function openTab(tabName) {
        var contents = document.getElementsByClassName("tab-content");
        for (var i = 0; i < contents.length; i++) {
            contents[i].style.display = "none";
            contents[i].classList.remove("active");
        }
        var buttons = document.getElementsByClassName("tab-btn");
        for (var i = 0; i < buttons.length; i++) {
            buttons[i].classList.remove("active");
        }
        document.getElementById(tabName).style.display = "block";
        document.getElementById(tabName).classList.add("active");
        if (event) {
            event.currentTarget.classList.add("active");
        }
        
        if (tabName === 'simulation') {
            setTimeout(resizeSimCanvas, 100);
        }
    }

    // ===== è§£èª¬ã‚¿ãƒ–ï¼šå›³1ï¼ˆæ°´é¢æ³¢ã®å¹²æ¸‰ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰=====
    (function() {
        const canvas = document.getElementById('lectureCanvas1');
        const ctx = canvas.getContext('2d');
        const playBtn = document.getElementById('fig1PlayBtn');
        const resetBtn = document.getElementById('fig1ResetBtn');
        const phaseSelect = document.getElementById('fig1PhaseSelect');
        
        let width, height;
        let time = 0;
        let isPlaying = false;
        let animationId = null;
        const lambda = 55;
        const sourceDistance = 100;
        let s1, s2;
        
        function setup() {
            width = canvas.parentElement.clientWidth - 30;
            height = 400;
            canvas.width = width;
            canvas.height = height;
            s1 = { x: width / 2 - sourceDistance / 2, y: height / 2 };
            s2 = { x: width / 2 + sourceDistance / 2, y: height / 2 };
            draw();
        }
        
        function draw() {
            ctx.fillStyle = '#fafaf5';
            ctx.fillRect(0, 0, width, height);
            
            const isOpposite = phaseSelect.value === 'opposite';
            const phaseOffset = isOpposite ? lambda / 2 : 0;
            
            const step = 10;
            for (let x = 0; x < width; x += step) {
                for (let y = 0; y < height; y += step) {
                    const d1 = Math.sqrt(Math.pow(x - s1.x, 2) + Math.pow(y - s1.y, 2));
                    const d2 = Math.sqrt(Math.pow(x - s2.x, 2) + Math.pow(y - s2.y, 2));
                    let pathDiff = Math.abs(d1 - d2);
                    if (isOpposite) pathDiff = Math.abs(d1 - d2 - lambda / 2);
                    
                    const m = pathDiff / lambda;
                    const remainder = m - Math.floor(m);
                    
                    if (Math.abs(remainder) < 0.1 || Math.abs(remainder - 1) < 0.1) {
                        ctx.fillStyle = 'rgba(76, 175, 80, 0.25)';
                        ctx.beginPath();
                        ctx.arc(x, y, 5, 0, 2 * Math.PI);
                        ctx.fill();
                    } else if (Math.abs(remainder - 0.5) < 0.1) {
                        ctx.fillStyle = 'rgba(244, 67, 54, 0.25)';
                        ctx.beginPath();
                        ctx.arc(x, y, 5, 0, 2 * Math.PI);
                        ctx.fill();
                    }
                }
            }
            
            const maxRadius = Math.sqrt(width * width + height * height);
            
            for (let r = (time % lambda); r < maxRadius; r += lambda) {
                ctx.strokeStyle = '#5c8cc9';
                ctx.lineWidth = 2.5;
                ctx.setLineDash([]);
                ctx.beginPath();
                ctx.arc(s1.x, s1.y, r, 0, 2 * Math.PI);
                ctx.stroke();
                
                if (r + lambda / 2 < maxRadius) {
                    ctx.strokeStyle = '#d97777';
                    ctx.lineWidth = 2;
                    ctx.setLineDash([10, 6]);
                    ctx.beginPath();
                    ctx.arc(s1.x, s1.y, r + lambda / 2, 0, 2 * Math.PI);
                    ctx.stroke();
                }
            }
            
            for (let r = ((time + phaseOffset) % lambda); r < maxRadius; r += lambda) {
                ctx.strokeStyle = '#5c8cc9';
                ctx.lineWidth = 2.5;
                ctx.setLineDash([]);
                ctx.beginPath();
                ctx.arc(s2.x, s2.y, r, 0, 2 * Math.PI);
                ctx.stroke();
                
                if (r + lambda / 2 < maxRadius) {
                    ctx.strokeStyle = '#d97777';
                    ctx.lineWidth = 2;
                    ctx.setLineDash([10, 6]);
                    ctx.beginPath();
                    ctx.arc(s2.x, s2.y, r + lambda / 2, 0, 2 * Math.PI);
                    ctx.stroke();
                }
            }
            ctx.setLineDash([]);
            
            ctx.fillStyle = '#333';
            ctx.beginPath();
            ctx.arc(s1.x, s1.y, 10, 0, 2 * Math.PI);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(s2.x, s2.y, 10, 0, 2 * Math.PI);
            ctx.fill();
            
            ctx.fillStyle = 'white';
            ctx.font = 'bold 13px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('Sâ‚', s1.x, s1.y);
            ctx.fillText('Sâ‚‚', s2.x, s2.y);
        }
        
        function animate() {
            if (!isPlaying) return;
            time += 0.4;
            draw();
            animationId = requestAnimationFrame(animate);
        }
        
        playBtn.addEventListener('click', function() {
            isPlaying = !isPlaying;
            if (isPlaying) {
                playBtn.textContent = 'â¸ åœæ­¢';
                playBtn.classList.add('active');
                animate();
            } else {
                playBtn.textContent = 'â–¶ å†ç”Ÿ';
                playBtn.classList.remove('active');
                if (animationId) cancelAnimationFrame(animationId);
            }
        });
        
        resetBtn.addEventListener('click', function() {
            isPlaying = false;
            playBtn.textContent = 'â–¶ å†ç”Ÿ';
            playBtn.classList.remove('active');
            if (animationId) cancelAnimationFrame(animationId);
            time = 0;
            draw();
        });
        
        phaseSelect.addEventListener('change', draw);
        window.addEventListener('resize', setup);
        setup();
    })();

    // ===== è§£èª¬ã‚¿ãƒ–ï¼šå›³2ï¼ˆçµŒè·¯å·®ã¨æ³¢ã®é‡ã­åˆã‚ã›ï¼‰=====
    (function() {
        const canvas = document.getElementById('lectureCanvas2');
        const ctx = canvas.getContext('2d');
        const phaseSelect = document.getElementById('fig2PhaseSelect');
        const resetBtn = document.getElementById('fig2ResetBtn');
        const playBtn = document.getElementById('fig2PlayBtn');
        
        let width, height;
        const sourceDistance = 140;
        let s1, s2;
        let pointP = null;
        let isDragging = false;
        
        const lambda = 60;
        let waveTime = 0;
        let animationId = null;
        let isPlaying = true;
        
        function setup() {
            width = canvas.parentElement.clientWidth - 30;
            height = 520;
            canvas.width = width;
            canvas.height = height;
            s1 = { x: width / 2 - sourceDistance / 2, y: 120 };
            s2 = { x: width / 2 + sourceDistance / 2, y: 120 };
            pointP = { x: width / 2 + 100, y: 80 };
            startAnimation();
        }
        
        function startAnimation() {
            if (animationId) cancelAnimationFrame(animationId);
            function animate() {
                if (isPlaying) {
                    waveTime += 0.015; // ã‹ãªã‚Šã‚†ã£ãã‚Š
                }
                draw();
                animationId = requestAnimationFrame(animate);
            }
            animate();
        }
        
        function draw() {
            const isOpposite = phaseSelect.value === 'opposite';
            
            ctx.fillStyle = '#fafaf5';
            ctx.fillRect(0, 0, width, height);
            
            const topAreaHeight = 200;
            ctx.strokeStyle = '#ddd';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(0, topAreaHeight);
            ctx.lineTo(width, topAreaHeight);
            ctx.stroke();
            
            ctx.fillStyle = '#666';
            ctx.font = '14px Arial';
            ctx.textAlign = 'left';
            ctx.fillText('ã€ä½ç½®é–¢ä¿‚å›³ã€‘ç‚¹Pã‚’ãƒ‰ãƒ©ãƒƒã‚°ã§ãã¾ã™', 10, 20);
            
            if (pointP) {
                const d1 = Math.sqrt(Math.pow(pointP.x - s1.x, 2) + Math.pow(pointP.y - s1.y, 2));
                const d2 = Math.sqrt(Math.pow(pointP.x - s2.x, 2) + Math.pow(pointP.y - s2.y, 2));
                const pathDiff = Math.abs(d1 - d2);
                
                // S1Pã®ç·š
                ctx.strokeStyle = '#c0392b';
                ctx.lineWidth = 3;
                ctx.setLineDash([]);
                ctx.beginPath();
                ctx.moveTo(s1.x, s1.y);
                ctx.lineTo(pointP.x, pointP.y);
                ctx.stroke();
                
                // S2Pã®ç·š
                ctx.strokeStyle = '#2980b9';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(s2.x, s2.y);
                ctx.lineTo(pointP.x, pointP.y);
                ctx.stroke();
                
                // è·é›¢ãƒ©ãƒ™ãƒ«
                ctx.font = 'bold 14px Arial';
                ctx.textAlign = 'center';
                
                const mid1x = (s1.x + pointP.x) / 2;
                const mid1y = (s1.y + pointP.y) / 2;
                ctx.fillStyle = 'rgba(255,255,255,0.9)';
                ctx.fillRect(mid1x - 40, mid1y - 12, 80, 20);
                ctx.fillStyle = '#c0392b';
                ctx.fillText(`râ‚ = ${d1.toFixed(0)}`, mid1x, mid1y + 3);
                
                const mid2x = (s2.x + pointP.x) / 2;
                const mid2y = (s2.y + pointP.y) / 2;
                ctx.fillStyle = 'rgba(255,255,255,0.9)';
                ctx.fillRect(mid2x - 40, mid2y - 12, 80, 20);
                ctx.fillStyle = '#2980b9';
                ctx.fillText(`râ‚‚ = ${d2.toFixed(0)}`, mid2x, mid2y + 3);
                
                // ç‚¹P
                ctx.fillStyle = '#8e44ad';
                ctx.beginPath();
                ctx.arc(pointP.x, pointP.y, 12, 0, 2 * Math.PI);
                ctx.fill();
                ctx.fillStyle = 'white';
                ctx.font = 'bold 14px Arial';
                ctx.textBaseline = 'middle';
                ctx.fillText('P', pointP.x, pointP.y);
                
                // ===== ä¸‹éƒ¨ï¼šæ³¢ã®é‡ã­åˆã‚ã›å›³ =====
                const waveAreaTop = topAreaHeight + 30;
                
                ctx.fillStyle = '#666';
                ctx.font = '14px Arial';
                ctx.textAlign = 'left';
                ctx.textBaseline = 'top';
                ctx.fillText('ã€æ³¢ã®é‡ã­åˆã‚ã›ã€‘ç‚¹Pã«å±Šãæ³¢ã®æ§˜å­', 10, waveAreaTop);
                
                const waveBoxLeft = 40;
                const waveBoxRight = width - 40;
                const waveBoxWidth = waveBoxRight - waveBoxLeft;
                const waveBoxTop = waveAreaTop + 30;
                const waveBoxHeight = 250;
                
                ctx.strokeStyle = '#ccc';
                ctx.lineWidth = 2;
                ctx.strokeRect(waveBoxLeft, waveBoxTop, waveBoxWidth, waveBoxHeight);
                ctx.fillStyle = '#fff';
                ctx.fillRect(waveBoxLeft, waveBoxTop, waveBoxWidth, waveBoxHeight);
                
                const pX = waveBoxRight - 30;
                const waveCenter = waveBoxTop + waveBoxHeight / 2;
                const amplitude = 30;
                const waveScale = 0.7;
                
                const scaledD1 = d1 * waveScale;
                const scaledD2 = d2 * waveScale;
                const scaledLambda = lambda * waveScale; // æ³¢é•·ã‚‚ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°
                
                const s1WaveX = pX - scaledD1;
                const s2WaveX = pX - scaledD2;
                
                // çµŒè·¯å·®ã®è¡¨ç¤º
                if (Math.abs(scaledD1 - scaledD2) > 5) {
                    const diffStart = Math.min(s1WaveX, s2WaveX);
                    const diffEnd = Math.max(s1WaveX, s2WaveX);
                    ctx.strokeStyle = '#8e44ad';
                    ctx.lineWidth = 2;
                    ctx.setLineDash([5, 3]);
                    ctx.beginPath();
                    ctx.moveTo(diffStart, waveBoxTop + 25);
                    ctx.lineTo(diffEnd, waveBoxTop + 25);
                    ctx.stroke();
                    ctx.beginPath();
                    ctx.moveTo(diffStart, waveBoxTop + 20);
                    ctx.lineTo(diffStart, waveBoxTop + 30);
                    ctx.moveTo(diffEnd, waveBoxTop + 20);
                    ctx.lineTo(diffEnd, waveBoxTop + 30);
                    ctx.stroke();
                    ctx.setLineDash([]);
                    ctx.fillStyle = '#8e44ad';
                    ctx.font = '12px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(`çµŒè·¯å·® = ${pathDiff.toFixed(0)}`, (diffStart + diffEnd) / 2, waveBoxTop + 12);
                }
                
                // æ³¢1ï¼ˆS1ã‹ã‚‰ã®æ³¢ï¼‰- èµ¤
                const wave1Y = waveCenter - 50;
                ctx.strokeStyle = '#c0392b';
                ctx.lineWidth = 2.5;
                ctx.setLineDash([]);
                ctx.beginPath();
                let firstPoint = true;
                for (let x = Math.max(waveBoxLeft, s1WaveX); x <= pX; x += 2) {
                    const dist = x - s1WaveX;
                    const phase = (dist / scaledLambda) * 2 * Math.PI - waveTime * 2 * Math.PI;
                    const y = wave1Y + amplitude * Math.sin(phase);
                    if (firstPoint) {
                        ctx.moveTo(x, y);
                        firstPoint = false;
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                ctx.stroke();
                
                // S1ãƒãƒ¼ã‚«ãƒ¼
                if (s1WaveX >= waveBoxLeft - 10) {
                    ctx.fillStyle = '#c0392b';
                    ctx.beginPath();
                    ctx.arc(Math.max(waveBoxLeft, s1WaveX), wave1Y, 10, 0, 2 * Math.PI);
                    ctx.fill();
                    ctx.fillStyle = 'white';
                    ctx.font = 'bold 11px Arial';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText('Sâ‚', Math.max(waveBoxLeft, s1WaveX), wave1Y);
                }
                
                // æ³¢2ï¼ˆS2ã‹ã‚‰ã®æ³¢ï¼‰- é’
                const wave2Y = waveCenter + 50;
                const phase2Offset = isOpposite ? Math.PI : 0;
                ctx.strokeStyle = '#2980b9';
                ctx.lineWidth = 2.5;
                ctx.beginPath();
                firstPoint = true;
                for (let x = Math.max(waveBoxLeft, s2WaveX); x <= pX; x += 2) {
                    const dist = x - s2WaveX;
                    const phase = (dist / scaledLambda) * 2 * Math.PI - waveTime * 2 * Math.PI + phase2Offset;
                    const y = wave2Y + amplitude * Math.sin(phase);
                    if (firstPoint) {
                        ctx.moveTo(x, y);
                        firstPoint = false;
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                ctx.stroke();
                
                // S2ãƒãƒ¼ã‚«ãƒ¼
                if (s2WaveX >= waveBoxLeft - 10) {
                    ctx.fillStyle = '#2980b9';
                    ctx.beginPath();
                    ctx.arc(Math.max(waveBoxLeft, s2WaveX), wave2Y, 10, 0, 2 * Math.PI);
                    ctx.fill();
                    ctx.fillStyle = 'white';
                    ctx.font = 'bold 11px Arial';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText('Sâ‚‚', Math.max(waveBoxLeft, s2WaveX), wave2Y);
                }
                
                // ç‚¹Pã§ã®æ³¢ã®å€¤ã‚’è¨ˆç®—ï¼ˆã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã•ã‚ŒãŸæ³¢é•·ã‚’ä½¿ç”¨ï¼‰
                const phase1AtP = (scaledD1 / scaledLambda) * 2 * Math.PI - waveTime * 2 * Math.PI;
                const phase2AtP = (scaledD2 / scaledLambda) * 2 * Math.PI - waveTime * 2 * Math.PI + phase2Offset;
                const wave1AtP = Math.sin(phase1AtP);
                const wave2AtP = Math.sin(phase2AtP);
                
                // ç‚¹Pã®ç¸¦ç·š
                ctx.strokeStyle = '#8e44ad';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 3]);
                ctx.beginPath();
                ctx.moveTo(pX, waveBoxTop + 40);
                ctx.lineTo(pX, waveBoxTop + waveBoxHeight - 10);
                ctx.stroke();
                ctx.setLineDash([]);
                
                // ç‚¹Pãƒãƒ¼ã‚«ãƒ¼
                ctx.fillStyle = '#8e44ad';
                ctx.font = 'bold 16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('P', pX, waveBoxTop + waveBoxHeight + 15);
                
                // ç‚¹Pã§ã®å„æ³¢ã®ä½ç½®ã‚’ç¤ºã™ç‚¹
                const p1Y = wave1Y + amplitude * wave1AtP;
                const p2Y = wave2Y + amplitude * wave2AtP;
                
                ctx.fillStyle = '#c0392b';
                ctx.beginPath();
                ctx.arc(pX, p1Y, 7, 0, 2 * Math.PI);
                ctx.fill();
                
                ctx.fillStyle = '#2980b9';
                ctx.beginPath();
                ctx.arc(pX, p2Y, 7, 0, 2 * Math.PI);
                ctx.fill();
                
                // ãƒ©ãƒ™ãƒ«
                ctx.fillStyle = '#c0392b';
                ctx.font = '13px Arial';
                ctx.textAlign = 'left';
                ctx.fillText('Sâ‚ã‹ã‚‰ã®æ³¢', waveBoxLeft + 5, wave1Y - amplitude - 15);
                
                ctx.fillStyle = '#2980b9';
                ctx.fillText('Sâ‚‚ã‹ã‚‰ã®æ³¢', waveBoxLeft + 5, wave2Y - amplitude - 15);
                
                // å¹²æ¸‰åˆ¤å®š
                const ratio = pathDiff / lambda;
                const remainder = ratio - Math.floor(ratio);
                let resultText = '';
                let resultColor = '';
                
                if (isOpposite) {
                    if (Math.abs(remainder - 0.5) < 0.15) {
                        resultText = 'å¼·ã‚åˆã„ (' + ratio.toFixed(2) + 'Î»)';
                        resultColor = '#27ae60';
                    } else if (Math.abs(remainder) < 0.15 || Math.abs(remainder - 1) < 0.15) {
                        resultText = 'å¼±ã‚åˆã„ (' + ratio.toFixed(2) + 'Î»)';
                        resultColor = '#e74c3c';
                    } else {
                        resultText = 'ä¸­é–“ (' + ratio.toFixed(2) + 'Î»)';
                        resultColor = '#f39c12';
                    }
                } else {
                    if (Math.abs(remainder) < 0.15 || Math.abs(remainder - 1) < 0.15) {
                        resultText = 'å¼·ã‚åˆã„ (' + ratio.toFixed(2) + 'Î»)';
                        resultColor = '#27ae60';
                    } else if (Math.abs(remainder - 0.5) < 0.15) {
                        resultText = 'å¼±ã‚åˆã„ (' + ratio.toFixed(2) + 'Î»)';
                        resultColor = '#e74c3c';
                    } else {
                        resultText = 'ä¸­é–“ (' + ratio.toFixed(2) + 'Î»)';
                        resultColor = '#f39c12';
                    }
                }
                
                document.getElementById('fig2R1').textContent = d1.toFixed(0);
                document.getElementById('fig2R2').textContent = d2.toFixed(0);
                document.getElementById('fig2PathDiff').textContent = pathDiff.toFixed(0);
                document.getElementById('fig2Result').textContent = resultText;
                document.getElementById('fig2Result').style.color = resultColor;
            }
            
            // æ³¢æºï¼ˆä¸Šéƒ¨ï¼‰
            ctx.fillStyle = '#c0392b';
            ctx.beginPath();
            ctx.arc(s1.x, s1.y, 14, 0, 2 * Math.PI);
            ctx.fill();
            ctx.fillStyle = 'white';
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('Sâ‚', s1.x, s1.y);
            
            ctx.fillStyle = '#2980b9';
            ctx.beginPath();
            ctx.arc(s2.x, s2.y, 14, 0, 2 * Math.PI);
            ctx.fill();
            ctx.fillStyle = 'white';
            ctx.fillText('Sâ‚‚', s2.x, s2.y);
        }
        
        function getMousePos(e) {
            const rect = canvas.getBoundingClientRect();
            return {
                x: (e.clientX - rect.left) * (canvas.width / rect.width),
                y: (e.clientY - rect.top) * (canvas.height / rect.height)
            };
        }
        
        canvas.addEventListener('mousedown', function(e) {
            const pos = getMousePos(e);
            if (pointP && pos.y < 200) {
                const dist = Math.sqrt(Math.pow(pos.x - pointP.x, 2) + Math.pow(pos.y - pointP.y, 2));
                if (dist < 25) {
                    isDragging = true;
                }
            }
        });
        
        canvas.addEventListener('mousemove', function(e) {
            if (isDragging && pointP) {
                const pos = getMousePos(e);
                pointP.x = Math.max(50, Math.min(width - 50, pos.x));
                pointP.y = Math.max(40, Math.min(180, pos.y));
            }
        });
        
        canvas.addEventListener('mouseup', function() { isDragging = false; });
        canvas.addEventListener('mouseleave', function() { isDragging = false; });
        
        canvas.addEventListener('touchstart', function(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const pos = getMousePos(touch);
            if (pointP && pos.y < 200) {
                const dist = Math.sqrt(Math.pow(pos.x - pointP.x, 2) + Math.pow(pos.y - pointP.y, 2));
                if (dist < 40) isDragging = true;
            }
        });
        
        canvas.addEventListener('touchmove', function(e) {
            e.preventDefault();
            if (isDragging && pointP) {
                const touch = e.touches[0];
                const pos = getMousePos(touch);
                pointP.x = Math.max(50, Math.min(width - 50, pos.x));
                pointP.y = Math.max(40, Math.min(180, pos.y));
            }
        });
        
        canvas.addEventListener('touchend', function() { isDragging = false; });
        
        playBtn.addEventListener('click', function() {
            isPlaying = !isPlaying;
            if (isPlaying) {
                playBtn.textContent = 'â¸ ä¸€æ™‚åœæ­¢';
                playBtn.classList.remove('pause');
                playBtn.classList.add('primary');
            } else {
                playBtn.textContent = 'â–¶ å†ç”Ÿ';
                playBtn.classList.remove('primary');
                playBtn.classList.add('pause');
            }
        });
        
        resetBtn.addEventListener('click', function() {
            pointP = { x: width / 2 + 100, y: 80 };
        });
        
        window.addEventListener('resize', setup);
        setup();
    })();

    // ===== ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¿ãƒ– =====
    (function() {
        const canvas = document.getElementById('physicsCanvas');
        const ctx = canvas.getContext('2d');
        const canvas3D = document.getElementById('physics3DCanvas');
        const ctx3D = canvas3D.getContext('2d');
        
        const lambdaSlider = document.getElementById('lambdaSlider');
        const distSlider = document.getElementById('distSlider');
        const lambdaDisplay = document.getElementById('lambdaDisplay');
        const distDisplay = document.getElementById('distDisplay');
        const startBtn = document.getElementById('startBtn');
        const resetBtn = document.getElementById('resetBtn');
        const showLinesBtn = document.getElementById('showLinesBtn');
        const clearPointBtn = document.getElementById('clearPointBtn');
        const pointInfoPanel = document.getElementById('pointInfoPanel');
        
        let width, height;
        let time = 0;
        let isPlaying = false;
        let showLines = false;
        let animationId = null;
        let s1, s2;
        let selectedPoint = null;
        
        // æ°´æ»´ã®ã‚¯ãƒ©ã‚¹
        class Droplet {
            constructor(x, targetY) {
                this.x = x;
                this.y = -20;
                this.targetY = targetY;
                this.speed = 3;
                this.active = true;
                this.splashing = false;
                this.splashTime = 0;
            }
            
            update() {
                if (!this.splashing) {
                    this.y += this.speed;
                    if (this.y >= this.targetY) {
                        this.y = this.targetY;
                        this.splashing = true;
                    }
                } else {
                    this.splashTime++;
                    if (this.splashTime > 15) {
                        this.active = false;
                    }
                }
            }
            
            draw(ctx) {
                if (!this.splashing) {
                    // æ°´æ»´
                    ctx.fillStyle = '#4fc3f7';
                    ctx.beginPath();
                    ctx.ellipse(this.x, this.y, 4, 6, 0, 0, 2 * Math.PI);
                    ctx.fill();
                    // ãƒã‚¤ãƒ©ã‚¤ãƒˆ
                    ctx.fillStyle = 'rgba(255,255,255,0.6)';
                    ctx.beginPath();
                    ctx.arc(this.x - 1, this.y - 2, 2, 0, 2 * Math.PI);
                    ctx.fill();
                } else {
                    // ã‚¹ãƒ—ãƒ©ãƒƒã‚·ãƒ¥
                    const alpha = 1 - this.splashTime / 15;
                    ctx.strokeStyle = `rgba(79, 195, 247, ${alpha})`;
                    ctx.lineWidth = 2;
                    const r = this.splashTime * 2;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, r, 0, 2 * Math.PI);
                    ctx.stroke();
                }
            }
        }
        
        let droplets1 = [];
        let droplets2 = [];
        let dropletTimer = 0;
        const dropletInterval = 60;
        
        function resizeCanvas() {
            const container = document.querySelector('.canvas-box');
            width = container.clientWidth - 10;
            height = Math.min(350, window.innerHeight * 0.35);
            canvas.width = width;
            canvas.height = height;
            canvas3D.width = width;
            canvas3D.height = height;
            updateSources();
            draw();
        }
        window.resizeSimCanvas = resizeCanvas;
        
        function updateSources() {
            const d = parseFloat(distSlider.value);
            s1 = { x: width / 2 - d / 2, y: height / 2 };
            s2 = { x: width / 2 + d / 2, y: height / 2 };
        }
        
        function draw() {
            const lambda = parseFloat(lambdaSlider.value);
            
            // ===== 2Då¹³é¢å›³ =====
            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(0, 0, width, height);
            
            // å¹²æ¸‰ç¸
            if (showLines) {
                const step = 3;
                for (let x = 0; x < width; x += step) {
                    for (let y = 0; y < height; y += step) {
                        const d1 = Math.sqrt(Math.pow(x - s1.x, 2) + Math.pow(y - s1.y, 2));
                        const d2 = Math.sqrt(Math.pow(x - s2.x, 2) + Math.pow(y - s2.y, 2));
                        const pathDiff = Math.abs(d1 - d2);
                        const m = pathDiff / lambda;
                        const remainder = m - Math.floor(m);
                        
                        if (Math.abs(remainder) < 0.05 || Math.abs(remainder - 1) < 0.05) {
                            ctx.fillStyle = 'rgba(40, 167, 69, 0.5)';
                            ctx.fillRect(x, y, step, step);
                        } else if (Math.abs(remainder - 0.5) < 0.05) {
                            ctx.fillStyle = 'rgba(220, 53, 69, 0.5)';
                            ctx.fillRect(x, y, step, step);
                        }
                    }
                }
            }
            
            // æ³¢é¢
            ctx.lineWidth = 1.5;
            const maxRadius = Math.sqrt(width * width + height * height);
            
            for (let r = (time % lambda); r < maxRadius; r += lambda) {
                ctx.strokeStyle = 'rgba(0, 200, 255, 0.6)';
                ctx.setLineDash([]);
                ctx.beginPath();
                ctx.arc(s1.x, s1.y, r, 0, 2 * Math.PI);
                ctx.stroke();
                
                if (r + lambda / 2 < maxRadius) {
                    ctx.strokeStyle = 'rgba(255, 100, 100, 0.4)';
                    ctx.setLineDash([6, 4]);
                    ctx.beginPath();
                    ctx.arc(s1.x, s1.y, r + lambda / 2, 0, 2 * Math.PI);
                    ctx.stroke();
                }
                
                ctx.strokeStyle = 'rgba(0, 200, 255, 0.6)';
                ctx.setLineDash([]);
                ctx.beginPath();
                ctx.arc(s2.x, s2.y, r, 0, 2 * Math.PI);
                ctx.stroke();
                
                if (r + lambda / 2 < maxRadius) {
                    ctx.strokeStyle = 'rgba(255, 100, 100, 0.4)';
                    ctx.setLineDash([6, 4]);
                    ctx.beginPath();
                    ctx.arc(s2.x, s2.y, r + lambda / 2, 0, 2 * Math.PI);
                    ctx.stroke();
                }
            }
            ctx.setLineDash([]);
            
            // æ°´æ»´ã‚’æç”»
            droplets1.forEach(d => d.draw(ctx));
            droplets2.forEach(d => d.draw(ctx));
            
            // é¸æŠç‚¹
            if (selectedPoint) {
                const px = selectedPoint.x;
                const py = selectedPoint.y;
                const d1 = Math.sqrt(Math.pow(px - s1.x, 2) + Math.pow(py - s1.y, 2));
                const d2 = Math.sqrt(Math.pow(px - s2.x, 2) + Math.pow(py - s2.y, 2));
                
                ctx.strokeStyle = 'rgba(255, 200, 0, 0.9)';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.moveTo(s1.x, s1.y);
                ctx.lineTo(px, py);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(s2.x, s2.y);
                ctx.lineTo(px, py);
                ctx.stroke();
                ctx.setLineDash([]);
                
                ctx.font = 'bold 12px Arial';
                ctx.textAlign = 'center';
                
                const mid1x = (s1.x + px) / 2;
                const mid1y = (s1.y + py) / 2;
                ctx.fillStyle = 'rgba(0,0,0,0.7)';
                ctx.fillRect(mid1x - 30, mid1y - 18, 60, 18);
                ctx.fillStyle = '#ffc107';
                ctx.fillText(`râ‚=${d1.toFixed(1)}`, mid1x, mid1y - 6);
                
                const mid2x = (s2.x + px) / 2;
                const mid2y = (s2.y + py) / 2;
                ctx.fillStyle = 'rgba(0,0,0,0.7)';
                ctx.fillRect(mid2x - 30, mid2y - 18, 60, 18);
                ctx.fillStyle = '#ffc107';
                ctx.fillText(`râ‚‚=${d2.toFixed(1)}`, mid2x, mid2y - 6);
                
                ctx.fillStyle = '#9b59b6';
                ctx.beginPath();
                ctx.arc(px, py, 8, 0, 2 * Math.PI);
                ctx.fill();
                ctx.strokeStyle = 'white';
                ctx.lineWidth = 2;
                ctx.stroke();
                ctx.fillStyle = 'white';
                ctx.font = 'bold 14px Arial';
                ctx.fillText('P', px, py - 15);
            }
            
            // æ³¢æº
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.arc(s1.x, s1.y, 8, 0, 2 * Math.PI);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(s2.x, s2.y, 8, 0, 2 * Math.PI);
            ctx.fill();
            
            ctx.fillStyle = '#1a1a2e';
            ctx.font = 'bold 10px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('Sâ‚', s1.x, s1.y);
            ctx.fillText('Sâ‚‚', s2.x, s2.y);
            
            // å‡¡ä¾‹
            ctx.fillStyle = 'rgba(255,255,255,0.8)';
            ctx.font = '11px Arial';
            ctx.textAlign = 'left';
            ctx.fillText('å®Ÿç·š:å±±  ç ´ç·š:è°·', 10, 20);
            
            // ===== 3Dç«‹ä½“å›³ =====
            draw3D(lambda);
        }
        
        function draw3D(lambda) {
            // èƒŒæ™¯
            const gradient = ctx3D.createLinearGradient(0, 0, 0, height);
            gradient.addColorStop(0, '#87CEEB');
            gradient.addColorStop(1, '#E0F7FA');
            ctx3D.fillStyle = gradient;
            ctx3D.fillRect(0, 0, width, height);
            
            // æ°´é¢ã®ãƒ‘ãƒ¼ã‚¹ãƒšã‚¯ãƒ†ã‚£ãƒ–ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
            const horizon = height * 0.3;
            const waterTop = horizon;
            const waterBottom = height;
            
            // æ°´é¢ã®ã‚°ãƒªãƒƒãƒ‰æç”»
            const gridSize = 15;
            const amplitude = 12;
            
            // æ³¢ã®é«˜ã•ã‚’è¨ˆç®—ã™ã‚‹é–¢æ•°
            function getWaveHeight(wx, wy) {
                const d1 = Math.sqrt(Math.pow(wx - 0.35, 2) + Math.pow(wy - 0.5, 2)) * width;
                const d2 = Math.sqrt(Math.pow(wx - 0.65, 2) + Math.pow(wy - 0.5, 2)) * width;
                const wave1 = Math.sin((d1 - time) / lambda * 2 * Math.PI);
                const wave2 = Math.sin((d2 - time) / lambda * 2 * Math.PI);
                return (wave1 + wave2) * amplitude;
            }
            
            // æ°´é¢ã‚’å¥¥ã‹ã‚‰æ‰‹å‰ã«æç”»
            for (let row = 0; row < 25; row++) {
                const wy = row / 25;
                const screenY = waterTop + (waterBottom - waterTop) * wy;
                const scale = 0.3 + wy * 0.7;
                
                for (let col = 0; col < 30; col++) {
                    const wx = col / 30;
                    const screenX = width * 0.1 + width * 0.8 * wx;
                    
                    const h = getWaveHeight(wx, wy);
                    const adjustedY = screenY - h * scale;
                    
                    // é«˜ã•ã«å¿œã˜ãŸè‰²
                    const normalizedH = (h + amplitude * 2) / (amplitude * 4);
                    const r = Math.floor(30 + normalizedH * 50);
                    const g = Math.floor(100 + normalizedH * 80);
                    const b = Math.floor(180 + normalizedH * 50);
                    
                    ctx3D.fillStyle = `rgba(${r}, ${g}, ${b}, ${0.6 + wy * 0.3})`;
                    const dotSize = 3 + scale * 4;
                    ctx3D.beginPath();
                    ctx3D.ellipse(screenX, adjustedY, dotSize, dotSize * 0.5, 0, 0, 2 * Math.PI);
                    ctx3D.fill();
                }
            }
            
            // æ³¢æºã®ä½ç½®ï¼ˆ3Dï¼‰
            const s1_3d = { x: width * 0.35, y: waterTop + (waterBottom - waterTop) * 0.5 };
            const s2_3d = { x: width * 0.65, y: waterTop + (waterBottom - waterTop) * 0.5 };
            
            // æ°´æ»´ã‚’3Dã§æç”»
            droplets1.forEach(d => {
                if (!d.splashing) {
                    const scale3D = 0.3 + 0.5 * 0.7;
                    const y3D = waterTop + (waterBottom - waterTop) * 0.5 - (s1.y - d.y) * scale3D * 0.5;
                    ctx3D.fillStyle = '#4fc3f7';
                    ctx3D.beginPath();
                    ctx3D.ellipse(s1_3d.x, y3D - 30, 5, 7, 0, 0, 2 * Math.PI);
                    ctx3D.fill();
                }
            });
            
            droplets2.forEach(d => {
                if (!d.splashing) {
                    const scale3D = 0.3 + 0.5 * 0.7;
                    const y3D = waterTop + (waterBottom - waterTop) * 0.5 - (s2.y - d.y) * scale3D * 0.5;
                    ctx3D.fillStyle = '#4fc3f7';
                    ctx3D.beginPath();
                    ctx3D.ellipse(s2_3d.x, y3D - 30, 5, 7, 0, 0, 2 * Math.PI);
                    ctx3D.fill();
                }
            });
            
            // æ³¢æºãƒãƒ¼ã‚«ãƒ¼ï¼ˆ3Dï¼‰
            ctx3D.fillStyle = 'rgba(255, 255, 255, 0.9)';
            ctx3D.beginPath();
            ctx3D.arc(s1_3d.x, s1_3d.y, 6, 0, 2 * Math.PI);
            ctx3D.fill();
            ctx3D.beginPath();
            ctx3D.arc(s2_3d.x, s2_3d.y, 6, 0, 2 * Math.PI);
            ctx3D.fill();
            
            ctx3D.fillStyle = '#333';
            ctx3D.font = 'bold 12px Arial';
            ctx3D.textAlign = 'center';
            ctx3D.fillText('Sâ‚', s1_3d.x, s1_3d.y - 15);
            ctx3D.fillText('Sâ‚‚', s2_3d.x, s2_3d.y - 15);
            
            // ãƒ©ãƒ™ãƒ«
            ctx3D.fillStyle = 'rgba(0,0,0,0.6)';
            ctx3D.font = '11px Arial';
            ctx3D.textAlign = 'left';
            ctx3D.fillText('ğŸŒŠ æ°´é¢ã®é«˜ä½ã‚’è‰²ã§è¡¨ç¾', 10, 20);
        }
        
        function animate() {
            if (!isPlaying) return;
            time += 0.8;
            
            // æ°´æ»´ã‚’æ›´æ–°
            dropletTimer++;
            if (dropletTimer >= dropletInterval) {
                dropletTimer = 0;
                droplets1.push(new Droplet(s1.x, s1.y));
                droplets2.push(new Droplet(s2.x, s2.y));
            }
            
            droplets1.forEach(d => d.update());
            droplets2.forEach(d => d.update());
            droplets1 = droplets1.filter(d => d.active);
            droplets2 = droplets2.filter(d => d.active);
            
            draw();
            animationId = requestAnimationFrame(animate);
        }
        
        function updatePointInfo(x, y) {
            const lambda = parseFloat(lambdaSlider.value);
            const d1 = Math.sqrt(Math.pow(x - s1.x, 2) + Math.pow(y - s1.y, 2));
            const d2 = Math.sqrt(Math.pow(x - s2.x, 2) + Math.pow(y - s2.y, 2));
            const pathDiff = Math.abs(d1 - d2);
            const ratio = pathDiff / lambda;
            const remainder = ratio - Math.floor(ratio);
            
            document.getElementById('r1Value').textContent = d1.toFixed(1) + ' px';
            document.getElementById('r2Value').textContent = d2.toFixed(1) + ' px';
            document.getElementById('pathDiffValue').textContent = pathDiff.toFixed(1) + ' px';
            document.getElementById('pathDiffRatioValue').textContent = ratio.toFixed(2) + ' Î»';
            
            const interferenceItem = document.getElementById('interferenceItem');
            const interferenceValue = document.getElementById('interferenceValue');
            const conditionValue = document.getElementById('conditionValue');
            
            interferenceItem.classList.remove('highlight-green', 'highlight-red', 'highlight-yellow');
            
            if (Math.abs(remainder) < 0.1 || Math.abs(remainder - 1) < 0.1) {
                interferenceValue.textContent = 'å¼·ã‚åˆã„';
                interferenceItem.classList.add('highlight-green');
                const n = Math.round(ratio);
                conditionValue.textContent = `Î”r = ${n}Î»`;
            } else if (Math.abs(remainder - 0.5) < 0.1) {
                interferenceValue.textContent = 'å¼±ã‚åˆã„';
                interferenceItem.classList.add('highlight-red');
                const n = Math.floor(ratio);
                conditionValue.textContent = `Î”r = (${n}+Â½)Î»`;
            } else {
                interferenceValue.textContent = 'ä¸­é–“';
                interferenceItem.classList.add('highlight-yellow');
                conditionValue.textContent = `Î”r â‰ˆ ${ratio.toFixed(2)}Î»`;
            }
            
            pointInfoPanel.style.display = 'block';
        }
        
        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        startBtn.addEventListener('click', function() {
            isPlaying = !isPlaying;
            if (isPlaying) {
                startBtn.textContent = 'â¸ åœæ­¢';
                startBtn.style.background = '#ff9800';
                animate();
            } else {
                startBtn.textContent = 'â–¶ ã‚¹ã‚¿ãƒ¼ãƒˆ';
                startBtn.style.background = '#4CAF50';
                if (animationId) cancelAnimationFrame(animationId);
            }
        });
        
        resetBtn.addEventListener('click', function() {
            isPlaying = false;
            startBtn.textContent = 'â–¶ ã‚¹ã‚¿ãƒ¼ãƒˆ';
            startBtn.style.background = '#4CAF50';
            if (animationId) cancelAnimationFrame(animationId);
            time = 0;
            selectedPoint = null;
            droplets1 = [];
            droplets2 = [];
            dropletTimer = 0;
            pointInfoPanel.style.display = 'none';
            draw();
        });
        
        showLinesBtn.addEventListener('click', function() {
            showLines = !showLines;
            if (showLines) {
                showLinesBtn.textContent = 'å¹²æ¸‰ç¸ã‚’éè¡¨ç¤º';
                showLinesBtn.classList.add('active');
            } else {
                showLinesBtn.textContent = 'å¹²æ¸‰ç¸ã‚’è¡¨ç¤º';
                showLinesBtn.classList.remove('active');
            }
            draw();
        });
        
        clearPointBtn.addEventListener('click', function() {
            selectedPoint = null;
            pointInfoPanel.style.display = 'none';
            draw();
        });
        
        lambdaSlider.addEventListener('input', function() {
            lambdaDisplay.textContent = this.value + ' px';
            if (selectedPoint) updatePointInfo(selectedPoint.x, selectedPoint.y);
            if (!isPlaying) draw();
        });
        
        distSlider.addEventListener('input', function() {
            distDisplay.textContent = this.value + ' px';
            updateSources();
            if (selectedPoint) updatePointInfo(selectedPoint.x, selectedPoint.y);
            if (!isPlaying) draw();
        });
        
        canvas.addEventListener('click', function(e) {
            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX - rect.left) * (canvas.width / rect.width);
            const y = (e.clientY - rect.top) * (canvas.height / rect.height);
            selectedPoint = { x, y };
            updatePointInfo(x, y);
            if (!isPlaying) draw();
        });
        
        window.addEventListener('resize', resizeCanvas);
        setTimeout(resizeCanvas, 100);
    })();
    </script>
</body>
</html>